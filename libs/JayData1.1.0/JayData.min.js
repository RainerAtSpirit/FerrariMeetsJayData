"undefined"===typeof console&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}});console.warn||(console.warn=function(){});console.error||(console.error=function(){});(function(){typeof window==="undefined"&&(window=this);$data=window.$data||(window.$data={});if(typeof module!=="undefined"&&module.exports){(sqLiteModule=require("sqlite3"))&&(window.openDatabase=true);module.exports=$data}})(this);
(function(a){a.__namespace=true;a.version="JayData 1.1.0";a.versionNumber="1.1.0";a.root={}})($data);
var Guard={requireValue:function(a,b){(typeof b==="undefined"||b===null)&&Guard.raise(a+" requires a value other than undefined or null")},requireType:function(a,b,c){return(c instanceof Array?c:[c]).some(function(c){switch(typeof c){case "string":return typeof b===c;case "function":return b instanceof c;default:Guard.raise("Unknown type format : "+typeof c+" for: "+a)}})},raise:function(a){if(typeof intellisense==="undefined"){a instanceof Exception?console.error(a.name+":",a.message+"\n",a):console.error(a);
throw a;}}};Object.isNullOrUndefined=function(a){return a===void 0||a===null};
(function(){if(!Object.getOwnPropertyNames)Object.getOwnPropertyNames=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};if(!Object.create)Object.create=function(a){function b(){}arguments.length>1&&Guard.raise(Error("Object.create implementation only accepts the first parameter."));b.prototype=a;return new b};if(!Object.keys){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty",
"isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;Object.keys=function(e){(typeof e!=="object"&&typeof e!=="function"||e===null)&&Guard.raise(new TypeError("Object.keys called on non-object"));var h=[],f;for(f in e)a.call(e,f)&&h.push(f);if(b)for(f=0;f<d;f++)a.call(e,c[f])&&h.push(c[f]);return h}}if(!Object.defineProperty)Object.defineProperty=function(a,b,c){a[b]=c.value||{}};if(!Object.defineProperties)Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=
b[c].value||{})};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.filter)Array.prototype.filter=function(a,b){for(var c=[],d=0,i=this.length;d<i;d++)(b?a.call(b,this[d],d,this):a(this[d],d,this))===true&&c.push(this[d]);return c};if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var c=[],d=0,i=this.length;d<i;d++){var u=b?a.call(b,this[d],d,this):a(this[d],d,this);c.push(u)}return c};
if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1}})();
var JAYLINT=function(){function a(){return this}function b(){}function c(a){return Db[a]||"\\u"+("0000"+a.charCodeAt().toString(16)).slice(-4)}function d(a){Object.keys(a).forEach(function(b){P[b]=a[b]})}function e(){if(!l.safe){if(l.rhino){d(Eb);l.rhino=false}if(l.devel){d(Fb);l.devel=false}if(l.browser){d(Gb);l.browser=false}if(l.windows){d(Hb);l.windows=false}if(l.node){d(Ib);l.node=false;Ja=true}if(l.widget){d(Jb);l.widget=false}}}function h(a,b,c){throw{name:"JSLintError",line:b,character:c,
message:E.scanned_a_b.supplant({a:a,b:Math.floor(b/xa.length*100)})};}function f(a,b,c,d,e,f){var k,i,b=b||g;i=b.line||0;k=b.from||0;a={id:"(error)",raw:E[a]||a,evidence:xa[i-1]||"",line:i,character:k,a:c||b.value,b:d,c:e,d:f};a.reason=a.raw.supplant(a);JAYLINT.errors.push(a);l.passfail&&h(E.stopping,i,k);Ka=Ka+1;Ka>=l.maxerr&&h(E.too_many,i,k);return a}function k(a,b,c,d,e,g,h){return f(a,{line:b,from:c},d,e,g,h)}function i(a,b,c,d,e,g){a=f(a,b,c,d,e,g);h(E.stopping,a.line,a.character)}function u(a,
b,c,d,e,f,g){return i(a,{line:b,from:c},d,e,f,g)}function o(a){!l.white&&g.from!==a&&f("expected_a_at_b_c",g,g.value,a,g.from)}function J(a,b,c){if(a[b]!==c){f("expected_a_b",a,c,a[b]);return true}return false}function K(a,b,c){c=c||a.value;if(p===W){l.safe&&f("adsafe_a",a,c);if(typeof W[c]!=="string"){a.writeable=typeof P[c]==="boolean"?P[c]:true;a.funct=p;ya[c]=a}b==="becoming"&&(b="var")}else if(typeof p[c]==="string")if(p[c]==="undef"){l.undef||f("used_before_a",a,c);b="var"}else f("already_defined",
a,c);else{a.funct=p;a.writeable=true;z[c]=a}p[c]=b}function r(a){for(var b,c=0,a=a||0;c<=a;){(b=za[c])||(b=za[c]=Aa.token());c=c+1}return b}function m(a){a=a||n;if(a.comments){for(var b=a.prev;b.comments===null;)b=b.prev;b.comments=b.comments?b.comments.concat(a.comments):a.comments}a.comments=null}function j(a,b){if(v){if(da&&g.line!==n.line){if((da!==v||!g.edge)&&g.from===v.at-(g.edge?l.indent:0)){for(var c=v;;){c.at=c.at-l.indent;if(c===da)break;c=c.was}c.open=false}da=null}if(v.open)if(g.edge)g.edge===
"label"?o(1):g.edge==="case"?o(v.at-l.indent):(v.mode!=="array"||g.line!==n.line)&&o(v.at);else{if(g.line!==n.line){g.from<v.at+(v.mode==="expression"?0:l.indent)&&o(v.at+l.indent);v.wrap=true}}else if(g.line!==n.line)if(g.edge)o(v.at);else{v.wrap=true;v.mode==="statement"||v.mode==="var"?o(v.at+l.indent):g.from<v.at+(v.mode==="expression"?0:l.indent)&&o(v.at+l.indent)}}switch(n.id){case "(number)":g.id==="."&&f("trailing_decimal_a");break;case "-":(g.id==="-"||g.id==="--")&&f("confusing_a");break;
case "+":(g.id==="+"||g.id==="++")&&f("confusing_a")}if(n.id==="(string)"||n.identifier)Za=n.value;a&&g.id!==a&&(b?f("expected_a_b_from_c_d",g,a,b.id,b.line,g.value):(!g.identifier||g.value!==a)&&f("expected_a_b",g,a,g.value));T=n;n=g;g=za.shift()||Aa.token();n.id==="(end)"&&m()}function $a(){if(l.adsafe)l.safe=true;if(l.safe){l.browser=l["continue"]=l.css=l.debug=l.devel=l.evil=l.forin=l.newcap=l.nomen=l.on=l.rhino=l.sloppy=l.sub=l.undef=l.widget=l.windows=false;delete P.Array;delete P.Date;delete P.Function;
delete P.Object;delete P.eval;d({ADSAFE:false,lib:false})}}function ka(){var a=this.id,b=Ba;g.line===n.line&&g.from===n.thru&&f("missing_space_a_b",g,n.value,g.value);Ba=true;l.white=true;(za.length>0||g.comments)&&f("unexpected_a",this);switch(a){case "/*properties":case "/*property":case "/*members":case "/*member":a:for(ea||(ea={});;){if(g.id!=="(string)"&&!g.identifier)break a;ea[g.value]=true;j();if(g.id!==",")break a;j(",")}break;case "/*jslint":for(l.safe&&f("adsafe_a",this);g.id==="(string)"||
g.identifier;){a=g.value;j();g.id!==":"&&i("expected_a_b",g,":",g.value);j(":");switch(a){case "indent":a=+g.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&i("expected_small_a");l.indent=a;break;case "maxerr":a=+g.value;(typeof a!=="number"||!isFinite(a)||a<=0||Math.floor(a)!==a)&&i("expected_small_a",g);l.maxerr=a;break;case "maxlen":a=+g.value;(typeof a!=="number"||!isFinite(a)||a<0||Math.floor(a)!==a)&&i("expected_small_a");l.maxlen=a;break;default:g.id==="true"?l[a]=true:g.id===
"false"?l[a]=false:i("unexpected_a");if(a==="adsafe"){l.adsafe=l.safe=true;$a()}else a==="safe"&&$a()}j();g.id===","&&j(",")}e();break;case "/*globals":case "/*global":l.safe&&f("adsafe_a",this);a:for(var c;;){if(g.id!=="(string)"&&!g.identifier)break a;a=g.value;j();c=false;if(g.id===":"){j(":");switch(g.id){case "true":c=P[a]!==false;j("true");break;case "false":j("false");break;default:i("unexpected_a")}}P[a]=c;if(g.id!==",")break a;j(",")}break;default:i("unpexpected_a",this)}Ba=b;j("*/")}function w(a){g.edge=
!v||v.open&&(a||true)}function G(a){var b,c;if(typeof a==="number")v={at:a,open:true,was:c};else if(v){c=v;b=a==="var"||g.line!==n.line&&a!=="statement";v={at:(b||a==="control"?c.at+l.indent:c.at)+(c.wrap?l.indent:0),mode:a,open:b,was:c};a==="var"&&b&&(da=v)}else v={at:1,mode:"statement",open:true}}function y(a,b){if(a){if(v&&v.open){v.at=v.at-l.indent;w()}j(a,b)}if(v)v=v.was}function A(a,b){b=b||g;b.id!=="(end)"&&!l.white&&(n.line!==b.line||n.thru+1!==b.from)&&f("expected_space_a_b",b,n.value,b.value)}
function sa(a,b){a=a||n;b=b||g;b.id!=="(end)"&&(a.line!==b.line||!l.white&&a.thru+1!==b.from)&&f("expected_space_a_b",b,a.value,b.value)}function x(a,b){a=a||n;b=b||g;(!l.white||s==="styleproperty"||s==="style")&&a.thru!==b.from&&a.line===b.line&&f("unexpected_space_a_b",b,a.value,b.value)}function D(a,b){a=a||n;b=b||g;b.id!=="(end)"&&(a.line!==b.line||!l.white&&a.thru!==b.from)&&f("unexpected_space_a_b",b,a.value,b.value)}function F(a,b){if(!l.white){a=a||n;b=b||g;a.thru===b.from&&a.line===b.line&&
f("missing_space_a_b",b,a.value,b.value)}}function H(){if(g.id!==",")k("expected_a_b",n.line,n.thru,",",g.value);else{l.white||D();j(",");m();F()}}function U(){if(g.id!==";")k("expected_a_b",n.line,n.thru,";",g.value);else{l.white||D();j(";");m();Kb[g.id]!==true&&F()}}function La(){if(g.value==="use strict"){la&&f("unnecessary_use");w();j();U();la=true;l.newcap=false;l.undef=false;return true}return false}function R(a,b){if(a===b)return true;if(Array.isArray(a)){if(Array.isArray(b)&&a.length===b.length){var c;
for(c=0;c<a.length;c=c+1)if(!R(a[c],b[c]))return false;return true}return false}if(Array.isArray(b))return false;if(a.arity===b.arity&&a.value===b.value)switch(a.arity){case "prefix":case "suffix":case void 0:return a.id===b.id&&R(a.first,b.first);case "infix":return R(a.first,b.first)&&R(a.second,b.second);case "ternary":return R(a.first,b.first)&&R(a.second,b.second)&&R(a.third,b.third);case "function":case "regexp":break;default:return true}else{if(a.id==="."&&b.id==="["&&b.arity==="infix")return a.second.value===
b.second.value&&b.second.id==="(string)";if(a.id==="["&&a.arity==="infix"&&b.id===".")return a.second.value===b.second.value&&a.second.id==="(string)"}return false}function q(a,b){var c;g.id==="(end)"&&i("unexpected_a",n,g.id);j();l.safe&&z[n.value]&&z[n.value]===ya[n.value]&&g.id!=="("&&g.id!=="."&&f("adsafe",n);if(b){Za="anonymous";p["(verb)"]=n.value}if(b===true&&n.fud)c=n.fud();else{if(n.nud)c=n.nud();else{if(g.id==="(number)"&&n.id==="."){f("leading_decimal_a",n,g.value);j();return n}i("expected_identifier_a",
n,n.id)}for(;a<g.lbp;){j();n.led?c=n.led(c):i("expected_operator_a",n,n.id)}}return c}function Ca(a,b){var c=X[a];if(!c||typeof c!=="object")X[a]=c={id:a,lbp:b,value:a};return c}function L(a){return Ca(a,0)}function ma(a){a.postscript=true;return a}function ab(a){var b=Ca(a,0);b.from=1;b.thru=1;b.line=0;b.edge=true;a.value=a;return ma(b)}function Q(a,b){var c=L(a);c.identifier=c.reserved=true;c.fud=b;return c}function Ma(a,b){Q(a,b).labeled=true}function Na(a,b){Q(a,b).disrupt=true}function rb(a){var b=
a.id.charAt(0);if(b>="a"&&b<="z"||b>="A"&&b<="Z")a.identifier=a.reserved=true;return a}function O(a,b,c){var d=Ca(a,150);rb(d);d.nud=typeof b==="function"?b:function(){a==="typeof"?A():D();this.first=q(150);this.arity="prefix";if(this.id==="++"||this.id==="--")l.plusplus?(!this.first.identifier||this.first.reserved)&&this.first.id!=="."&&this.first.id!=="["&&f("bad_operand",this):f("unexpected_a",this);this.type=c;return this};return d}function fa(a,b,c){a=L(a);a.arity=a.type=b;if(c)a.nud=c;return a}
function bb(a){return(a=a.identifier&&z[a.value]||a)&&a.type}function I(a,b,c){var d="",e,g,h;if(typeof a!=="string"){g=a.identifier&&z[a.value]||a;a=g.type}h=b.identifier&&z[b.value]||b;e=h.type;if(a)e?a===e?d=a:l.type||f("type_inconsistency_a_b",c||b,a,e):h.type=d=a;else if(e){if(g)g.type=e;d=e}return d}function B(a,b){var c=L(a);c.identifier=c.reserved=true;if(typeof b==="function")c.nud=b;return c}function ta(b,c,d){b=B(b);b.type=c;b.value=d;b.nud=a;return b}function cb(a,b){return B(a,function(){typeof b===
"function"&&b(this);return this})}function M(a,b,c,d,e){a=Ca(a,b);rb(a);a.led=function(a){this.arity="infix";if(!e){F(T,n);F()}!l.bitwise&&this.bitwise&&f("unexpected_a",this);if(typeof c==="function")return c(a,this);this.first=a;this.second=q(b);return this};if(d)a.type=d;return a}function Z(a,b){a.assign&&f(b||E.conditional_assignment,a);return a}function aa(a,b){switch(a.id){case "[":case "-":a.arity!=="infix"&&f(b||E.weird_condition,a);break;case "false":case "function":case "Infinity":case "NaN":case "null":case "true":case "undefined":case "void":case "(number)":case "(regexp)":case "(string)":case "{":f(b||
E.weird_condition,a);break;case "(":a.first.id==="."&&Lb[a.first.second.value]===true&&f(b||E.weird_condition,a)}return a}function sb(a){switch(a.arity){case "prefix":switch(a.id){case "{":case "[":f("unexpected_a",a);break;case "!":f("confusing_a",a)}break;case "function":case "regexp":f("unexpected_a",a);break;default:a.id==="NaN"&&f("isnan",a)}return a}function ha(a,b){return M(a,100,function(a,c){sb(a);b&&!l.eqeq&&f("expected_a_b",c,b,c.id);var d=q(100);(R(a,d)||(a.id==="(string)"||a.id==="(number)")&&
(d.id==="(string)"||d.id==="(number)"))&&f("weird_relation",c);c.first=a;c.second=sb(d);I(a,c.second,c);return c},"boolean")}function Y(a,b){var c=M(a,20,function(a,b){var c;b.first=a;if(a.identifier)z[a.value]?z[a.value].writeable===false&&f("read_only",a):i("read_only");else if(l.safe){c=a;do{typeof P[c.value]==="boolean"&&f("adsafe",c);c=c.first}while(c)}a===X["function"]&&f("identifier_function",n);if(a.id==="."||a.id==="["){(!a.first||a.first.value==="arguments")&&f("bad_assignment",b);b.second=
q(19);b.id==="="&&R(b.first,b.second)&&f("weird_assignment",b)}else if(a.identifier&&!a.reserved){p[a.value]==="exception"&&f("assign_exception",a);b.second=q(19);b.id==="="&&R(b.first,b.second)&&f("weird_assignment",b);if(b.type){I(a,b);I(b,b.second,b)}else I(a,b.second,b)}return b});c.assign=true;if(b){if(X[b].type)c.type=X[b].type;if(X[b].bitwise)c.bitwise=true}return c}function ua(a,b){var c=M(a,b,"number");c.bitwise=true;return c}function tb(a){a=Ca(a,150);a.led=function(a){D(T,n);l.plusplus?
(!a.identifier||a.reserved)&&a.id!=="."&&a.id!=="["&&f("bad_operand",this):f("unexpected_a",this);this.first=a;this.arity="suffix";return this};return a}function na(){if(g.identifier){j();l.safe&&Oa[n.value]?f("adsafe_a",n):n.reserved&&!l.es5&&f("expected_identifier_a_reserved",n);return n.value}}function db(){var a,b=z;if(g.id===";"){f("unexpected_a");U()}else{if(g.identifier&&!g.reserved&&r().id===":"){w("label");a=g;j();m();j(":");m();z=Object.create(b);K(a,"label");g.labeled!==true?f("label_a_b",
g,a.value,g.value):eb.test(a.value+":")?f("url",a):p===W&&i("unexpected_a",n);g.label=a}w();G("statement");if(a=q(0,true))if(a.arity==="statement")a.id==="switch"||a.block&&a.id!=="do"?F():U();else{a.id==="("?a.first.id==="new"&&f("bad_new"):!a.assign&&a.id!=="delete"&&a.id!=="++"&&a.id!=="--"&&f("assignment_function_expression",n);U()}y();z=b;return a}}function oa(){for(var a=[],b,c;g.postscript!==true;)if(g.id===";"){f("unexpected_a",g);U()}else{if(g.value==="use strict"){(!Ja||p!==W||a.length>
0)&&f("function_strict");La()}if(b){f("unreachable_a_b",g,g.value,b.value);b=null}if(c=db()){a.push(c);if(c.disrupt){b=c;a.disrupt=true}}}return a}function ba(a){var b,c=g,d=Da,e=z,h=la;Da=a;z=Object.create(z);F();if(g.id==="{"){j("{");G();!a&&!La()&&!h&&!l.sloppy&&p["(context)"]===W&&f("missing_use_strict");b=oa();la=h;y("}",c);m()}else if(a){f("expected_a_b",g,"{",g.value);b=[db()];b.disrupt=b[0].disrupt}else i("expected_a_b",g,"{",g.value);p["(verb)"]=null;z=e;Da=d;a&&b.length===0&&f("empty_block");
return b}function Pa(a){ea&&typeof ea[a]!=="boolean"&&f("unexpected_property_a",n,a);pa[a]=typeof pa[a]==="number"?pa[a]+1:1}function fb(){var a=na(true);if(!a)if(g.id==="(string)"){a=g.value;l.safe&&(Oa[a]?f("adsafe_a"):(a.charAt(0)==="_"||a.charAt(a.length-1)==="_")&&f("dangling_a"));j()}else if(g.id==="(number)"){a=g.value.toString();j()}return a}function C(a){var b=0;if(a)if(Array.isArray(a))a.forEach(function(a){b=b+C(a)});else switch(a.arity){case "statement":switch(a.id){case "if":b=b+(C(a.first)+
C(a.block)+C(a["else"])+1);break;case "while":case "do":a.first.id!=="true"&&a.first.value!==1&&(b=b+1);b=b+(C(a.first)+C(a.block));break;case "for":a.second!==void 0&&a.second.id!=="true"&&a.second.value!==1&&(b=b+1);b=b+(C(a.first)+C(a.second)+C(a.third)+C(a.block));break;case "switch":b=b+(C(a.first)+C(a.second)+a.second.length);a.second[a.second.length-1].id==="default"&&(b=b-1);break;case "try":a.second&&(b=b+1);a.third&&(b=b+1);b=b+(C(a.first)+C(a.second)+C(a.third)+C(a.block))}break;case "prefix":b=
b+C(a.first);break;case "case":case "infix":b=b+(C(a.first)+C(a.second));if(a.id==="&&"||a.id==="||")b=b+1;break;case "ternary":b=b+(C(a.first)+C(a.second)+C(a.third))}return b}function Qa(a,b){var d=p,e=l,f=ea,h=z;p={"(name)":b||"'"+(Za||"").replace(ub,c)+"'","(line)":g.line,"(context)":d,"(breakage)":0,"(loopage)":0,"(scope)":z,"(token)":a};ea=f&&Object.create(f);l=Object.create(e);z=Object.create(h);Ra.push(p);(a.name=b)&&K(a,"function",b);a.writeable=false;var k=p,i;a:{var u=g,o=[];j("(");G();
m();x();if(g.id===")"){x();y(")",u);m();i=void 0}else for(;;){w();na();o.push(n);K(n,l.unparam?"parameter":"unparam");if(g.id===",")H();else{x();y(")",u);m();i=o;break a}}}a.first=k["(params)"]=i;a.type="function";A();a.block=ba(false);p["(complexity)"]=C(a.block)+1;p=d;l=e;ea=f;z=h}function gb(){function a(){var b=g,c={};j("{");if(g.id!=="}")for(;g.id!=="(end)";){for(;g.id===",";){f("unexpected_a",g);H()}g.id!=="(string)"&&f("expected_string_a");c[g.value]===true?f("duplicate_a"):g.value==="__proto__"?
f("dangling_a"):c[g.value]=true;j();j(":");gb();if(g.id!==",")break;H();if(g.id==="}"){f("unexpected_a",n);break}}j("}",b)}function b(){var a=g;j("[");if(g.id!=="]")for(;g.id!=="(end)";){for(;g.id===",";){f("unexpected_a",g);H()}gb();if(g.id!==",")break;H();if(g.id==="]"){f("unexpected_a",n);break}}j("]",a)}switch(g.id){case "{":a();break;case "[":b();break;case "true":case "false":case "null":case "(number)":case "(string)":j();break;case "-":j("-");D();j("(number)");break;default:i("unexpected_a")}}
function hb(){if(g.identifier){j();return true}}function Sa(){if(g.id==="-"){j("-");D()}if(g.id==="(number)"){j("(number)");return true}}function ib(){if(g.id==="(string)"){j();return true}}function ga(){var a,b,c,d;if(g.identifier){d=g.value;if(d==="rgb"||d==="rgba"){j();c=g;j("(");for(a=0;a<3;a=a+1){a&&H();b=g.value;if(g.id!=="(string)"||b<0){f("expected_positive_a",g);j()}else{j();if(g.id==="%"){j("%");b>100&&f("expected_percent_a",n,b)}else b>255&&f("expected_small_a",n,b)}}if(d==="rgba"){H();
b=+g.value;(g.id!=="(string)"||b<0||b>1)&&f("expected_fraction_a",g);j();if(g.id==="%"){f("unexpected_a");j("%")}}j(")",c);return true}if(Mb[g.value]===true){j();return true}}else if(g.id==="(color)"){j();return true}return false}function t(){if(g.id==="-"){j("-");D()}if(g.id==="(number)"){j();if(g.id!=="(string)"&&vb[g.value]===true){D();j()}else+n.value!==0&&f("expected_linear_a");return true}return false}function va(){if(g.identifier)switch(g.value){case "thin":case "medium":case "thick":j();return true}else return t()}
function Ea(){if(g.identifier){if(g.value==="auto"){j();return true}}else return t()}function qa(){var a,b;if(g.identifier&&g.value==="url"){g=Aa.range("(",")");b=g.value;a=b.charAt(0);if(a==='"'||a==="'")if(b.slice(-1)!==a)f("bad_url");else{b=b.slice(1,-1);b.indexOf(a)>=0&&f("bad_url")}b||f("missing_url");l.safe&&wb.test(b)&&i("adsafe_a",g,b);Fa.push(b);j();return true}return false}function jb(a){var b=0,c,d,e,f=0;switch(typeof a){case "function":return a();case "string":if(g.identifier&&g.value===
a){j();return true}return false}for(;;){if(b>=a.length)return false;e=a[b];b=b+1;if(typeof e==="boolean")break;else if(typeof e==="number"){c=e;e=a[b];b=b+1}else c=1;for(d=false;c>0;)if(jb(e)){d=true;c=c-1}else break;if(d)return true}f=b;for(c=[];;){e=false;for(b=f;b<a.length;b=b+1)if(!c[b]&&jb(Ta[a[b]])){e=d=true;c[b]=true;break}if(!e)return d}}function xb(){for(var a;;){if(g.id==="}"||g.id==="(end)"||S&&g.id===S)break;for(;g.id===";";){f("unexpected_a");U()}for(a=void 0;g.id==="*"||g.id==="#"||
g.value==="_";){l.css||f("unexpected_a");j()}if(g.id==="-"){l.css||f("unexpected_a");j("-");g.identifier||f("expected_nonstandard_style_attribute");j();a=kb}else{if(g.identifier)if(Object.prototype.hasOwnProperty.call(Ta,g.value))a=Ta[g.value];else{a=kb;l.css||f("unrecognized_style_attribute_a")}else f("expected_style_attribute");j()}j(":");if(g.identifier&&g.value==="inherit")j();else if(!jb(a)){f("unexpected_a");j()}if(g.id==="!"){j("!");D();g.identifier&&g.value==="important"?j():f("expected_a_b",
g,"important",g.value)}g.id==="}"||g.id===S?f("expected_a_b",g,";",g.value):U()}}function lb(){if(g.identifier){Object.prototype.hasOwnProperty.call(mb,l.cap?g.value.toLowerCase():g.value)||f("expected_tagname_a");j()}else switch(g.id){case ">":case "+":j();lb();break;case ":":j(":");switch(g.value){case "active":case "after":case "before":case "checked":case "disabled":case "empty":case "enabled":case "first-child":case "first-letter":case "first-line":case "first-of-type":case "focus":case "hover":case "last-child":case "last-of-type":case "link":case "only-of-type":case "root":case "target":case "visited":j();
break;case "lang":j();j("(");g.identifier||f("expected_lang_a");j(")");break;case "nth-child":case "nth-last-child":case "nth-last-of-type":case "nth-of-type":j();j("(");if(g.id==="(number)"){j();if(g.value==="n"&&g.identifier){D();j();if(g.id==="+"){D();j("+");D();j("(number)")}}}else g.identifier&&(g.value==="odd"||g.value==="even")?j():f("unexpected_a");j(")");break;case "not":j();j("(");g.id===":"&&r(0).value==="not"&&f("not");lb();j(")");break;default:f("expected_pseudo_a")}break;case "#":j("#");
g.identifier||f("expected_id_a");j();break;case "*":j("*");break;case ".":j(".");g.identifier||f("expected_class_a");j();break;case "[":j("[");g.identifier||f("expected_attribute_a");j();if(g.id==="="||g.value==="~="||g.value==="$="||g.value==="|="||g.id==="*="||g.id==="^="){j();g.id!=="(string)"&&f("expected_string_a");j()}j("]");break;default:i("expected_selector_a")}}function yb(){for(;g.id!=="</"&&g.id!=="(end)";){a:for(g.id==="{"&&f("expected_style_pattern");;){lb();if(g.id==="</"||g.id==="{"||
g.id==="(end)")break a;g.id===","&&H()}s="styleproperty";if(g.id===";")U();else{j("{");xb();s="style";j("}")}}}function zb(){for(;g.id==="@";){r();j("@");if(g.identifier)switch(g.value){case "import":j();if(!qa()){f("expected_a_b",g,"url",g.value);j()}U();break;case "media":for(j();;){(!g.identifier||Ab[g.value]===true)&&i("expected_media_a");j();if(g.id!==",")break;H()}j("{");yb();j("}");break;default:f("expected_at_a")}else f("expected_at_a")}yb()}var V,Ga,Ha,ia,Za,Ua,Nb={"<":true,"<=":true,"==":true,
"===":true,"!==":true,"!=":true,">":true,">=":true,"+":true,"-":true,"*":true,"/":true,"%":true},Oa={arguments:true,callee:true,caller:true,constructor:true,eval:true,prototype:true,stack:true,unwatch:true,valueOf:true,watch:true},nb,Gb={clearInterval:false,clearTimeout:false,document:false,event:false,frames:false,history:false,Image:false,localStorage:false,location:false,name:false,navigator:false,Option:false,parent:false,screen:false,sessionStorage:false,setInterval:false,setTimeout:false,Storage:false,
window:false,XMLHttpRequest:false},E={a_label:"'{a}' is a statement label.",a_not_allowed:"'{a}' is not allowed.",a_not_defined:"'{a}' is not defined.",a_scope:"'{a}' used out of scope.",adsafe:"ADsafe violation.",adsafe_a:"ADsafe violation: '{a}'.",adsafe_autocomplete:"ADsafe autocomplete violation.",adsafe_bad_id:"ADSAFE violation: bad id.",adsafe_div:"ADsafe violation: Wrap the widget in a div.",adsafe_fragment:"ADSAFE: Use the fragment option.",adsafe_go:"ADsafe violation: Misformed ADSAFE.go.",
adsafe_html:"Currently, ADsafe does not operate on whole HTML documents. It operates on <div> fragments and .js files.",adsafe_id:"ADsafe violation: id does not match.",adsafe_id_go:"ADsafe violation: Missing ADSAFE.id or ADSAFE.go.",adsafe_lib:"ADsafe lib violation.",adsafe_lib_second:"ADsafe: The second argument to lib must be a function.",adsafe_missing_id:"ADSAFE violation: missing ID_.",adsafe_name_a:"ADsafe name violation: '{a}'.",adsafe_placement:"ADsafe script placement violation.",adsafe_prefix_a:"ADsafe violation: An id must have a '{a}' prefix",
adsafe_script:"ADsafe script violation.",adsafe_source:"ADsafe unapproved script source.",adsafe_subscript_a:"ADsafe subscript '{a}'.",adsafe_tag:"ADsafe violation: Disallowed tag '{a}'.",already_defined:"'{a}' is already defined.",and:"The '&&' subexpression should be wrapped in parens.",assign_exception:"Do not assign to the exception parameter.",assignment_function_expression:"Expected an assignment or function call and instead saw an expression.",attribute_case_a:"Attribute '{a}' not all lower case.",
avoid_a:"Avoid '{a}'.",bad_assignment:"Bad assignment.",bad_color_a:"Bad hex color '{a}'.",bad_constructor:"Bad constructor.",bad_entity:"Bad entity.",bad_html:"Bad HTML string",bad_id_a:"Bad id: '{a}'.",bad_in_a:"Bad for in variable '{a}'.",bad_invocation:"Bad invocation.",bad_name_a:"Bad name: '{a}'.",bad_new:"Do not use 'new' for side effects.",bad_number:"Bad number '{a}'.",bad_operand:"Bad operand.",bad_type:"Bad type.",bad_url:"Bad url string.",bad_wrap:"Do not wrap function literals in parens unless they are to be immediately invoked.",
combine_var:"Combine this with the previous 'var' statement.",conditional_assignment:"Expected a conditional expression and instead saw an assignment.",confusing_a:"Confusing use of '{a}'.",confusing_regexp:"Confusing regular expression.",constructor_name_a:"A constructor name '{a}' should start with an uppercase letter.",control_a:"Unexpected control character '{a}'.",css:"A css file should begin with @charset 'UTF-8';",dangling_a:"Unexpected dangling '_' in '{a}'.",dangerous_comment:"Dangerous comment.",
deleted:"Only properties should be deleted.",duplicate_a:"Duplicate '{a}'.",empty_block:"Empty block.",empty_case:"Empty case.",empty_class:"Empty class.",es5:"This is an ES5 feature.",evil:"eval is evil.",expected_a:"Expected '{a}'.",expected_a_b:"Expected '{a}' and instead saw '{b}'.",expected_a_b_from_c_d:"Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",expected_at_a:"Expected an at-rule, and instead saw @{a}.",expected_a_at_b_c:"Expected '{a}' at column {b}, not column {c}.",
expected_attribute_a:"Expected an attribute, and instead saw [{a}].",expected_attribute_value_a:"Expected an attribute value and instead saw '{a}'.",expected_class_a:"Expected a class, and instead saw .{a}.",expected_fraction_a:"Expected a number between 0 and 1 and instead saw '{a}'",expected_id_a:"Expected an id, and instead saw #{a}.",expected_identifier_a:"Expected an identifier and instead saw '{a}'.",expected_identifier_a_reserved:"Expected an identifier and instead saw '{a}' (a reserved word).",
expected_linear_a:"Expected a linear unit and instead saw '{a}'.",expected_lang_a:"Expected a lang code, and instead saw :{a}.",expected_media_a:"Expected a CSS media type, and instead saw '{a}'.",expected_name_a:"Expected a name and instead saw '{a}'.",expected_nonstandard_style_attribute:"Expected a non-standard style attribute and instead saw '{a}'.",expected_number_a:"Expected a number and instead saw '{a}'.",expected_operator_a:"Expected an operator and instead saw '{a}'.",expected_percent_a:"Expected a percentage and instead saw '{a}'",
expected_positive_a:"Expected a positive number and instead saw '{a}'",expected_pseudo_a:"Expected a pseudo, and instead saw :{a}.",expected_selector_a:"Expected a CSS selector, and instead saw {a}.",expected_small_a:"Expected a small number and instead saw '{a}'",expected_space_a_b:"Expected exactly one space between '{a}' and '{b}'.",expected_string_a:"Expected a string and instead saw {a}.",expected_style_attribute:"Excepted a style attribute, and instead saw '{a}'.",expected_style_pattern:"Expected a style pattern, and instead saw '{a}'.",
expected_tagname_a:"Expected a tagName, and instead saw {a}.",for_if:"The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",function_block:"Function statements should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",function_eval:"The Function constructor is eval.",function_loop:"Don't make functions within a loop.",function_statement:"Function statements are not invocable. Wrap the whole function invocation in parens.",
function_strict:"Use the function form of 'use strict'.",html_confusion_a:"HTML confusion in regular expression '<{a}'.",html_handlers:"Avoid HTML event handlers.",identifier_function:"Expected an identifier in an assignment and instead saw a function invocation.",implied_evil:"Implied eval is evil. Pass a function instead of a string.",infix_in:"Unexpected 'in'. Compare with undefined, or use the hasOwnProperty method instead.",insecure_a:"Insecure '{a}'.",isNaN:"Use the isNaN function to compare with NaN.",
label_a_b:"Label '{a}' on '{b}' statement.",lang:"lang is deprecated.",leading_decimal_a:"A leading decimal point can be confused with a dot: '.{a}'.",missing_a:"Missing '{a}'.",missing_a_after_b:"Missing '{a}' after '{b}'.",missing_option:"Missing option value.",missing_property:"Missing property name.",missing_space_a_b:"Missing space between '{a}' and '{b}'.",missing_url:"Missing url.",missing_use_strict:"Missing 'use strict' statement.",mixed:"Mixed spaces and tabs.",move_invocation:"Move the invocation into the parens that contain the function.",
move_var:"Move 'var' declarations to the top of the function.",name_function:"Missing name in function statement.",nested_comment:"Nested comment.",not:"Nested not.",not_a_constructor:"Do not use {a} as a constructor.",not_a_defined:"'{a}' has not been fully defined yet.",not_a_function:"'{a}' is not a function.",not_a_label:"'{a}' is not a label.",not_a_scope:"'{a}' is out of scope.",not_greater:"'{a}' should not be greater than '{b}'.",parameter_a_get_b:"Unexpected parameter '{a}' in get {b} function.",
parameter_set_a:"Expected parameter (value) in set {a} function.",radix:"Missing radix parameter.",read_only:"Read only.",redefinition_a:"Redefinition of '{a}'.",reserved_a:"Reserved name '{a}'.",scanned_a_b:"{a} ({b}% scanned).",slash_equal:"A regular expression literal can be confused with '/='.",statement_block:"Expected to see a statement and instead saw a block.",stopping:"Stopping. ",strange_loop:"Strange loop.",strict:"Strict violation.",subscript:"['{a}'] is better written in dot notation.",
tag_a_in_b:"A '<{a}>' must be within '<{b}>'.",too_long:"Line too long.",too_many:"Too many errors.",trailing_decimal_a:"A trailing decimal point can be confused with a dot: '.{a}'.",type:"type is unnecessary.",type_inconsistency_a_b:"Type inconsistency: {a} and {b}.",unclosed:"Unclosed string.",unclosed_comment:"Unclosed comment.",unclosed_regexp:"Unclosed regular expression.",unescaped_a:"Unescaped '{a}'.",unexpected_a:"Unexpected '{a}'.",unexpected_char_a_b:"Unexpected character '{a}' in {b}.",
unexpected_comment:"Unexpected comment.",unexpected_property_a:"Unexpected /*property*/ '{a}'.",unexpected_space_a_b:"Unexpected space between '{a}' and '{b}'.",unnecessary_initialize:"It is not necessary to initialize '{a}' to 'undefined'.",unnecessary_use:"Unnecessary 'use strict'.",unreachable_a_b:"Unreachable '{a}' after '{b}'.",unrecognized_style_attribute_a:"Unrecognized style attribute '{a}'.",unrecognized_tag_a:"Unrecognized tag '<{a}>'.",unsafe:"Unsafe character.",url:"JavaScript URL.",use_array:"Use the array literal notation [].",
use_braces:"Spaces are hard to count. Use {{a}}.",use_charAt:"Use the charAt method.",use_object:"Use the object literal notation {}.",use_or:"Use the || operator.",use_param:"Use a named parameter.",used_before_a:"'{a}' was used before it was defined.",var_a_not:"Variable {a} was not declared correctly.",weird_assignment:"Weird assignment.",weird_condition:"Weird condition.",weird_new:"Weird construction. Delete 'new'.",weird_program:"Weird program.",weird_relation:"Weird relation.",weird_ternary:"Weird ternary.",
wrap_immediate:"Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.",wrap_regexp:"Wrap the /regexp/ literal in parens to disambiguate the slash operator.",write_is_wrong:"document.write can be a form of eval."},Ba,Ta,kb,Mb={aliceblue:true,antiquewhite:true,aqua:true,aquamarine:true,azure:true,beige:true,bisque:true,black:true,blanchedalmond:true,blue:true,blueviolet:true,brown:true,
burlywood:true,cadetblue:true,chartreuse:true,chocolate:true,coral:true,cornflowerblue:true,cornsilk:true,crimson:true,cyan:true,darkblue:true,darkcyan:true,darkgoldenrod:true,darkgray:true,darkgreen:true,darkkhaki:true,darkmagenta:true,darkolivegreen:true,darkorange:true,darkorchid:true,darkred:true,darksalmon:true,darkseagreen:true,darkslateblue:true,darkslategray:true,darkturquoise:true,darkviolet:true,deeppink:true,deepskyblue:true,dimgray:true,dodgerblue:true,firebrick:true,floralwhite:true,
forestgreen:true,fuchsia:true,gainsboro:true,ghostwhite:true,gold:true,goldenrod:true,gray:true,green:true,greenyellow:true,honeydew:true,hotpink:true,indianred:true,indigo:true,ivory:true,khaki:true,lavender:true,lavenderblush:true,lawngreen:true,lemonchiffon:true,lightblue:true,lightcoral:true,lightcyan:true,lightgoldenrodyellow:true,lightgreen:true,lightpink:true,lightsalmon:true,lightseagreen:true,lightskyblue:true,lightslategray:true,lightsteelblue:true,lightyellow:true,lime:true,limegreen:true,
linen:true,magenta:true,maroon:true,mediumaquamarine:true,mediumblue:true,mediumorchid:true,mediumpurple:true,mediumseagreen:true,mediumslateblue:true,mediumspringgreen:true,mediumturquoise:true,mediumvioletred:true,midnightblue:true,mintcream:true,mistyrose:true,moccasin:true,navajowhite:true,navy:true,oldlace:true,olive:true,olivedrab:true,orange:true,orangered:true,orchid:true,palegoldenrod:true,palegreen:true,paleturquoise:true,palevioletred:true,papayawhip:true,peachpuff:true,peru:true,pink:true,
plum:true,powderblue:true,purple:true,red:true,rosybrown:true,royalblue:true,saddlebrown:true,salmon:true,sandybrown:true,seagreen:true,seashell:true,sienna:true,silver:true,skyblue:true,slateblue:true,slategray:true,snow:true,springgreen:true,steelblue:true,tan:true,teal:true,thistle:true,tomato:true,turquoise:true,violet:true,wheat:true,white:true,whitesmoke:true,yellow:true,yellowgreen:true,activeborder:true,activecaption:true,appworkspace:true,background:true,buttonface:true,buttonhighlight:true,
buttonshadow:true,buttontext:true,captiontext:true,graytext:true,highlight:true,highlighttext:true,inactiveborder:true,inactivecaption:true,inactivecaptiontext:true,infobackground:true,infotext:true,menu:true,menutext:true,scrollbar:true,threeddarkshadow:true,threedface:true,threedhighlight:true,threedlightshadow:true,threedshadow:true,window:true,windowframe:true,windowtext:true},wa,ob,vb={"%":true,cm:true,em:true,ex:true,"in":true,mm:true,pc:true,pt:true,px:true},Ab,Va,Ob={b:"\u0008",t:"\t",n:"\n",
f:"\u000c",r:"\r",'"':'"',"/":"/","\\":"\\"},Fb={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},Db={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","'":"\\'",'"':'\\"',"/":"\\/","\\":"\\\\"},p,Ia=["closure","exception","global","label","outer","undef","unused","var"],Ra,W,ya,mb={a:{},abbr:{},acronym:{},address:{},applet:{},area:{empty:true,parent:" map "},article:{},aside:{},audio:{},b:{},base:{empty:true,parent:" head "},bdo:{},big:{},blockquote:{},body:{parent:" html noframes "},
br:{empty:true},button:{},canvas:{parent:" body p div th td "},caption:{parent:" table "},center:{},cite:{},code:{},col:{empty:true,parent:" table colgroup "},colgroup:{parent:" table "},command:{parent:" menu "},datalist:{},dd:{parent:" dl "},del:{},details:{},dialog:{},dfn:{},dir:{},div:{},dl:{},dt:{parent:" dl "},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},frame:{empty:true,parent:" frameset "},frameset:{parent:" html frameset "},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},head:{parent:" html "},
header:{},hgroup:{},hr:{empty:true},"hta:application":{empty:true,parent:" head "},html:{parent:"*"},i:{},iframe:{},img:{empty:true},input:{empty:true},ins:{},kbd:{},keygen:{},label:{},legend:{parent:" details fieldset figure "},li:{parent:" dir menu ol ul "},link:{empty:true,parent:" head "},map:{},mark:{},menu:{},meta:{empty:true,parent:" head noframes noscript "},meter:{},nav:{},noframes:{parent:" html body "},noscript:{parent:" body head noframes "},object:{},ol:{},optgroup:{parent:" select "},
option:{parent:" optgroup select "},output:{},p:{},param:{empty:true,parent:" applet object "},pre:{},progress:{},q:{},rp:{},rt:{},ruby:{},samp:{},script:{empty:true,parent:" body div frame head iframe p pre span "},section:{},select:{},small:{},span:{},source:{},strong:{},style:{parent:" head ",empty:true},sub:{},sup:{},table:{},tbody:{parent:" table "},td:{parent:" tr "},textarea:{},tfoot:{parent:" table "},th:{parent:" tr "},thead:{parent:" table "},time:{},title:{parent:" head "},tr:{parent:" table tbody thead tfoot "},
tt:{},u:{},ul:{},"var":{},video:{}},Wa,Da,v,ca,ja,Aa,xa,za,pa,Ib={Buffer:false,clearInterval:false,clearTimeout:false,console:false,exports:false,global:false,module:false,process:false,querystring:false,require:false,setInterval:false,setTimeout:false,__dirname:false,__filename:false},Ja,Lb={indexOf:true,lastIndexOf:true,search:true},g,ra,l,P,pb,T,ea,Pb={g:true,i:true,m:true},Eb={defineClass:false,deserialize:false,gc:false,help:false,load:false,loadClass:false,print:false,quit:false,readFile:false,
readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},z,Kb={";":true,'"':true,"'":true,")":true},qb,N,Qb={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,eval:false,EvalError:false,Function:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,RegExp:false,String:false,
SyntaxError:false,TypeError:false,URIError:false},Rb={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,PI:true,POSITIVE_INFINITY:true,SQRT1_2:true,SQRT2:true},la,X={},Xa,n,Fa,da,Ka,Jb={alert:true,animator:true,appleScript:true,beep:true,bytesToUIString:true,Canvas:true,chooseColor:true,chooseFile:true,chooseFolder:true,closeWidget:true,COM:true,convertPathToHFS:true,convertPathToPlatform:true,CustomAnimation:true,escape:true,FadeAnimation:true,
filesystem:true,Flash:true,focusWidget:true,form:true,FormField:true,Frame:true,HotKey:true,Image:true,include:true,isApplicationRunning:true,iTunes:true,konfabulatorVersion:true,log:true,md5:true,MenuItem:true,MoveAnimation:true,openURL:true,play:true,Point:true,popupMenu:true,preferenceGroups:true,preferences:true,print:true,prompt:true,random:true,Rectangle:true,reloadWidget:true,ResizeAnimation:true,resolvePath:true,resumeUpdates:true,RotateAnimation:true,runCommand:true,runCommandInBg:true,saveAs:true,
savePreferences:true,screen:true,ScrollBar:true,showWidgetPreferences:true,sleep:true,speak:true,Style:true,suppressUpdates:true,system:true,tellWidget:true,Text:true,TextArea:true,Timer:true,unescape:true,updateNow:true,URL:true,Web:true,widget:true,Window:true,XMLDOM:true,XMLHttpRequest:true,yahooCheckLogin:true,yahooLogin:true,yahooLogout:true},Hb={ActiveXObject:false,CScript:false,Debug:false,Enumerator:false,System:false,VBArray:false,WScript:false},s,S,Sb=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i,
Tb=/\r/g,Ub=/\r\n/g,Vb=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Wb=/[\[\]\/\\"'*<>.&:(){}+=#]/,Bb=/^\s*(['"=>\/&#]|<(?:\/|\!(?:--)?)?|[a-zA-Z][a-zA-Z0-9_\-:]*|[0-9]+|--)/,Cb=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,eb=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Xb=/\*\/|\/\*/,ub=/[\u0000-\u001f'\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
Yb=/[>&]|<[\/!]?|--/,Zb=/[^a-zA-Z0-9+\-_\/ ]/,$b=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jslint|properties|property|members?|globals?)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,wb=/&|\+|\u00AD|\.\.|\/\*|%[^;]|base64|url|expression|data|mailto/i,ac={outer:Bb,html:Bb,style:/^\s*([{:#%.=,>+\[\]@()"';]|\*=?|\$=|\|=|\^=|~=|[a-zA-Z_][a-zA-Z0-9_\-]*|[0-9]+|<\/|\/\*)/,
styleproperty:/^\s*([@#!"'};:\-%.=,+\[\]()*_]|[a-zA-Z][a-zA-Z0-9._\-]*|\/\*?|\d+(?:\.\d+)?|<\/)/};if(typeof Array.prototype.filter!=="function")Array.prototype.filter=function(a){var b,c=this.length,d=[],e;for(b=0;b<c;b=b+1)try{e=this[b];a(e)&&d.push(e)}catch(f){}return d};if(typeof Array.prototype.forEach!=="function")Array.prototype.forEach=function(a){var b,c=this.length;for(b=0;b<c;b=b+1)try{a(this[b])}catch(d){}return[]};if(typeof Array.isArray!=="function")Array.isArray=function(a){return Object.prototype.toString.apply(a)===
"[object Array]"};if(!Object.prototype.hasOwnProperty.call(Object,"create"))Object.create=function(a){b.prototype=a;return new b};if(typeof Object.keys!=="function")Object.keys=function(a){var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};if(typeof String.prototype.entityify!=="function")String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};if(typeof String.prototype.isAlpha!=="function")String.prototype.isAlpha=
function(){return this>="a"&&this<="z\uffff"||this>="A"&&this<="Z\uffff"};if(typeof String.prototype.isDigit!=="function")String.prototype.isDigit=function(){return this>="0"&&this<="9"};if(typeof String.prototype.supplant!=="function")String.prototype.supplant=function(a){return this.replace(/\{([^{}]*)\}/g,function(b,c){var d=a[c];return typeof d==="string"||typeof d==="number"?d:b})};Aa=function(){function a(b,c,d,e){c={comment:b,quote:c,at:e,line:d};Ba||qb||s&&s!=="script"&&s!=="style"&&s!=="styleproperty"?
k("unexpected_comment",d,f):s==="script"&&/<\//i.test(m)?k("unexpected_a",d,f,"</"):l.safe&&Sb.test(b)&&k("dangerous_comment",d,e);ra.comments?ra.comments.push(c):ra.comments=[c];JAYLINT.comments.push(c)}function b(){var a;if(j>=xa.length)return false;f=1;m=xa[j];j=j+1;a=m.search(/ \t/);a>=0&&k("mixed",j,a+1);m=m.replace(/\t/g,Xa);a=m.search(Vb);a>=0&&k("unsafe",j,a);l.maxlen&&l.maxlen<m.length&&k("too_long",j,m.length);return true}function c(a,b,d){var e;(a==="(string)"||a==="(range)")&&eb.test(b)&&
k("url",j,h);e=Object.create(X[a==="(punctuator)"||a==="(identifier)"&&Object.prototype.hasOwnProperty.call(X,b)?b:a]||X["(error)"]);if(a==="(identifier)"){e.identifier=true;b==="__iterator__"||b==="__proto__"?u("reserved_a",j,h,b):!l.nomen&&(b.charAt(0)==="_"||b.charAt(b.length-1)==="_")&&k("dangling_a",j,h,b)}if(b!==void 0)e.value=b;if(d)e.quote=d;e.line=j;e.from=h;e.thru=f;e.prev=ra;pb=(a=e.id)&&("(,=:[!&|?{};".indexOf(a.charAt(a.length-1))>=0||a==="return");return ra=ra.next=e}function d(a){function e(a){var b=
parseInt(m.substr(i+1,a),16);i=i+a;b>=32&&b<=126&&b!==34&&b!==92&&b!==39&&k("unexpected_a",j,f,"\\");f=f+a;g=String.fromCharCode(b)}var g,i,Ya="";ja&&a!=='"'&&k("expected_a",j,f,'"');if(S===a||s==="scriptstring"&&!S)return c("(punctuator)",a);for(i=0;;){for(;i>=m.length;){i=0;(s!=="html"||!b())&&u("unclosed",j,h)}g=m.charAt(i);if(g===a){f=f+1;m=m.slice(i+1);return c("(string)",Ya,a)}if(g<" "){if(g==="\n"||g==="\r")break;k("control_a",j,f+o,m.slice(0,o))}else if(g===S)k("bad_html",j,f+i);else if(g===
"<")l.safe&&s==="html"?k("adsafe_a",j,f+o,g):m.charAt(o+1)==="/"&&(s||l.safe)?k("expected_a_b",j,f,"<\\/","</"):m.charAt(o+1)==="!"&&(s||l.safe)&&k("unexpected_a",j,f,"<!");else if(g==="\\")if(s==="html")l.safe&&k("adsafe_a",j,f+o,g);else if(s==="styleproperty"){i=i+1;f=f+1;g=m.charAt(i);g!==a&&k("unexpected_a",j,f,"\\")}else{i=i+1;f=f+1;g=m.charAt(i);switch(g){case "":l.es5||k("es5",j,f);b();i=-1;break;case S:k("bad_html",j,f+i);break;case "'":ja&&k("unexpected_a",j,f,"\\'");break;case "u":e(4);
break;case "v":ja&&k("unexpected_a",j,f,"\\v");g="\v";break;case "x":ja&&k("unexpected_a",j,f,"\\x");e(2);break;default:g=Ob[g];typeof g!=="string"&&k("unexpected_a",j,f,"\\")}}Ya=Ya+g;f=f+1;i=i+1}}function e(){for(var a,b,d=0,i=0;;){a=true;g=m.charAt(i);i=i+1;switch(g){case "":u("unclosed_regexp",j,h);return;case "/":d>0&&k("unescaped_a",j,h+i,"/");g=m.slice(0,i-1);for(d=Object.create(Pb);d[m.charAt(i)]===true;){d[m.charAt(i)]=false;i=i+1}m.charAt(i).isAlpha()&&u("unexpected_a",j,h,m.charAt(i));
f=f+i;m=m.slice(i);i=m.charAt(0);(i==="/"||i==="*")&&u("confusing_regexp",j,h);return c("(regexp)",g);case "\\":g=m.charAt(i);g<" "?k("control_a",j,h+i,""+g):g==="<"&&k(E.unexpected_a,j,h+i,"\\");i=i+1;break;case "(":d=d+1;a=false;if(m.charAt(i)==="?"){i=i+1;switch(m.charAt(i)){case ":":case "=":case "!":i=i+1;break;default:k(E.expected_a_b,j,h+i,":",m.charAt(i))}}break;case "|":a=false;break;case ")":d===0?k("unescaped_a",j,h+i,")"):d=d-1;break;case " ":for(o=1;m.charAt(i)===" ";){i=i+1;o=o+1}o>
1&&k("use_braces",j,h+i,o);break;case "[":g=m.charAt(i);if(g==="^"){i=i+1;l.regexp?m.charAt(i)==="]"&&u("unescaped_a",j,h+i,"^"):k("insecure_a",j,h+i,g)}b=false;if(g==="]"){k("empty_class",j,h+i-1);b=true}a:do{g=m.charAt(i);i=i+1;switch(g){case "[":case "^":k("unescaped_a",j,h+i,g);b=true;break;case "-":if(b)b=false;else{k("unescaped_a",j,h+i,"-");b=true}break;case "]":b||k("unescaped_a",j,h+i-1,"-");break a;case "\\":g=m.charAt(i);g<" "?k(E.control_a,j,h+i,""+g):g==="<"&&k(E.unexpected_a,j,h+i,"\\");
i=i+1;b=true;break;case "/":k("unescaped_a",j,h+i-1,"/");b=true;break;case "<":if(s==="script"){g=m.charAt(i);(g==="!"||g==="/")&&k(E.html_confusion_a,j,h+i,g)}b=true;break;default:b=true}}while(g);break;case ".":l.regexp||k("insecure_a",j,h+i,g);break;case "]":case "?":case "{":case "}":case "+":case "*":k("unescaped_a",j,h+i,g);break;case "<":if(s==="script"){g=m.charAt(i);(g==="!"||g==="/")&&k(E.html_confusion_a,j,h+i,g)}}if(a)switch(m.charAt(i)){case "?":case "+":case "*":i=i+1;m.charAt(i)===
"?"&&(i=i+1);break;case "{":i=i+1;g=m.charAt(i);(g<"0"||g>"9")&&k(E.expected_number_a,j,h+i,g);i=i+1;for(b=+g;;){g=m.charAt(i);if(g<"0"||g>"9")break;i=i+1;b=+g+b*10}a=b;if(g===","){i=i+1;a=Infinity;g=m.charAt(i);if(g>="0"&&g<="9"){i=i+1;for(a=+g;;){g=m.charAt(i);if(g<"0"||g>"9")break;i=i+1;a=+g+a*10}}}m.charAt(i)!=="}"?k(E.expected_a_b,j,h+i,"}",g):i=i+1;m.charAt(i)==="?"&&(i=i+1);b>a&&k(E.not_greater,j,h+i,b,a)}}g=m.slice(0,i-1);f=f+i;m=m.slice(i);return c("(regexp)",g)}var f,g,h,i,j,o,m;return{init:function(a){xa=
typeof a==="string"?a.replace(Ub,"\n").replace(Tb,"\n").split("\n"):a;j=0;b();h=1},range:function(a,b){var d,e="";h=f;for(m.charAt(0)!==a&&u("expected_a_b",j,f,a,m.charAt(0));;){m=m.slice(1);f=f+1;d=m.charAt(0);switch(d){case "":u("missing_a",j,f,d);break;case b:m=m.slice(1);f=f+1;return c("(range)",e);case S:case "\\":k("unexpected_a",j,f,d)}e=e+d}},token:function(){for(var o,l,r;;){for(;!m;)if(!b())return c("(end)");for(;s==="outer";){l=m.search(Yb);if(l===0)break;else if(l>0){f=f+1;m=m.slice(l);
break}else if(!b())return c("(end)","")}o=(ac[s]||$b).exec(m);r=void 0;if(o){i=o[0].length;r=o[1];g=r.charAt(0);m=m.slice(i);h=f+i-r.length;f=f+i}else r=void 0;if(r){o=r.charAt(0);if(o.isAlpha()||o==="_"||o==="$")return c("(identifier)",r);if(o.isDigit()){l=r;o=void 0;s!=="style"&&s!=="styleproperty"&&m.charAt(0).isAlpha()&&k("expected_space_a_b",j,f,g,m.charAt(0));if(g==="0"){o=l.charAt(1);o.isDigit()?n.id!=="."&&s!=="styleproperty"&&k("unexpected_a",j,f,l):ja&&(o==="x"||o==="X")&&k("unexpected_a",
j,f,"0x")}l.slice(l.length-1)==="."&&k("trailing_decimal_a",j,f,l);if(s!=="style"){o=+l;isFinite(o)||k("bad_number",j,f,l);l=o}return c("(number)",l)}switch(r){case '"':case "'":return d(r);case "//":a(m,"//",j,f);m="";break;case "/*":for(o="/*";;){l=m.search(Xb);if(l>=0)break;a(m,o,j,f);o="";b()||u("unclosed_comment",j,f)}a(m.slice(0,l),o,f,j);f=f+(l+2);m.charAt(l)==="/"&&u("nested_comment",j,f);m=m.slice(l+2);break;case "":break;case "/":n.id==="/="&&u(E.slash_equal,j,h);return pb?e():c("(punctuator)",
r);case "<\!--":for(i=j;;){l=m.indexOf("--");if(l>=0)break;l=m.indexOf("<!");l>=0&&u("nested_comment",j,f+l);b()||u("unclosed_comment",i,o)}i=m.indexOf("<!");i>=0&&i<l&&u("nested_comment",j,f+i);f=f+l;m.charAt(l+2)!==">"&&u("expected_a",j,f,"--\>");f=f+3;m=m.slice(l+3);break;case "#":if(s==="html"||s==="styleproperty"){for(;;){o=m.charAt(0);if((o<"0"||o>"9")&&(o<"a"||o>"f")&&(o<"A"||o>"F"))break;f=f+1;m=m.slice(1);r=r+o}r.length!==4&&r.length!==7&&k("bad_color_a",j,h+i,r);return c("(color)",r)}return c("(punctuator)",
r);default:if(s==="outer"&&o==="&"){f=f+1;for(m=m.slice(1);;){o=m.charAt(0);f=f+1;m=m.slice(1);if(o===";")break;o>="0"&&o<="9"||o>="a"&&o<="z"||o==="#"||u("bad_entity",j,h+i,f)}break}return c("(punctuator)",r)}}else{for(;m&&m<"!";)m=m.slice(1);if(m){if(s==="html")return c("(error)",m.charAt(0));u("unexpected_a",j,f,m.charAt(0))}}}}}}();X["(identifier)"]={lbp:0,identifier:true,nud:function(){var a=this.value,b=z[a];if(typeof b!=="object"){b=P[a];if(typeof b==="boolean"){ya[a]=b={value:a,writeable:b,
funct:W};W[a]="var"}else{l.undef||f("used_before_a",n);z[a]=b={value:a,writeable:true,funct:p};p[a]="undef"}}b=b.funct;if(p===b)switch(p[a]){case "becoming":f("unexpected_a",n);p[a]="var";break;case "unused":p[a]="var";break;case "unparam":p[a]="parameter";break;case "unction":p[a]="function";break;case "label":f("a_label",n,a)}else switch(p[a]){case "closure":case "function":case "var":case "unused":f("a_scope",n,a);break;case "label":f("a_label",n,a);break;case "outer":case "global":break;default:switch(b[a]){case "function":case "unction":case "var":case "unused":case "becoming":case "closure":case "parameter":b[a]=
"closure";p[a]=b===W?"global":"outer";break;case "unparam":b[a]="parameter";p[a]="outer";break;case "undef":p[a]="undef";break;case "label":f("a_label",n,a)}}return this},led:function(){i("expected_operator_a")}};fa("(array)","array");fa("(color)","color");fa("(function)","function");fa("(number)","number",a);fa("(object)","object");fa("(string)","string",a);fa("(boolean)","boolean",a);fa("(range)","range");fa("(regexp)","regexp",a);ab("(begin)");ab("(end)");ab("(error)");ma(L("</"));L("<!");L("<\!--");
L("--\>");ma(L("}"));L(")");L("]");ma(L('"'));ma(L("'"));L(";");L(":");L(",");L("#");L("@");L("*/");ma(B("case"));B("catch");ma(B("default"));B("else");B("finally");cb("arguments",function(a){la&&p===W?f("strict",a):l.safe&&f("adsafe",a)});cb("eval",function(a){l.safe&&f("adsafe",a)});ta("false","boolean",false);ta("Infinity","number",Infinity);ta("NaN","number",NaN);ta("null","",null);cb("this",function(a){la&&(p["(statement)"]&&p["(name)"].charAt(0)>"Z"||p===W)?f("strict",a):l.safe&&f("adsafe",
a)});ta("true","boolean",true);ta("undefined","",void 0);M("?",30,function(a,b){b.first=aa(Z(a));b.second=q(0);F();var c=g;j(":");m();F();b.third=q(10);b.arity="ternary";b.type=I(b.second,b.third);R(b.second,b.third)?f("weird_ternary",c):R(b.first,b.second)&&f("use_or",b);return b});M("||",40,function(a,b){function c(a){a.id==="&&"&&!a.paren&&f("and",a);return a}b.first=c(aa(Z(a)));b.second=c(Z(q(40)));R(b.first,b.second)&&f("weird_condition",b);return b});M("&&",50,function(a,b){b.first=aa(Z(a));
b.second=Z(q(50));R(b.first,b.second)&&f("weird_condition",b);return b});O("void",function(){this.first=q(0);if(this.first.id!=="(number)"||this.first.value){f("unexpected_a",this);return this}this.type="undefined";return this});ua("|",70);ua("^",80);ua("&",90);ha("==","===");ha("===");ha("!=","!==");ha("!==");ha("<");ha(">");ha("<=");ha(">=");ua("<<",120);ua(">>",120);ua(">>>",120);M("in",120,function(a,b){f("infix_in",b);b.left=a;b.right=q(130);return b},"boolean");M("instanceof",120,null,"boolean");
M("+",130,function(a,b){a.value||(a.id==="(number)"?f("unexpected_a",a):a.id==="(string)"&&f("expected_a_b",a,"String","''"));var c=q(130);c.value||(c.id==="(number)"?f("unexpected_a",c):c.id==="(string)"&&f("expected_a_b",c,"String","''"));if(a.id===c.id&&(a.id==="(string)"||a.id==="(number)")){a.value=a.value+c.value;a.thru=c.thru;a.id==="(string)"&&eb.test(a.value)&&f("url",a);m(c);m(b);return a}b.first=a;b.second=c;b.type=I(a,c,b);return b});O("+","num");O("+++",function(){f("confusing_a",n);
this.first=q(150);this.arity="prefix";return this});M("+++",130,function(a){f("confusing_a",n);this.first=a;this.second=q(130);return this});M("-",130,function(a,b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&f("unexpected_a",a);var c=q(130);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&f("unexpected_a",a);if(a.id===c.id&&a.id==="(number)"){a.value=a.value-c.value;a.thru=c.thru;m(c);m(b);return a}b.first=a;b.second=c;return b},"number");O("-");O("---",function(){f("confusing_a",n);
this.first=q(150);this.arity="prefix";return this});M("---",130,function(a){f("confusing_a",n);this.first=a;this.second=q(130);return this});M("*",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&f("unexpected_a",a);var c=q(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&f("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value*c.value;a.thru=c.thru;m(c);m(b);return a}b.first=a;b.second=c;return b},"number");M("/",140,function(a,
b){(a.id==="(number)"&&a.value===0||a.id==="(string)")&&f("unexpected_a",a);var c=q(140);(c.id==="(number)"&&(c.value===0||c.value===1)||c.id==="(string)")&&f("unexpected_a",c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value/c.value;a.thru=c.thru;m(c);m(b);return a}b.first=a;b.second=c;return b},"number");M("%",140,function(a,b){(a.id==="(number)"&&(a.value===0||a.value===1)||a.id==="(string)")&&f("unexpected_a",a);var c=q(140);(c.id==="(number)"&&c.value===0||c.id==="(string)")&&f("unexpected_a",
c);if(a.id===c.id&&a.id==="(number)"){a.value=a.value%c.value;a.thru=c.thru;m(c);m(b);return a}b.first=a;b.second=c;return b},"number");tb("++");O("++");tb("--");O("--");O("delete",function(){A();var a=q(0);(!a||a.id!=="."&&a.id!=="[")&&f("deleted");this.first=a;return this});O("~",function(){D();l.bitwise||f("unexpected_a",this);q(150);return this},"number");O("!",function(){D();this.first=aa(q(150));this.arity="prefix";Nb[this.first.id]===true&&f("confusing_a",this);return this},"boolean");O("typeof",
null,"string");O("new",function(){A();var a=q(160),b;this.first=a;if(a.id!=="function")if(a.identifier)switch(a.value){case "Object":f("use_object",n);break;case "Array":if(g.id==="("){b=g;b.first=this;j("(");if(g.id!==")"){b.second=q(0);if(b.second.id!=="(string)"||!b.second.value){aa(b.second,E.use_array);a=false}else a=true;for(;g.id!==")"&&g.id!=="(end)";){if(a){f("use_array",b);a=false}j()}}else f("use_array",n);j(")",b);m();return b}f("use_array",n);break;case "Number":case "String":case "Boolean":case "Math":case "JSON":f("not_a_constructor",
a);break;case "Function":l.evil||f("function_eval");break;case "Date":case "RegExp":break;default:if(a.id!=="function"){a=a.value.charAt(0);!l.newcap&&(a<"A"||a>"Z")&&f("constructor_name_a",n)}}else a.id!=="."&&a.id!=="["&&a.id!=="("&&f("bad_constructor",n);else f("weird_new",this);g.id!=="("&&f("missing_a",g,"()");return this});M("(",160,function(a,b){v&&v.mode==="expression"?x(T,n):D(T,n);!a.immed&&a.id==="function"&&f("wrap_immediate");var c=[];if(a){I("function",a);a.identifier?a.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&
a.value!=="Number"&&a.value!=="String"&&a.value!=="Boolean"&&a.value!=="Date"&&(a.value==="Math"||a.value==="JSON"?f("not_a_function",a):a.value==="Object"?f("use_object",n):(a.value==="Array"||!l.newcap)&&f("missing_a",a,"new")):a.id==="."&&(l.safe&&a.first.value==="Math"&&a.second==="random"?f("adsafe",a):a.second.value==="split"&&a.first.id==="(string)"&&f("use_array",a.second))}G();if(g.id!==")")for(x();;){w();c.push(q(10));if(g.id!==",")break;H()}x();y(")",b);if(typeof a==="object"){a.value===
"parseInt"&&c.length===1&&f("radix",a);l.evil||(a.value==="eval"||a.value==="Function"||a.value==="execScript"?f("evil",a):c[0]&&c[0].id==="(string)"&&(a.value==="setTimeout"||a.value==="setInterval")&&f("implied_evil",a));!a.identifier&&a.id!=="."&&a.id!=="["&&a.id!=="("&&a.id!=="&&"&&a.id!=="||"&&a.id!=="?"&&f("bad_invocation",a)}b.first=a;b.second=c;if(!l.type)if(a.id===".")if(a.second.value==="charAt"||a.second.value==="substring"){I("string",b);I("string",a.first);c.forEach(function(a){I("number",
a)})}else(a.second.value==="toString"||a.second.value==="stringify")&&I("string",b);else a.identifier&&a.value==="String"&&I("string",b);return b},"",true);O("(",function(){G("expression");m();x();w();if(g.id==="function")g.immed=true;var a=q(0);a.paren=true;x();y(")",this);m();a.id==="function"&&(g.id==="("?f("move_invocation"):f("bad_wrap",this));return a});M(".",170,function(a,b){x(T,n);x();var c=na();typeof c==="string"&&Pa(c);b.first=a;b.second=n;if(a&&a.value==="arguments"&&(c==="callee"||c===
"caller"))f("avoid_a",a,"arguments."+c);else if(!l.evil&&a&&a.value==="document"&&(c==="write"||c==="writeln"))f("write_is_wrong",a);else if(l.adsafe){if(!Ha&&a.value==="ADSAFE")if(c==="id"||c==="lib")f("adsafe",b);else if(c==="go"){s!=="script"?f("adsafe",b):(ia||g.id!=="("||r(0).id!=="(string)"||r(0).value!==V||r(1).id!==",")&&i("adsafe_a",b,"go");ia=true;Ga=false}Ha=false}if(!l.evil&&(c==="eval"||c==="execScript"))f("evil");else if(l.safe)for(;;){Oa[c]===true&&f("adsafe_a",n,c);if(typeof P[a.value]!==
"boolean"||g.id==="(")break;if(Rb[c]===true){g.id==="."&&f("adsafe",b);break}if(g.id!=="."){f("adsafe",b);break}j(".");n.first=b;n.second=c;b=n;c=na();typeof c==="string"&&Pa(c)}c==="length"&&I("number",b);return b},"",true);M("[",170,function(a,b){var c=bb(a),d;D(T,n);x();G();w();d=q(0);switch(bb(d)){case "number":d.id==="(number)"&&a.id==="arguments"&&f("use_param",a);c||I("array",a);break;case "string":if(d.id==="(string)"){if(l.safe&&(Oa[d.value]||d.value.charAt(0)==="_"||d.value.slice(-1)===
"_"))f("adsafe_subscript_a",d);else if(!l.evil&&(d.value==="eval"||d.value==="execScript"))f("evil",d);else if(!l.sub&&Cb.test(d.value)){c=X[d.value];(!c||!c.reserved)&&f("subscript",d)}Pa(d.value)}else l.safe&&d.id!=="typeof"&&f("adsafe_subscript_a",d);I("object",a);break;case void 0:switch(bb(a)){case "array":I("number",d);break;case "object":I("string",d);break;case "string":l.type||f("use_charAt",b);b.type="string"}l.safe&&f("adsafe_subscript_a",d);break;default:l.safe?f("adsafe_subscript_a",
d):f("bad_type")}y("]",b);m();x(T,n);b.first=a;b.second=d;return b},"",true);O("[",function(){this.arity="prefix";this.first=[];this.type="array";for(G("array");g.id!=="(end)";){for(;g.id===",";){f("unexpected_a",g);j(",");m()}if(g.id==="]")break;v.wrap=false;w();this.first.push(q(10));if(g.id===","){H();if(g.id==="]"&&!l.es5){f("unexpected_a",n);break}}else break}y("]",this);m();return this},170);Y("=");Y("+=","+");Y("-=","-");Y("*=","*");Y("/=","/").nud=function(){i("slash_equal")};Y("%=","%");
Y("&=","&");Y("|=","|");Y("^=","^");Y("<<=","<<");Y(">>=",">>");Y(">>>=",">>>");O("{",function(){var a,b,c,d,e,h={};this.arity="prefix";this.first=[];this.type="object";for(G();g.id!=="}";){v.wrap=false;w();if(g.value==="get"&&r().id!==":"){l.es5||f("es5");a=g;j("get");sa();d=g;(b=fb())||i("missing_property");a.value="";Qa(a);p["(loopage)"]&&f("function_loop",a);(c=a.first)&&f("parameter_a_get_b",c[0],c[0].value,b);H();e=g;e.value="";F();w();j("set");sa();c=fb();b!==c&&i("expected_a_b",n,b,c||g.value);
Qa(e);c=e.first;!c||c.length!==1?i("parameter_set_a",e,"value"):c[0].value!=="value"&&i("expected_a_b",c[0],"value",c[0].value);d.first=[a,e]}else{d=g;b=fb();typeof b!=="string"&&i("missing_property");j(":");m();F();d.first=q(10)}this.first.push(d);h[b]===true&&f("duplicate_a",g,b);h[b]=true;Pa(b);if(g.id!==",")break;for(;;){H();if(g.id!==",")break;f("unexpected_a",g)}g.id==="}"&&!l.es5&&f("unexpected_a",n)}y("}",this);m();return this});Q("{",function(){m();f("statement_block");this.arity="statement";
this.block=oa();this.disrupt=this.block.disrupt;j("}",this);m();return this});Q("/*global",ka);Q("/*globals",ka);Q("/*jslint",ka);Q("/*member",ka);Q("/*members",ka);Q("/*property",ka);Q("/*properties",ka);Q("var",function(){var a,b,c;p["(vars)"]&&!l.vars?f("combine_var"):p!==W&&(p["(vars)"]=true);this.arity="statement";this.first=[];for(G("var");;){c=g;b=na();K(c,"becoming");if(g.id==="="){a=g;a.first=c;F();j("=");F();g.id==="undefined"&&f("unnecessary_initialize",n,b);r(0).id==="="&&g.identifier&&
i("var_a_not");a.second=q(0);a.arity="infix";this.first.push(a);if(a.second.type)c.type=a.second.type}else this.first.push(c);p[b]==="becoming"&&(p[b]="unused");if(g.id!==",")break;H();v.wrap=false;if(da&&g.line===n.line&&this.first.length===1){da=null;v.open=false;v.at=v.at-l.indent}F();w()}da=null;y();return this});Q("function",function(){A();Da&&f("function_block",n);var a=g,b=na();K(a,"unction");x();Qa(this,b);g.id==="("&&g.line===n.line&&i("function_statement");this.arity="statement";return this});
O("function",function(){A();var a=na();a?x():a="";Qa(this,a);p["(loopage)"]&&f("function_loop");this.arity="function";return this});Q("if",function(){var a=g;A();j("(");G("control");m();x();w();this.arity="statement";this.first=aa(Z(q(0)));x();y(")",a);m();A();this.block=ba(true);if(g.id==="else"){A();j("else");m();A();this["else"]=g.id==="if"||g.id==="switch"?db(true):ba(true);if(this["else"].disrupt&&this.block.disrupt)this.disrupt=true}return this});Q("try",function(){var a,b,c;l.adsafe&&f("adsafe_a",
this);A();this.arity="statement";this.block=ba(false);if(g.id==="catch"){A();j("catch");m();A();c=g;j("(");G("control");m();x();w();b=z;z=Object.create(b);this.first=a=g.value;g.identifier?K(g,"exception"):f("expected_identifier_a",g);j();x();y(")",c);m();A();this.second=ba(false);z=b}if(g.id==="finally"){m();A();j("finally");m();A();this.third=ba(false)}else this.second||i("expected_a_b",g,"catch",g.value);return this});Ma("while",function(){A();var a=g;p["(breakage)"]=p["(breakage)"]+1;p["(loopage)"]=
p["(loopage)"]+1;j("(");G("control");m();x();w();this.arity="statement";this.first=Z(q(0));this.first.id!=="true"&&aa(this.first,E.unexpected_a);x();y(")",a);m();A();this.block=ba(true);this.block.disrupt&&f("strange_loop",T);p["(breakage)"]=p["(breakage)"]-1;p["(loopage)"]=p["(loopage)"]-1;return this});B("with");Ma("switch",function(){var a,b=g,c=true;p["(breakage)"]=p["(breakage)"]+1;A();j("(");m();x();G();this.arity="statement";this.first=aa(Z(q(0)));x();y(")",b);m();A();j("{");G();for(this.second=
[];g.id==="case";){b=g;b.first=[];b.arity="case";F();w("case");for(j("case");;){A();a=q(0);b.first.push(a);a.id==="NaN"&&f("unexpected_a",a);D();j(":");m();if(g.id!=="case")break;F();w("case");j("case");m()}F();b.second=oa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];a.disrupt?a.id==="break"&&(c=false):f("missing_a_after_b",g,"break","case")}else f("empty_case");this.second.push(b)}this.second.length===0&&f("missing_a",g,"case");if(g.id==="default"){F();b=g;b.arity="case";w("case");
j("default");m();D();j(":");m();F();b.second=oa();if(b.second&&b.second.length>0){a=b.second[b.second.length-1];if(c&&a.disrupt&&a.id!=="break")this.disrupt=true}this.second.push(b)}p["(breakage)"]=p["(breakage)"]-1;F();y("}",this);return this});Q("debugger",function(){l.debug||f("unexpected_a",this);this.arity="statement";return this});Ma("do",function(){p["(breakage)"]=p["(breakage)"]+1;p["(loopage)"]=p["(loopage)"]+1;A();this.arity="statement";this.block=ba(true);this.block.disrupt&&f("strange_loop",
T);A();j("while");m();var a=g;A();j("(");G();m();x();w();this.first=aa(Z(q(0)),E.unexpected_a);x();y(")",a);m();p["(breakage)"]=p["(breakage)"]-1;p["(loopage)"]=p["(loopage)"]-1;return this});Ma("for",function(){var a,b,c=false;a=g;var d;this.arity="statement";p["(breakage)"]=p["(breakage)"]+1;p["(loopage)"]=p["(loopage)"]+1;j("(");G("control");m();F(this,a);x();g.id==="var"&&i("move_var");w();if(r(0).id==="in"){b=g;switch(p[b.value]){case "unused":p[b.value]="var";break;case "closure":case "var":break;
default:f("bad_in_a",b)}I("string",b);j();d=g;j("in");d.first=b;d.second=q(20);I("object",d.second);y(")",a);m();this.first=d;a=ba(true);if(!l.forin){if(a.length===1&&typeof a[0]==="object"&&a[0].value==="if"&&!a[0]["else"]){for(b=a[0].first;b.id==="&&";)b=b.first;switch(b.id){case "===":case "!==":c=b.first.id==="["?b.first.first.value===d.second.value&&b.first.second.value===d.first.value:b.first.id==="typeof"&&b.first.first.id==="["&&b.first.first.first.value===d.second.value&&b.first.first.second.value===
d.first.value;break;case "(":c=b.first.id==="."&&(b.first.first.value===d.second.value&&b.first.second.value==="hasOwnProperty"&&b.second[0].value===d.first.value||b.first.first.value==="ADSAFE"&&b.first.second.value==="has"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value||b.first.first.id==="."&&b.first.first.first.id==="."&&b.first.first.first.first.value==="Object"&&b.first.first.first.second.value==="prototype"&&b.first.first.second.value==="hasOwnProperty"&&b.first.second.value===
"call"&&b.second[0].value===d.second.value&&b.second[1].value===d.first.value)}}c||f("for_if",this)}}else{if(g.id!==";"){w();for(this.first=[];;){this.first.push(q(0,"for"));if(g.id!==",")break;H()}}U();if(g.id!==";"){w();this.second=Z(q(0));this.second.id!=="true"&&aa(this.second,E.unexpected_a)}U(n);g.id===";"&&i("expected_a_b",g,")",";");if(g.id!==")"){this.third=[];for(w();;){this.third.push(q(0,"for"));if(g.id!==",")break;H()}}x();y(")",a);m();A();a=ba(true)}a.disrupt&&f("strange_loop",T);this.block=
a;p["(breakage)"]=p["(breakage)"]-1;p["(loopage)"]=p["(loopage)"]-1;return this});Na("break",function(){var a=g.value;this.arity="statement";p["(breakage)"]===0&&f("unexpected_a",this);if(g.identifier&&n.line===g.line){sa();p[a]!=="label"?f("not_a_label",g):z[a].funct!==p&&f("not_a_scope",g);this.first=g;j()}return this});Na("continue",function(){l["continue"]||f("unexpected_a",this);var a=g.value;this.arity="statement";p["(breakage)"]===0&&f("unexpected_a",this);if(g.identifier&&n.line===g.line){sa();
p[a]!=="label"?f("not_a_label",g):z[a].funct!==p&&f("not_a_scope",g);this.first=g;j()}return this});Na("return",function(){this.arity="statement";if(g.id!==";"&&g.line===n.line){sa();(g.id==="/"||g.id==="(regexp)")&&f("wrap_regexp");this.first=q(20)}return this});Na("throw",function(){this.arity="statement";sa();this.first=q(20);return this});B("class");B("const");B("enum");B("export");B("extends");B("import");B("super");B("let");B("yield");B("implements");B("interface");B("package");B("private");
B("protected");B("public");B("static");kb=[qa,function(){for(;;)if(g.identifier)switch(g.value.toLowerCase()){case "url":qa();break;case "expression":f("unexpected_a");j();break;default:j()}else{if(g.id===";"||g.id==="!"||g.id==="(end)"||g.id==="}")return true;j()}}];wa=["none","dashed","dotted","double","groove","hidden","inset","outset","ridge","solid"];ob=["auto","always","avoid","left","right"];Ab={all:true,braille:true,embossed:true,handheld:true,print:true,projection:true,screen:true,speech:true,
tty:true,tv:true};Va=["auto","hidden","scroll","visible"];Ta={background:[true,"background-attachment","background-color","background-image","background-position","background-repeat"],"background-attachment":["scroll","fixed"],"background-color":["transparent",ga],"background-image":["none",qa],"background-position":[2,[t,"top","bottom","left","right","center"]],"background-repeat":["repeat","repeat-x","repeat-y","no-repeat"],border:[true,"border-color","border-style","border-width"],"border-bottom":[true,
"border-bottom-color","border-bottom-style","border-bottom-width"],"border-bottom-color":ga,"border-bottom-style":wa,"border-bottom-width":va,"border-collapse":["collapse","separate"],"border-color":["transparent",4,ga],"border-left":[true,"border-left-color","border-left-style","border-left-width"],"border-left-color":ga,"border-left-style":wa,"border-left-width":va,"border-right":[true,"border-right-color","border-right-style","border-right-width"],"border-right-color":ga,"border-right-style":wa,
"border-right-width":va,"border-spacing":[2,t],"border-style":[4,wa],"border-top":[true,"border-top-color","border-top-style","border-top-width"],"border-top-color":ga,"border-top-style":wa,"border-top-width":va,"border-width":[4,va],bottom:[t,"auto"],"caption-side":["bottom","left","right","top"],clear:["both","left","none","right"],clip:[function(){var a;if(g.identifier&&g.value==="rect"){j();j("(");for(a=0;a<4;a=a+1)if(!t()){f("expected_number_a");break}j(")");return true}return false},"auto"],
color:ga,content:["open-quote","close-quote","no-open-quote","no-close-quote",ib,qa,function(){if(g.identifier&&g.value==="counter"){j();j("(");j();if(g.id===","){H();g.id!=="(string)"&&f("expected_string_a");j()}j(")");return true}if(g.identifier&&g.value==="counters"){j();j("(");g.identifier||f("expected_name_a");j();if(g.id===","){H();g.id!=="(string)"&&f("expected_string_a");j()}if(g.id===","){H();g.id!=="(string)"&&f("expected_string_a");j()}j(")");return true}return false},function(){if(g.identifier&&
g.value==="attr"){j();j("(");g.identifier||f("expected_name_a");j();j(")");return true}return false}],"counter-increment":[hb,"none"],"counter-reset":[hb,"none"],cursor:[qa,"auto","crosshair","default","e-resize","help","move","n-resize","ne-resize","nw-resize","pointer","s-resize","se-resize","sw-resize","w-resize","text","wait"],direction:["ltr","rtl"],display:["block","compact","inline","inline-block","inline-table","list-item","marker","none","run-in","table","table-caption","table-cell","table-column",
"table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],"empty-cells":["show","hide"],"float":["left","none","right"],font:["caption","icon","menu","message-box","small-caption","status-bar",true,"font-size","font-style","font-weight","font-family"],"font-family":function(){for(;g.id!==";";){!hb()&&!ib()&&f("expected_name_a");if(g.id!==",")return true;H()}},"font-size":["xx-small","x-small","small","medium","large","x-large","xx-large","larger","smaller",t],"font-size-adjust":["none",
Sa],"font-stretch":["normal","wider","narrower","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded"],"font-style":["normal","italic","oblique"],"font-variant":["normal","small-caps"],"font-weight":["normal","bold","bolder","lighter",Sa],height:[t,"auto"],left:[t,"auto"],"letter-spacing":["normal",t],"line-height":["normal",function(){if(g.id==="-"){j("-");D()}if(g.id==="(number)"){j();if(g.id!=="(string)"&&vb[g.value]===true){D();j()}return true}return false}],
"list-style":[true,"list-style-image","list-style-position","list-style-type"],"list-style-image":["none",qa],"list-style-position":["inside","outside"],"list-style-type":["circle","disc","square","decimal","decimal-leading-zero","lower-roman","upper-roman","lower-greek","lower-alpha","lower-latin","upper-alpha","upper-latin","hebrew","katakana","hiragana-iroha","katakana-oroha","none"],margin:[4,Ea],"margin-bottom":Ea,"margin-left":Ea,"margin-right":Ea,"margin-top":Ea,"marker-offset":[t,"auto"],
"max-height":[t,"none"],"max-width":[t,"none"],"min-height":t,"min-width":t,opacity:Sa,outline:[true,"outline-color","outline-style","outline-width"],"outline-color":["invert",ga],"outline-style":["dashed","dotted","double","groove","inset","none","outset","ridge","solid"],"outline-width":va,overflow:Va,"overflow-x":Va,"overflow-y":Va,padding:[4,t],"padding-bottom":t,"padding-left":t,"padding-right":t,"padding-top":t,"page-break-after":ob,"page-break-before":ob,position:["absolute","fixed","relative",
"static"],quotes:[8,ib],right:[t,"auto"],"table-layout":["auto","fixed"],"text-align":["center","justify","left","right"],"text-decoration":["none","underline","overline","line-through","blink"],"text-indent":t,"text-shadow":["none",4,[ga,t]],"text-transform":["capitalize","uppercase","lowercase","none"],top:[t,"auto"],"unicode-bidi":["normal","embed","bidi-override"],"vertical-align":["baseline","bottom","sub","super","top","text-top","middle","text-bottom",t],visibility:["visible","hidden","collapse"],
"white-space":["normal","nowrap","pre","pre-line","pre-wrap","inherit"],width:[t,"auto"],"word-spacing":["normal",t],"word-wrap":["break-word","normal"],"z-index":["auto",Sa]};ca=function(a,b){var c,h,k;JAYLINT.comments=[];JAYLINT.errors=[];JAYLINT.tree="";nb=ra=T=n=g=Object.create(X["(begin)"]);P={};d(Qb);if(b){l=Object.create(b);if(h=l.predef)if(Array.isArray(h))for(c=0;c<h.length;c=c+1)P[h[c]]=true;else typeof h==="object"&&d(h);$a()}else l={};l.indent=+l.indent||0;l.maxerr=l.maxerr||50;V="";Ga=
Ha=ia=false;Ua={};if(l.approved)for(c=0;c<l.approved.length;c=c+1)Ua[l.approved[c]]=l.approved[c];else Ua.test="test";Xa="";for(c=0;c<l.indent;c=c+1)Xa=Xa+" ";ya=z={};W=p={"(scope)":z,"(breakage)":0,"(loopage)":0};Ra=[p];Ba=false;Wa={};Da=false;v=null;ja=false;za=[];pa={};Ja=false;ea=null;pb=true;qb=false;N=null;la=false;Fa=[];da=null;Ka=0;s="";Aa.init(a);e();try{j();if(g.id==="(number)")i("unexpected_a");else if(g.value.charAt(0)==="<"){a:{var m,u,o,r,K=l.white,q,y,x,A;s="html";S="";for(N=null;;){switch(g.value){case "<":s=
"html";j("<");u={};y=g;y.identifier||f("bad_name_a",y);r=y.value;l.cap&&(r=r.toLowerCase());y.name=r;j();if(!N){N=[];c=r;c!=="html"&&!l.fragment&&(c==="div"&&l.adsafe?i("adsafe_fragment"):i("expected_a_b",n,"html",c));if(l.adsafe){c==="html"&&i("adsafe_html",n);l.fragment?c!=="div"&&i("adsafe_div",n):i("adsafe_fragment",n)}l.browser=true}x=mb[r];typeof x!=="object"&&i("unrecognized_tag_a",y,r);o=x.empty;for(y.type=r;;){if(g.id==="/"){j("/");g.id!==">"&&f("expected_a_b",g,">",g.value);break}if(g.id&&
g.id.charAt(0)===">")break;if(!g.identifier){(g.id==="(end)"||g.id==="(error)")&&f("expected_a_b",g,">",g.value);f("bad_name_a")}l.white=false;F();m=g.value;l.white=K;j();!l.cap&&m!==m.toLowerCase()&&f("attribute_case_a",n);m=m.toLowerCase();S="";Object.prototype.hasOwnProperty.call(u,m)&&f("duplicate_a",n,m);if(m.slice(0,2)==="on"){l.on||f("html_handlers");s="scriptstring";j("=");q=g.id;q!=='"'&&q!=="'"&&i("expected_a_b",g,'"',g.value);S=q;A=l.white;l.white=true;j(q);La();oa();l.white=A;g.id!==q&&
i("expected_a_b",g,q,g.value);s="html";S="";j(q);x=false}else if(m==="style"){s="scriptstring";j("=");q=g.id;q!=='"'&&q!=="'"&&i("expected_a_b",g,'"',g.value);s="styleproperty";S=q;j(q);xb();s="html";S="";j(q);x=false}else if(g.id==="="){j("=");x=g.value;!g.identifier&&g.id!=='"'&&g.id!=="'"&&g.id!=="(string)"&&g.id!=="(string)"&&g.id!=="(color)"&&f("expected_attribute_value_a",n,m);j()}else x=true;u[m]=x;c=m;h=x;var t=k=void 0;if(c==="id"){k=typeof h==="string"?h.toUpperCase():"";Wa[k]===true&&f("duplicate_a",
g,h);if(/^[A-Za-z][A-Za-z0-9._:\-]*$/.test(h)){if(l.adsafe)if(V)h.slice(0,V.length)!==V?f("adsafe_prefix_a",g,V):/^[A-Z]+_[A-Z]+$/.test(h)||f("adsafe_bad_id");else{V=h;/^[A-Z]+_$/.test(h)||f("adsafe_bad_id")}}else f("bad_id_a",g,h);t=h.search(Wb);t>=0&&f("unexpected_char_a_b",n,h.charAt(t),c);Wa[k]=true}else if(c==="class"||c==="type"||c==="name"){t=h.search(Zb);t>=0&&f("unexpected_char_a_b",n,h.charAt(t),c);Wa[k]=true}else if(c==="href"||c==="background"||c==="content"||c==="data"||c.indexOf("src")>=
0||c.indexOf("url")>=0){l.safe&&wb.test(h)&&i("bad_url",g,h);Fa.push(h)}else c==="for"?l.adsafe&&(V?h.slice(0,V.length)!==V?f("adsafe_prefix_a",g,V):/^[A-Z]+_[A-Z]+$/.test(h)||f("adsafe_bad_id"):f("adsafe_bad_id")):c==="name"&&l.adsafe&&h.indexOf("_")>=0&&f("adsafe_name_a",g,h)}c=r;h=u;k=void 0;var B=mb[c],C=t=void 0;qb=false;B||i(E.unrecognized_tag_a,g,c===c.toLowerCase()?c:c+" (capitalization error)");if(N.length>0){c==="html"&&i("unexpected_a",n,c);if(C=B.parent)C.indexOf(" "+N[N.length-1].name+
" ")<0&&i("tag_a_in_b",n,c,C);else if(!l.adsafe&&!l.fragment){k=N.length;do{k<=0&&i("tag_a_in_b",n,c,"body");k=k-1}while(N[k].name!=="body")}}switch(c){case "div":l.adsafe&&N.length===1&&!V&&f("adsafe_missing_id");break;case "script":s="script";j(">");h.lang&&f("lang",n);l.adsafe&&N.length!==1&&f("adsafe_placement",n);if(h.src){l.adsafe&&(!Ga||!Ua[h.src])&&f("adsafe_source",n);h.type&&f("type",n)}else{G(g.from);w();La();Ha=true;t=oa();if(l.adsafe){ia&&i("adsafe_script",n);(t.length!==1||J(t[0],"id",
"(")||J(t[0].first,"id",".")||J(t[0].first.first,"value","ADSAFE")||J(t[0].second[0],"value",V))&&i("adsafe_id_go");switch(t[0].first.second.value){case "id":(Ga||ia||t[0].second.length!==1)&&i("adsafe_id",g);Ga=true;break;case "go":ia&&i("adsafe_go");(t[0].second.length!==2||J(t[0].second[1],"id","function")||!t[0].second[1].first||t[0].second[1].first.length!==2||J(t[0].second[1].first[0],"value","dom")||J(t[0].second[1].first[1],"value","lib"))&&i("adsafe_go",g);ia=true;break;default:i("adsafe_id_go")}}v=
null}s="html";j("</");!g.identifier&&g.value!=="script"&&f("expected_a_b",g,"script",g.value);j();s="outer";break;case "style":s="style";j(">");zb();s="html";j("</");!g.identifier&&g.value!=="style"&&f("expected_a_b",g,"style",g.value);j();s="outer";break;case "input":switch(h.type){case "radio":case "checkbox":case "button":case "reset":case "submit":break;case "text":case "file":case "password":case "file":case "hidden":case "image":l.adsafe&&h.autocomplete!=="off"&&f("adsafe_autocomplete");break;
default:f("bad_type")}break;case "applet":case "body":case "embed":case "frame":case "frameset":case "head":case "iframe":case "noembed":case "noframes":case "object":case "param":l.adsafe&&f("adsafe_tag",g,c)}o||N.push(y);s="outer";j(">");break;case "</":s="html";j("</");g.identifier||f("bad_name_a");r=g.value;l.cap&&(r=r.toLowerCase());j();N||i("unexpected_a",g,"</"+r+">");(y=N.pop())||i("unexpected_a",g,"</"+r+">");y.name!==r&&i("expected_a_b",g,"</"+y.name+">","</"+r+">");g.id!==">"&&i("expected_a_b",
g,">",g.value);s="outer";j(">");break;case "<!":l.safe&&f("adsafe_a");for(s="html";;){j();if(g.id===">"||g.id==="(end)")break;g.value.indexOf("--")>=0&&i("unexpected_a",g,"--");g.value.indexOf("<")>=0&&i("unexpected_a",g,"<");g.value.indexOf(">")>=0&&i("unexpected_a",g,">")}s="outer";j(">");break;case "(end)":break a;default:g.id==="(end)"?i("missing_a",g,"</"+N[N.length-1].value+">"):j()}if(N&&N.length===0&&(l.adsafe||!l.fragment||g.id==="(end)"))break}g.id!=="(end)"&&i("unexpected_a")}l.adsafe&&
!ia&&f("adsafe_go",this)}else switch(g.id){case "{":case "[":ja=true;gb();break;case "@":case "*":case "#":case ".":case ":":s="style";j();(n.id!=="@"||!g.identifier||g.value!=="charset"||n.line!==1||n.from!==1)&&i("css");j();g.id!=="(string)"&&g.value!=="UTF-8"&&i("css");j();U();zb();break;default:l.adsafe&&l.fragment&&i("expected_a_b",g,"<div>",g.value);G(1);g.id===";"&&!Ja&&U();Ha=true;k=oa();nb.first=k;JAYLINT.tree=nb;l.adsafe&&(k.length!==1||J(k[0],"id","(")||J(k[0].first,"id",".")||J(k[0].first.first,
"value","ADSAFE")||J(k[0].first.second,"value","lib")||k[0].second.length!==2||k[0].second[0].id!=="(string)"||J(k[0].second[1],"id","function"))&&i("adsafe_lib");k.disrupt&&f("weird_program",T)}v=null;j("(end)")}catch(D){D&&JAYLINT.errors.push({reason:D.message,line:D.line||g.line,character:D.character||g.from},null)}return JAYLINT.errors.length===0};ca.data=function(){var a={functions:[]},b,c,d,e,f,g=[],h=[];if(ca.errors.length)a.errors=ca.errors;if(ja)a.json=true;if(Fa.length>0)a.urls=Fa;b=Object.keys(ya).filter(function(a){return a.charAt(0)!==
"("?a:void 0});if(b.length>0)a.globals=b;for(c=1;c<Ra.length;c=c+1){f=Ra[c];b={};for(d=0;d<Ia.length;d=d+1)b[Ia[d]]=[];for(e in f)if(Object.prototype.hasOwnProperty.call(f,e)&&e.charAt(0)!=="("){d=f[e];if(d==="unction"||d==="unparam")d="unused";if(Array.isArray(b[d])){b[d].push(e);d==="unused"?h.push({name:e,line:f["(line)"],"function":f["(name)"]}):d==="undef"&&g.push({name:e,line:f["(line)"],"function":f["(name)"]})}}for(d=0;d<Ia.length;d=d+1)b[Ia[d]].length===0&&delete b[Ia[d]];b.name=f["(name)"];
b.param=f["(params)"];b.line=f["(line)"];b["(complexity)"]=f["(complexity)"];a.functions.push(b)}if(h.length>0)a.unused=h;if(g.length>0)a.undef=g;for(e in pa)if(typeof pa[e]==="number"){a.member=pa;break}return a};ca.report=function(a){function b(a,c){var d,e;if(Array.isArray(c)){i.push("<div><i>"+a+"</i> ");c=c.sort().forEach(function(a){if(a!==e){e=a;i.push((d?", ":"")+e);d=true}});i.push("</div>")}else c&&i.push("<div><i>"+a+"</i> "+c+"</div>")}var d=ca.data(),e,f,g,h;f="";var k,i=[];if(d.errors||
d.unused||d.undef){e=true;i.push("<div id=errors><i>Error:</i>");if(d.errors)for(g=0;g<d.errors.length;g=g+1)if(h=d.errors[g]){f=h.evidence||"";i.push("<p>Problem"+(isFinite(h.line)?" at line "+h.line+" character "+h.character:"")+": "+h.reason.entityify()+"</p><p class=evidence>"+(f&&(f.length>80?f.slice(0,77)+"...":f).entityify())+"</p>")}if(d.undef){f=[];for(g=0;g<d.undef.length;g=g+1)f[g]="<code><u>"+d.undef[g].name+"</u></code>&nbsp;<i>"+d.undef[g].line+" </i> <small>"+d.undef[g]["function"]+
"</small>";i.push("<p><i>Undefined variable:</i> "+f.join(", ")+"</p>")}if(d.unused){f=[];for(g=0;g<d.unused.length;g=g+1)f[g]="<code><u>"+d.unused[g].name+"</u></code>&nbsp;<i>"+d.unused[g].line+" </i> <small>"+d.unused[g]["function"]+"</small>";i.push("<p><i>Unused variable:</i> "+f.join(", ")+"</p>")}d.json&&i.push("<p>JSON: bad.</p>");i.push("</div>")}if(!a){i.push("<br><div id=functions>");d.urls&&b("URLs<br>",d.urls,"<br>");s==="style"?i.push("<p>CSS.</p>"):d.json&&!e?i.push("<p>JSON: good.</p>"):
d.globals?i.push("<div><i>Global</i> "+d.globals.sort().join(", ")+"</div>"):i.push("<div><i>No new global variables introduced.</i></div>");for(g=0;g<d.functions.length;g=g+1){e=d.functions[g];a=[];if(e.param)for(f=0;f<e.param.length;f=f+1)a[f]=e.param[f].value;i.push("<br><div class=function><i>"+e.line+"</i> "+e.name.entityify()+"("+a.join(", ")+")</div>");b("<big><b>Undefined</b></big>",e.undef);b("<big><b>Unused</b></big>",e.unused);b("Closure",e.closure);b("Variable",e["var"]);b("Exception",
e.exception);b("Outer",e.outer);b("Global",e.global);b("Label",e.label);b("Complexity",e["(complexity)"])}if(d.member){e=Object.keys(d.member);if(e.length){e=e.sort();f="<br><pre id=properties>/*properties ";h=13;for(g=0;g<e.length;g=g+1){a=e[g];k=Cb.test(a)?a:"'"+a.entityify().replace(ub,c)+"'";if(h+k.length>72){i.push(f+"<br>");f="    ";h=1}h=h+(k.length+2);d.member[a]===1&&(k="<i>"+k+"</i>");g<e.length-1&&(k=k+", ");f=f+k}i.push(f+"<br>*/</pre>")}i.push("</div>")}}return i.join("")};ca.jslint=
ca;ca.edition="2012-05-01";return ca}();
(function(a,b){function c(a,b){this.kind=h.property;Object.defineProperty(this,"definedBy",{value:b,enumerable:false,configurable:false,writable:false});if(a){if(typeof a==="function"){this.method=a;this.kind=h.method}else{this.configurable=this.enumerable=true;if(typeof a==="number"){this.value=a;this.dataType="integer"}else if(typeof a==="string"){this.value=a;this.dataType=typeof a}else for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}this.type!==void 0?this.dataType=this.dataType||this.type:
this.type=this.dataType}}function d(){}function e(){this.classNames={}}function h(){}function f(a,b){this.definedBy=a;this.initfunc=b}c.prototype.createPropertyDescriptor=function(a,b){var c=this,d={enumerable:this.enumerable==void 0?true:this.enumerable,configurable:this.configurable==void 0?true:this.configurable};if(this.set&&this.get){d.set=this.set;d.get=this.get}else if("value"in this||b){d.value=b||this.value;d.writable=true}else{d.set=function(a){this.storeProperty(c,a)};d.get=function(){return this.retrieveProperty(c)}}return d};
c.prototype.createStorePropertyDescriptor=function(a){return{enumerable:false,writable:true,configurable:this.configurable,value:a}};c.prototype.createGetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b){return this.getProperty(a,b)}}};c.prototype.createSetMethod=function(){var a=this;return{enumerable:false,writable:false,configurable:false,value:function(b,c){return this.setProperty(a,b,c)}}};c.prototype.toJSON=function(){var a={},b;for(b in this)b!==
"defineBy"&&b!=="storageModel"&&(a[b]=this[b]);return a};a.MemberDefinition=window.MemberDefinition=c;d.prototype={clearCache:function(){this.propByTypeCache=this.keyPropsCache=this.pubMapPropsCache=this.arrayCache=void 0},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var a in this)a.indexOf("$")===0&&this.arrayCache.push(this[a])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var a in this)a.indexOf("$")===0&&
this[a].kind=="property"&&!this[a].notMapped&&this[a].enumerable&&this.pubMapPropsCache.push(this[a])}return this.pubMapPropsCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var a in this)a.indexOf("$")===0&&this[a].kind=="property"&&this[a].key&&this.keyPropsCache.push(this[a])}return this.keyPropsCache},getPropertyByType:function(a){if(!this.propByTypeCache){this.propByTypeCache=[];for(var b in this)b.indexOf("$")===0&&this[b].dataType==a&&this.propByTypeCache.push(this[b])}return this.propByTypeCache},
getMember:function(a){return this["$"+a]},setMember:function(a){this["$"+a.name]=a}};d.prototype.constructor=d;a.MemberDefinitionCollection=window.MemberDefinitionCollection=d;eval("function Base() { };");a.Base=Base;a.Base.fullName="$data.Base";if(!a.Base.name)a.Base.name="Base";a.Base.prototype.storeProperty=function(a,b){var c="_"+a.name;this[c]?this[c]=b:Object.defineProperty(this,c,a.createStorePropertyDescriptor(b))};a.Base.prototype.retrieveProperty=function(a){return this["_"+a.name]};a.Base.prototype.setProperty=
function(a,b,c){this[a.name]=b;c()};a.Base.prototype.getProperty=function(a,b){b.apply(this,[this[a.name]])};a.Base.extend=function(b,c,d){return a.Class.define(b,null,null,c,d)};h.__enum=true;h.method="method";h.property="property";h.navProperty="navProperty";h.complexProperty="complexProperty";h.field="field";a.MemberTypes=h;f.constructor="constructor";f.classConstructor="classConstructor";f.mixin="mixin";f.propagation="propagation";e.prototype={getClass:function(){},getProperties:function(a){return a.propertyDefinitions},
define:function(a,b,c,d,e){return this.defineEx(a,[{type:b}],c,d,e)},defineEx:function(b,c,d,e,f){if(c.length==0)c.push({type:a.Base});else if(c.length>0&&!c[0].type)c[0].type=a.Base;var d=b.split("."),h=d.splice(d.length-1,1)[0],r=window;d.forEach(function(a){r[a]||(r[a]={__namespace:true});r=r[a]});var m=null,m=this.classFunctionBuilder(h,c,f,e);m.fullName=b;m.namespace=d.join(".");this.buildType(m,c,e,f);m.name=h;Container.registerType(b,m);typeof intellisense!=="undefined"&&e&&e.constructor&&
intellisense.annotate(m,e.constructor);return r[h]=this.classNames[b]=m},classFunctionBuilder:function(a,b,c,d){return(new Function("base","classDefinition","instanceDefinition","return function "+a+" (){ "+this.bodyBuilder(b,c,d)+" \n}; "))(b,c,d)},bodyBuilder:function(a,b,c){for(var d=b="",e="",f=0,h=a.length;f<h;f++){var m=a[f],j=f;if(j==0){if(m&&m.type){d=d+("    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+j+"].params, this); \n");d=d+("    "+m.type.fullName+".apply(this, baseArguments); \n")}}else if(m&&
m.type&&m.propagateTo){e=e+("    "+(!e?"var ":"")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+j+"].params, this); \n");e=e+('    this["'+m.propagateTo+'"] =  Object.create('+m.type.fullName+".prototype); \n    "+m.type.fullName+'.apply(this["'+m.propagateTo+'"], propagationArguments); \n')}else m&&m.type&&m.type.memberDefinitions&&m.type.memberDefinitions.$constructor&&!m.propagateTo&&(b=b+("    "+m.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n"))}c&&
c.constructor!=Object&&(d=d+"    instanceDefinition.constructor.apply(this, arguments); \n");return"\n    //mixins \n"+b+"\n    //construction \n"+d+"\n    //propagations \n"+e},buildType:function(b,c,e,f){var h=c[0].type;if(b.inheritsFrom=h){b.prototype=Object.create(h.prototype);b.memberDefinitions=Object.create(h.memberDefinitions||new d);b.memberDefinitions.clearCache();var K=h.staticDefinitions;if(K)if(K=K.asArray())for(var r=0;r<K.length;r++)this.buildMember(b,K[r],void 0,"staticDefinitions");
b.baseTypes=(h.baseTypes||[]).concat(c.map(function(a){return a.type}));b.isAssignableTo||Object.defineProperty(b,"isAssignableTo",{value:function(a){return this===a||this.baseTypes.indexOf(a)>=0},writable:false,enumerable:false,configurable:false})}if(f){this.buildStaticMembers(b,f);if(f.constructor)b.classConstructor=f.constructor}e&&this.buildInstanceMembers(b,e);c=[].concat(c);c.shift();Object.keys(c).length>0&&this.buildInstanceMixins(b,c);b.__class=true;b.prototype.constructor=b;Object.defineProperty(b.prototype,
"getType",{value:function(){return b},writable:false,enumerable:false,configurable:false});b.extend=function(c,d,e){return a.Class.define(c,b,null,d,e)};Object.defineProperty(b,"getMemberDefinition",{value:function(a){return b.memberDefinitions.getMember(a)}})},addMethod:function(a,b,c,d){a[b]=!d||typeof intellisense!=="undefined"?c:function(){return c.apply(this[d],arguments)}},addProperty:function(a,b,c,d){if(d){c.configurable=true;if(c.get){var e=c.get;c.get=function(){this[d]||Guard.raise(new Exception("not inicialized"));
return e.apply(this[d],arguments)}}if(c.set){var f=c.set;c.set=function(){this[d]||Guard.raise(new Exception("not inicialized"));f.apply(this[d],arguments)}}}Object.defineProperty(a,b,c)},addField:function(){Guard.raise("not implemented")},buildMethod:function(a,b,c){this.addMethod(b.classMember?a:a.prototype,b.name,b.method,c)},buildProperty:function(a,b,c){var d=b.classMember?a:a.prototype,e=b.createPropertyDescriptor(a);this.addProperty(d,b.name,e,c);if(!b.classMember&&a.__setPropertyfunctions==
true){a=b.createGetMethod();this.addProperty(d,"get_"+b.name,a,c);a=b.createSetMethod();this.addProperty(d,"set_"+b.name,a,c)}},buildMember:function(a,b,c,e){e=e||"memberDefinitions";a[e]=a[e]||new d;a[e].setMember(b);switch(b.kind){case h.method:this.buildMethod(a,b,c);break;case h.navProperty:case h.complexProperty:case h.property:this.buildProperty(a,b,c);break;default:Guard.raise("Unknown member type: "+b.kind+","+b.name)}},buildStaticMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=
new c(b[d],a);e.name=d;e.classMember=true;this.buildMember(a,e,void 0,"staticDefinitions")}},buildInstanceMembers:function(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=new c(b[d],a);e.name=d;this.buildMember(a,e)}},copyMembers:function(a,b){Object.keys(a.prototype).forEach(function(c){if(c!=="constructor"&&c!=="toString"){typeof intellisense!=="undefined"&&intellisense.logMessage("copying item:"+c);b.prototype[c]=a[c]}})},buildInstanceMixins:function(a,b){a.mixins=a.mixins||[];a.propagations=
a.propagations||[];for(var c=0;c<b.length;c++){var d=b[c];if(d.propagateTo){this.buildInstancePropagation(a,d);a.propagations.push(d);a.propagations[d.type.name]=true}else{this.buildInstanceMixin(a,d);a.mixins.push(d);a.mixins[d.type.name]=true}}},buildInstanceMixin:function(a,b){for(var c=b.type.memberDefinitions.asArray(),d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d])}},buildInstancePropagation:function(a,b){for(var c=b.type.memberDefinitions.asArray(),
d=0,e=c.length;d<e;d++){var f=c[d].name;f!=="constructor"&&!a.memberDefinitions.getMember(f)&&this.buildMember(a,c[d],b.propagateTo)}}};a.Class=Class=new e;(function(b){a.Number=typeof Number!=="undefined"?Number:function(){};a.Integer=typeof Integer!=="undefined"?Integer:function(){};a.Date=typeof Date!=="undefined"?Date:function(){};a.String=typeof String!=="undefined"?String:function(){};a.Boolean=typeof Boolean!=="undefined"?Boolean:function(){};a.Blob=function(){};a.Array=typeof Array!=="undefined"?
Array:function(){};a.Object=typeof Object!=="undefined"?Object:function(){};a.Function=Function;b.Container=a.Container=b=b.C$=new function(){var b={},c=[],d=[];this.classNames=b;this.consolidatedClassNames=c;this.classTypes=d;var e=[];this.mappedTo=e;var f=this;this.holder=null;this.mapType=function(a,b){Guard.requireValue("aliasType",a);Guard.requireValue("realType",b);var c=this.getType(a),f=this.getType(b),c=d.indexOf(c),f=d.indexOf(f);e[c]=f};this.resolve=function(a,b){return new (this.resolveType(a,
b))(b)};this.resolveName=function(a){a=this.resolveType(a);a=d.indexOf(a);return c[a]};this.isPrimitiveType=function(b){b=this.resolveType(b);return b===Number||b===String||b===Date||b===String||b===Boolean||b===Array||b===Object||b===a.Number||b===a.String||b===a.Date||b===a.String||b===a.Boolean||b===a.Array||b===a.Object};this.resolveType=function(a){var a=this.getType(a),b=d.indexOf(a);return typeof e[b]==="undefined"?a:d[e[b]]};this.getTypes=function(){return Object.keys(b).map(function(a){return{name:a,
type:d[b[a]],toString:function(){return this.name}}})};this.getTypeName=function(a){switch(typeof a){case "object":if(a==null)return"$data.Object";if(a instanceof Array)return"$data.Array";if(a.getType)return a.getType().fullName;if(a instanceof Date)return"$data.Date";default:return typeof a}};this.isTypeRegistered=function(a){return typeof a==="function"?d.indexOf(a)>-1:a in b};this.unregisterType=function(){Guard.raise("Unimplemented")};this.getType=function(a){Guard.requireValue("typeOrName",
a);if(typeof a==="function")return a;a in b||Guard.raise(new Exception("Unable to resolve type:"+a));return d[b[a]]};this.getName=function(a){var b=this.getType(a),b=d.indexOf(b);b==-1&&Guard.raise("unknown type to request name for: "+a);return c[b]};this.getDefault=function(b){switch(this.resolveType(b)){case a.Number:return 0;case a.Integer:return 0;case a.String:return"";case a.Boolean:return false;default:return null}};this.registerType=function(a,e,h){if(a){typeof e==="string"&&(e=f.resolveType(e));
if(typeof a==="string"){var k=[];k.push(a);a=k}for(k=0;k<a.length;k++){var J=a[k].split("."),w={};w.shortName=J[J.length-1];w.fullName=a[k];a[k]=w}J=function(){var a=arguments,b=f.resolveType(e),c=Object.create(b.prototype);b.apply(c,a);return c};typeof intellisense!=="undefined"&&intellisense.annotate(J,e);for(var k=0,G=a.length;k<G;k++){w=a[k];"create"+w.shortName in f?console&&console.warn("warning: short names overlap:"+w.shortName+", Container.create"+w.shortName+" has not been updated"):f["create"+
w.shortName]=typeof h==="function"?h:J;var y=d.indexOf(e);if(y==-1){y=d.push(e)-1;c[y]=w.fullName}w.fullName in b&&console.warn("warning:!!! This typename has already been registered:"+w.fullName);b[w.fullName]=y}if(!e.name)e.name=a[0].shortName}}};b.registerType(["$data.Number","number","float","real","decimal"],a.Number);b.registerType(["$data.Integer","int","integer","int16","int32","int64"],a.Integer);b.registerType(["$data.String","string","text","character"],a.String);b.registerType(["$data.Array",
"array","Array","[]"],a.Array,function(){return a.Array.apply(void 0,arguments)});b.registerType(["$data.Date","datetime","date"],a.Date);b.registerType(["$data.Boolean","bool","boolean"],a.Boolean);b.registerType(["$data.Blob","blob"],a.Blob);b.registerType(["$data.Object","Object","object"],a.Object);b.registerType(["$data.Function","Function","function"],a.Function)})(window);b.$C=function(){Class.define.apply(Class,arguments)};a.Class.ConstructorParameter=ConstructorParameter=a.Class.define("ConstructorParameter",
null,null,{constructor:function(a){this.paramIndex=a},paramIndex:{}})})($data,window);$data.defaultErrorCallback=function(){Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))};$data.defaultSuccessCallback=function(){console.log("DEFAULT SUCCES CALLBACK")};$data.defaultNotifyCallback=function(){console.log("DEFAULT NOTIFY CALLBACK")};
$data.typeSystem={__namespace:!0,extend:function(a){typeof a!=="object"&&Guard.raise("Target must be object");for(var b=1;b<arguments.length;b++){var c=arguments[b];if(!(c===null||typeof c==="undefined"))for(key in c)a[key]=c[key]}return a},createCallbackSetting:function(a,b){var c={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};b!=void 0&&b!=null&&(c=b);return a==null||a==void 0?c:typeof a=="function"?this.extend(c,{success:a}):this.extend(c,
a)},createCtorParams:function(a,b,c){if(b){for(var d=[],e=0,h=b.length;e<h;e++){var f=e;b[f]instanceof ConstructorParameter?d.push(a[b[f].paramIndex]):typeof b[f]==="function"?d.push(b[f].apply(c)):d.push(b[f])}return d}return a},writePropertyValues:function(a){a&&a.getType&&a.getType().memberDefinitions&&this.writeProperties(a,a.getType().memberDefinitions.asArray().filter(function(a){return(a.kind=="property"||a.kind=="navProperty"||a.kind=="complexProperty")&&!a.prototypeProperty}))},writeProperties:function(a,
b){for(var c={},d=0,e=b.length;d<e;d++){var h=b[d];c[h.name]=h.createPropertyDescriptor(null,h.value)}Object.defineProperties(a,c)},writeProperty:function(a,b,c){if(b=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b){c=b.createPropertyDescriptor(null,c);Object.defineProperty(a,b.name,c)}}};function ASTNode(){}function FunctionASTNode(){}FunctionASTNode.prototype=new ASTNode;function ParameterASTNode(){}function MemberAccessASTNode(){}MemberAccessASTNode.prototype=new ASTNode;
function ConstantASTNode(){}function ASTParserResult(a,b,c){this.success=b!="";this.result=a;this.tree=b;this.errors=c}function ASTParser(){}ASTParser.parseCode=function(a){var b;if(!a||(b=a.toString())==="")return new ASTParserResult(false,null,null);typeof JAYLINT==="undefined"&&Guard.raise(new Exception("JAYLINT is required","Not Found!"));a=JAYLINT(b);return new ASTParserResult(a,JAYLINT.tree,JAYLINT.errors)};$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{});
var ExpressionType=$data.Expressions.ExpressionType;ExpressionType.Constant="constant";ExpressionType.Variable="variable";ExpressionType.MemberAccess="memberAccess";ExpressionType.Call="call";ExpressionType.Equal="equal";ExpressionType.NotEqual="notEqual";ExpressionType.EqualTyped="equalTyped";ExpressionType.NotEqualTyped="notEqualTyped";ExpressionType.GreaterThen="greaterThan";ExpressionType.LessThen="lessThan";ExpressionType.GreaterThenOrEqual="greaterThanOrEqual";
ExpressionType.LessThenOrEqual="lessThenOrEqual";ExpressionType.Or="or";ExpressionType.OrBitwise="orBitwise";ExpressionType.And="and";ExpressionType.AndBitwise="andBitwise";ExpressionType.In="in";ExpressionType.Add="add";ExpressionType.Divide="divide";ExpressionType.Multiply="multiply";ExpressionType.Subtract="subtract";ExpressionType.Modulo="modulo";ExpressionType.ArrayIndex="arrayIndex";ExpressionType.New="new";ExpressionType.Positive="positive";ExpressionType.Negative="negative";
ExpressionType.Increment="increment";ExpressionType.Decrement="decrement";ExpressionType.Not="not";ExpressionType.This="this";ExpressionType.LambdaParameterReference="lambdaParameterReference";ExpressionType.LambdaParameter="lambdaParameter";ExpressionType.Parameter="parameter";ExpressionType.ArrayLiteral="arrayLiteral";ExpressionType.ObjectLiteral="objectLiteral";ExpressionType.ObjectField="objectField";ExpressionType.Function="Function";ExpressionType.Unknown="UNKNOWN";
ExpressionType.EntitySet="EntitySet";ExpressionType.ServiceOperation="ServiceOperation";ExpressionType.EntityField="EntityField";ExpressionType.EntityContext="EntityContext";ExpressionType.Entity="Entity";ExpressionType.Filter="Filter";ExpressionType.First="First";ExpressionType.Count="Count";ExpressionType.Single="Single";ExpressionType.Some="Some";ExpressionType.Every="Every";ExpressionType.ToArray="ToArray";ExpressionType.ForEach="ForEach";ExpressionType.Projection="Projection";
ExpressionType.EntityMember="EntityMember";ExpressionType.EntityFieldOperation="EntityFieldOperation";ExpressionType.FrameOperation="FrameOperation";ExpressionType.EntityBinary="EntityBinary";ExpressionType.Code="Code";ExpressionType.ParametricQuery="ParametricQuery";ExpressionType.MemberInfo="MemberInfo";ExpressionType.QueryParameter="QueryParameter";ExpressionType.ComplexEntityField="ComplexEntityField";ExpressionType.Take="Take";ExpressionType.Skip="Skip";ExpressionType.OrderBy="OrderBy";
ExpressionType.OrderByDescending="OrderByDescending";ExpressionType.Include="Include";ExpressionType.Count="Count";$data.Expressions.ExpressionType=ExpressionType;function BinaryOperator(){}
var binaryOperators=[{operator:"==",expressionType:ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b}},{operator:"===",expressionType:ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b}},{operator:"!=",expressionType:ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b}},{operator:"!==",expressionType:ExpressionType.NotEqualTyped,type:"boolean",implementation:function(a,b){return a!==b}},{operator:">",expressionType:ExpressionType.GreaterThen,
type:"boolean",implementation:function(a,b){return a>b}},{operator:">=",expressionType:ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b}},{operator:"<=",expressionType:ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b}},{operator:"<",expressionType:ExpressionType.LessThen,type:"boolean",implementation:function(a,b){return a<b}},{operator:"&&",expressionType:ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&
b}},{operator:"||",expressionType:ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b}},{operator:"&",expressionType:ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b}},{operator:"|",expressionType:ExpressionType.OrBitwise,type:"number",implementation:function(a,b){return a|b}},{operator:"+",expressionType:ExpressionType.Add,type:"number",implementation:function(a,b){return a+b}},{operator:"-",expressionType:ExpressionType.Subtract,type:"number",
implementation:function(a,b){return a-b}},{operator:"/",expressionType:ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b}},{operator:"%",expressionType:ExpressionType.Modulo,type:"number",implementation:function(a,b){return a%b}},{operator:"*",expressionType:ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b}},{operator:"[",expressionType:ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b]}},{operator:"in",expressionType:ExpressionType.In,
type:"boolean",implementation:function(a,b){return a in b}}];binaryOperators.resolve=function(a){if(binaryOperators.filter(function(b){return b.operator==a}).length>0)return a};binaryOperators.contains=function(a){return binaryOperators.some(function(b){return b.operator==a})};binaryOperators.getOperator=function(a){var b=binaryOperators.filter(function(b){return b.operator==a});b.length<1&&Guard.raise("Unknown operator: "+a);return b[0]};
var unaryOperators=[{operator:"+",arity:"prefix",expressionType:ExpressionType.Positive,type:"number",implementation:function(a){return+a}},{operator:"-",arity:"prefix",expressionType:ExpressionType.Negative,type:"number",implementation:function(a){return-a}},{operator:"++",arity:"prefix",expressionType:ExpressionType.Increment,type:"number",implementation:function(a){return++a}},{operator:"--",arity:"prefix",expressionType:ExpressionType.Decrement,type:"number",implementation:function(a){return--a}},
{operator:"++",arity:"suffix",expressionType:ExpressionType.Increment,type:"number",implementation:function(a){return a++}},{operator:"!",arity:"prefix",expressionType:ExpressionType.Not,type:"boolean",implementation:function(a){return!a}},{operator:"--",arity:"suffix",expressionType:ExpressionType.Decrement,type:"number",implementation:function(a){return a--}}];unaryOperators.resolve=function(a){if(unaryOperators.filter(function(b){return b.operator==a}).length>0)return a};
unaryOperators.contains=function(a){return unaryOperators.some(function(b){return b.operator==a})};unaryOperators.getOperator=function(a,b){var c=unaryOperators.filter(function(c){return c.operator==a&&(!b||c.arity==b)});c.length<1&&Guard.raise("Unknown operator: "+a);return c[0]};function timeIt(a,b){b=b||1;console.time("!");for(var c=0;c<b;c++)a();console.timeEnd("!")}
var UNARY="UNARY",INCDEC="INCDEC",DECISION="DECISION",METHODCALL="METHODCALL",NEW="NEW",JSONASSIGN="JSONASSIGN",ARRAYACCESS="ARRAYACCESS",UNKNOWN="UNKNOWN",executable=!0;function jsonify(a){return JSON.stringify(a,null,"\t")}
$C("$data.Expressions.ExpressionNode",$data.Entity,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{value:void 0,set:function(a){var b;Object.defineProperty(this,"expressionType",{set:function(a){typeof a==="string"&&(a=Container.resolveType(a));b=a},get:function(a){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(b):b},enumerable:true});this.expressionType=a},get:function(){},
enumerable:!0},nodeType:{value:ExpressionType.Unknown,writable:!1},type:{},isTerminated:{value:!1},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){this.operand=a;this.operator=b;this.nodeType=c;this.resolution=d},operator:{value:void 0,writable:!0},operand:{value:void 0,writable:!0},nodeType:{value:void 0,writable:!0}});
$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.items=a||[]},nodeType:{value:ExpressionType.ArrayLiteral,writable:!0},items:{value:void 0,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){return"["+this.items.map(function(a){return a.toString()}).join(",")+"]"}},null);
$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.expression=a;this.member=b;this.args=c},nodeType:{value:ExpressionType.Call},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},implementation:{get:function(){return function(a,b,c){typeof b!=="function"&&(b=a[b]);Guard.requireType("method",b,Function);return b.apply(a,
c)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}});
$C("$data.Expressions.CodeParser",null,null,{constructor:function(a){this.scopeContext=a;this.lambdaParams=[]},log:function(a){this.scopeContext&&this.scopeContext.log(a)},parseExpression:function(a){typeof a==="object"&&(a="");var b={success:true,errorMessage:"",errorDetails:""},a=ASTParser.parseCode(a);this.log({event:"AST",data:a});if(!a.success)return{success:false,error:"ASTParser error",errorMessage:a.errors?JSON.stringify(a.errors):"could not get code"};return b={success:true,expression:this.Build2(a.tree.first[0]),
errors:a.errors}},createExpression:function(a,b){var c=this.parseExpression(a,b);c.success||Guard.raise("ExpressionParserError: "+c.errorMessage);return c.expression},Build2:function(a){var b;switch(a.arity){case "number":case "string":b=this.BuildConstant(a);break;case "prefix":switch(a.value){case "{":b=this.BuildObjectLiteral(a);break;case "[":b=this.BuildArrayLiteral(a);break;case unaryOperators.resolve(a.value):b=this.BuildUnary(a)}break;case "suffix":switch(a.value){case unaryOperators.resolve(a.value):b=
this.BuildUnary(a);break;default:Guard.raise("Unknown suffix: "+a.value)}break;case "infix":switch(a.value){case "[":b=this.BuildArray(a);break;case binaryOperators.resolve(a.value):b=this.BuildSimpleBinary(a);break;case "function":Guard.raise("Unexpected function arity");case "(":b=this.BuildCall(a);break;case ".":b=this.BuildProperty(a);break;default:debugger}break;case "statement":switch(a.value){case "function":b=this.BuildFunction(a)}break;default:switch(a.value){case "function":b=this.BuildFunction(a);
break;case "true":case "false":case "null":b=this.BuildConstant(a);break;case "this":b=this.BuildThis(a);break;default:b=this.BuildParameter(a)}}return b},BuildThis:function(){return Container.createThisExpression()},BuildConstant:function(a){var b=a.value,c=a.type;if(a.reserved===true)switch(a.value){case "true":b=true;c="boolean";break;case "false":b=false;c="boolean";break;case "null":b=null;c="object"}return new $data.Expressions.ConstantExpression(b,c)},BuildFunctionParameter:function(){},BuildArray:function(a){switch(a.second.type){case "string":return this.BuildProperty(a);
default:return this.BuildSimpleBinary(a)}},BuildParameter:function(a){var b=a.funct?ExpressionType.LambdaParameter:this.lambdaParams.indexOf(a.value)>-1?ExpressionType.LambdaParameterReference:ExpressionType.Parameter,c=new $data.Expressions.ParameterExpression(a.value,null,b);if(b==ExpressionType.LambdaParameterReference)c.paramIndex=this.lambdaParams.indexOf(a.value);return c},BuildArrayLiteral:function(a){var b=this,a=a.first.map(function(a){return b.Build2(a)});return new $data.Expressions.ArrayLiteralExpression(a)},
BuildObjectLiteral:function(a){var b=this,a=a.first.map(function(a){var d=b.Build2(a.first);return new $data.Expressions.ObjectFieldExpression(a.value,d)});return new $data.Expressions.ObjectLiteralExpression(a)},BuildFunction:function(a){var b=this,c=a.first&&a.first.map(function(a){this.lambdaParams.push(a.value);return b.BuildParameter(a)},this),c=c||[],d=a.block.length==0?false:a.block[0].value==="return"?true:false,d=a.block.length>0?this.Build2(d?a.block[0].first:a.block[0]):null;[].forEach(function(){this.lambdaParams.pop()},
this);var e=new $data.Expressions.FunctionExpression(a.value,c,d);c.forEach(function(a){Object.defineProperty(a,"owningFunction",{value:e,enumerable:false})});e.name=a.name;return e},BuildCall:function(a){var b=this,c=b.Build2(a.first),a=a.second.map(function(a){return b.Build2(a)}),d,e;switch(true){case c instanceof $data.Expressions.PropertyExpression:e=c.expression;d=c.member;break;case c instanceof $data.Expressions.ParameterExpression:e=Container.createConstantExpression(null,"object");d=c}return Container.createCallExpression(e,
d,a)},BuildProperty:function(a){var b=this.Build2(a.first),a=a.second.identifier?new $data.Expressions.ConstantExpression(a.second.value,"string"):this.Build2(a.second);return new $data.Expressions.PropertyExpression(b,a)},BuildUnary:function(a){var b=unaryOperators.getOperator(a.value,a.arity),c=b.expressionType,a=this.Build2(a.first);return new $data.Expressions.UnaryExpression(a,b,c)},BuildSimpleBinary:function(a){var b=binaryOperators.getOperator(a.value),c=b.expressionType,d=this.Build2(a.first||
a.left),e=this.Build2(a.second||a.right);return new $data.Expressions.SimpleBinaryExpression(d,e,c,a.value,b.type)}});$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.value=a;this.type=Container.getTypeName(a);this.name=c},nodeType:{value:ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:void 0,writable:!0},toString:function(){return this.value.toString()}});
$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.parameters=b||[];this.name=a;this.body=c},toString:function(a){var b=this.parameters.map(function(a){return a.toString()}),b=b.join(","),a=this.body?this.body.toString(a):"";return"function "+this.name+"("+b+") { "+a+"}"},nodeType:{value:ExpressionType.Function,writable:!0},parameters:{value:void 0,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:void 0,dataType:$data.Expressions.ExpressionNode},
type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.fieldName=a;this.expression=b},nodeType:{value:ExpressionType.ObjectField,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.members=a},nodeType:{value:ExpressionType.ObjectLiteral,writable:!0},toString:function(){return"unimplemented"},implementation:{get:function(){return function(a){var b={};a.forEach(function(a){b[a.name]=a.value});return b}},set:function(){}}},null);
$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.amount=b;this.nodeType=c},nodeType:{value:ExpressionType.Unknown,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.nodeType=c||ExpressionType.Parameter;this.name=a;this.type=b||"unknown"},owningFunction:{value:void 0,enumerable:!1},nodeType:{value:ExpressionType.Parameter,writable:!0},name:{value:void 0,dataType:String,writable:!0},type:{value:void 0,dataType:"object",writable:!0},toString:function(a){a=a?this.type+" ":"";return a=a+this.name}},null);
$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Object.defineProperty(this,"expression",{value:a,enumerable:true});Object.defineProperty(this,"member",{value:b,enumerable:true});this.type=b.dataType},nodeType:{value:ExpressionType.MemberAccess},expression:{value:void 0,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(a,b){a[b]===void 0&&Guard.raise(new Exception("Parameter '"+b+"' not found in context",
"Property not found!"));return a[b]}},set:function(){}},member:{value:void 0,dataType:$data.MemberDefinition,writable:!0},type:{value:void 0,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}});
$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d,e,h){this.left=a;this.right=b;this.nodeType=c;this.operator=d;this.type=e;this.resolution=h},implementation:{get:function(){return binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:ExpressionType.This}});
$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){if(!a)return a;var c=null;switch(a.expressionType){case $data.Expressions.ParameterExpression:c=this.VisitParameter(a,b);break;case $data.Expressions.ConstantExpression:c=this.VisitConstant(a,b);break;case $data.Expressions.FunctionExpression:c=this.VisitFunction(a,b);break;case $data.Expressions.CallExpression:c=this.VisitCall(a,b);break;case $data.Expressions.SimpleBinaryExpression:c=this.VisitBinary(a,
b);break;case $data.Expressions.PropertyExpression:c=this.VisitProperty(a,b);break;case $data.Expressions.ThisExpression:c=this.VisitThis(a,b);break;case $data.Expressions.ObjectLiteralExpression:c=this.VisitObjectLiteral(a,b);break;case $data.Expressions.ObjectFieldExpression:c=this.VisitObjectField(a,b);break;case $data.Expressions.ArrayLiteralExpression:c=this.VisitArrayLiteral(a,b);break;case $data.Expressions.UnaryExpression:c=this.VisitUnary(a,b);break;default:debugger}this._deep=this._deep-
1;return c},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});return Container.createArrayLiteralExpression(d)},VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});return Container.createObjectLiteralExpression(d)},VisitObjectField:function(a,b){var c=this.Visit(a.expression,b);return Container.createObjectFieldExpression(a.fieldName,c)},VisitThis:function(a){return a},VisitCall:function(a,b){var c=a.args.map(function(a){return this.Visit(a,
b)},this),d=this.Visit(a.expression,b),e=this.Visit(a.member,b);return new $data.Expressions.CallExpression(d,e,c)},VisitParameter:function(a){return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,
a.operator,a.type)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return new $data.Expressions.PropertyExpression(c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:new $data.Expressions.UnaryExpression(c,a.operator,a.nodeType)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,
c,d,e)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,
b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(a,b){if((a instanceof $data.Expressions.ParameterExpression||a instanceof $data.Expressions.ThisExpression)&&this.canResolve(a)){var c=this.resolve(a,b);if(c!==a)c.resolvedBy=this.constructor.name;return c}return a},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}});
$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){this.global=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.Parameter&&a.name in this.global},resolve:function(a){var b=this.global[a.name];return Container.createConstantExpression(b,typeof b,a.name)}});
$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(a,b){this.globalResolver=Container.createGlobalContextProcessor(b);this.paramsObject=a},canResolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?true:this.globalResolver.canResolve(a)},resolve:function(a){return a.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.globalResolver.resolve(a)}});
$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(a){this.canResolve=function(b){return b.nodeType==$data.Expressions.ExpressionType.Parameter&&a("typeof "+b.name)!=="undefined"};this.resolve=function(b){b=a(b.name);return Container.createConstantExpression(b,typeof b)}}});
$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(a){var b={};this.canResolve=function(c){if(c.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var d=c.owningFunction.parameters;if(d.length==1&&c.name==d[0].name){b[c.name]=a[0];return true}for(var e=0;e<d.length;e++)if(d[e].name==c.name){b[c.name]=a[e];return true}}return false};this.resolve=function(a){var d=Container.createParameterExpression(a.name,b[a.name],$data.Expressions.ExpressionType.LambdaParameter);
Object.defineProperty(d,"owningFunction",{value:a.owningFunction,enumerable:false});return d}}});
$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,a,b)},VisitArrayLiteral:function(a,b){var c=this,d=a.items.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return a.value});return Container.createConstantExpression(d,"array")}return Container.createArrayLiteralExpression(d)},
VisitObjectLiteral:function(a,b){var c=this,d=a.members.map(function(a){return c.Visit(a,b)});if(d.every(function(a){return a.expression instanceof $data.Expressions.ConstantExpression})){d=d.map(function(a){return{name:a.fieldName,value:a.expression.value}});return Container.createConstantExpression(a.implementation(d))}return Container.createObjectLiteralExpression(d)},VisitThis:function(a,b){return b.Visit(a,b)},VisitParameter:function(a,b){var c;switch(a.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:c=
b.Visit(a,b);c.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[c.name]=c);return c;case $data.Expressions.ExpressionType.LambdaParameterReference:if(c=this.lambdaParamCache[a.name]){c=Container.createParameterExpression(a.name,c.type,$data.Expressions.ExpressionType.LambdaParameterReference);c.paramIndex=a.paramIndex;return c}}return a},VisitConstant:function(a){return a},VisitFunction:function(a,b){var c=this,d=a.parameters.map(function(a){return c.Visit(a,b)}),
e=c.Visit(a.body,b);return new $data.Expressions.FunctionExpression(a.name,d,e)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=$data.Expressions;if(c instanceof e.ConstantExpression&&d instanceof e.ConstantExpression){c=a.implementation(c.value,d.value);return Container.createConstantExpression(c)}return new Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);if(c instanceof $data.Expressions.ConstantExpression){c=
a.operator.implementation(c.value);return Container.createConstantExpression(c)}return new Container.createUnaryExpression(c,a.operator,a.nodeType)},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e;if(c instanceof $data.Expressions.ConstantExpression&&d instanceof $data.Expressions.ConstantExpression){e=a.implementation(c.value,d.value);return Container.createConstantExpression(e,typeof e,c.name+"$"+d.value)}if(c===a.expression&&d===a.member)return a;return e=
Container.createPropertyExpression(c,d)},VisitCall:function(a,b){var c=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),d=c.expression,e=c.member,h=c.args;if(function(a,b,c){return b instanceof $data.Expressions.ConstantExpression&&(!c||c instanceof $data.Expressions.ConstantExpression)&&a.every(function(a){return a instanceof $data.Expressions.ConstantExpression})}(h,e,d)){c=e.value;typeof c==="string"&&d.value&&(c=d.value[c]);typeof c!=="function"&&Guard.raise("Constant expression is not a method...");
d=a.implementation(d.value,c,h);return new $data.Expressions.ConstantExpression(d)}return c}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){for(var d=0;d<a.length;d++){var e=a[d].Visit(b,c);if(e!==b)return e}return b}}});
$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b),e=b.memberResolver.resolve(c.type,d.value);d.type=e;return Container.createPropertyExpression(c,d)}},{});
$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(a,b){this._deep=this._deep+1;var c=null;switch(a.type){case LITERAL:c=this.VisitLiteral(a,b);break;case VARIABLE:c=this.VisitVariable(a,b);break;case MEMBERACCESS:c=this.VisitMember(a,b);break;case BINARY:c=this.VisitBinary(a,b);break;case UNARY:c=this.VisitUnary(a,b);break;case INCDEC:c=this.VisitIncDec(a,b);break;case EQUALITY:c=this.VisitEquality(a,b);break;case DECISION:c=this.VisitDecision(a,
b);break;case METHODCALL:c=this.VisitMethodCall(a,b);break;case NEW:c=this.VisitNew(a,b);break;case JSONASSIGN:c=this.VisitJsonAssign(a,b);break;case ARRAYACCESS:c=this.VisitArrayAccess(a,b);break;default:Guard.raise("Type isn't implemented: "+a.type)}this._deep=this._deep-1;return c},VisitLiteral:function(a){return a},VisitVariable:function(a){return a},VisitMember:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);return c===a.expression&&d===a.member?a:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(a.executable,
c,d)},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,
a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e)},VisitMethodCall:function(a,
b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=
true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},GetMemberChain:function(a,b){if(a.expression.type==MEMBERACCESS){var c=this.GetMemberChain(a.expression,
b);c.push(a.member);return c}return[a.expression,a.member]}},{});
$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(a,b){switch(a.type){case LITERAL:return this.VisitLiteral(a,b);case VARIABLE:return this.VisitVariable(a,b);case MEMBERACCESS:return this.VisitMember(a,b);case BINARY:return this.VisitBinary(a,b);case UNARY:return this.VisitUnary(a,b);case INCDEC:return this.VisitIncDec(a,b);case EQUALITY:return this.VisitEquality(a,b);case DECISION:return this.VisitDecision(a,b);case METHODCALL:return this.VisitMethodCall(a,
b);case NEW:return this.VisitNew(a,b);case JSONASSIGN:return this.VisitJsonAssign(a,b);case ARRAYACCESS:return this.VisitArrayAccess(a,b);default:Guard.raise("Type isn't implemented: "+a.type)}},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(c.executable&&d.executable,a.operator,c,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,
b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(c.executable,a.operator,c)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);return c===a.operand?a:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(c.executable,a.operator,c,a.suffix)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);return c===a.left&&d===a.right&&c.executable&&d.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(c.executable&&
d.executable,a.operator,c,d)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);return c===a.expression&&d===a.left&&e===a.right&&d.executable&&e.executable&&c.executable==a.executable?a:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(d.executable&&e.executable&&c.executable,c,d,e)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);return c===a.object&&d===a.args&&(c==null?
true:c.executable)==a.executable?a:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(c==null?true:c.executable,c,a.method,d)},VisitNew:function(a,b){var c=this.VisitArray(a.values,b);return c===a.values?a:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,c)},VisitJsonAssign:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c===a.left&&d===a.right)return a;c.JSONASSIGN=true;d.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,
c,d)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b);return c===a.array&&d===a.index?a:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,c,d)},VisitArray:function(a,b){for(var c=[],d=true,e=0;e<a.length;e++){c[e]=this.Visit(a[e],b);d=d&&c[e]===a[e]}return d?a:c},VisitLiteral:function(a){return{type:a.type,executable:true,value:a.value,valueType:a.valueType}},VisitVariable:function(a,b){typeof b.paramContext[a.name]==void 0&&Guard.raise("Variable is not defined in the paramContext: "+
a.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT")},VisitMember:function(a,b){var c=this.GetMemberChain(a)[0].name,d=b.lambdaParams.indexOf(c)>=0,e=c==b.paramsName;!e&&!d&&Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+c);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(e,a.expression,a.member)}},null);
$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(a,b){if(!a.executable)return a;var c=a.name==b.paramsName?b.paramContext:window[a.name];typeof c=="undefined"&&Guard.raise(new Exception("Unknown variable in '"+b.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+a.name+"'.","InvalidOperation",{operationName:b.operation,missingParameterName:a.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,
typeof c,c)},VisitMember:function(a,b){if(!a.executable)return a;for(var c=this.GetMemberChain(a),d,e=0;e<c.length;e++)d=e==0?b.paramContext:d[c[e].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof d,d)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(a.executable,a.operator,c));if(!a.executable)return a;eval("value = "+a.operator+" "+(c.valueType=="string"?"'"+c.value+
"'":c.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitIncDec:function(a,b){var c=this.Visit(a.operand,b);c!==a.operand&&(a=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(a.executable,a.operator,c,a.suffix));if(!a.executable)return a;c=a.suffix?a.operator=="++"?c.value++:c.value--:a.operator=="++"?++c.value:--c.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitBinary:function(a,
b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitEquality:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);if(c!==a.left||d!==a.right)a=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(a.executable,a.operator,c,d);if(!a.executable)return a;eval("value = "+(c.valueType=="string"?"'"+c.value+"'":c.value)+" "+a.operator+" "+(d.valueType=="string"?"'"+d.value+"'":d.value));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitDecision:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.left,b),e=this.Visit(a.right,b);if(c!==
a.expression||d!==a.left||e!==a.right)a=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(a.executable,c,d,e);if(!a.executable)return a;c=c.value?d.value:e.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)},VisitMethodCall:function(a,b){var c=a.object?this.Visit(a.object,b):null,d=this.VisitArray(a.args,b);if(c!==a.object||d!=a.args)a=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(a.executable,c,a.method,d);if(!a.executable)return a;
for(var e=[],h=0;h<d.length;h++){var f=d[h];e.push(typeof f.value=="string"?"'"+f.value+"'":f.value)}c=c?"value = object.value[eNode.method]("+e.join(",")+");":"value = "+a.method+"("+e.join(",")+");";eval(c);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"undefined",void 0)},VisitArrayAccess:function(a,b){var c=this.Visit(a.array,b),d=this.Visit(a.index,b),c=c.value[d.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof c,c)}},
null);
$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(a){this.context=a},_isLambdaParam:function(a){for(var b=this.context.lambdaParams,c=0;c<b.length;c++)if(b[c]==a)return true;return false},_isParam:function(a){return this.context.paramContext[a]!=void 0},_isParamRoot:function(a){return this.context.paramsName==a},Build:function(a,b){var c;switch(a.arity){case "infix":"("==a.value?c=this.BuildMethodCall(a,b):"."==a.value?c=this.BuildMember(a,b):["===","==","!==",
"!=",">","<",">=","<="].indexOf(a.value)>=0?c=this.BuildEquality(a,b):["&&","||"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):["+","-","*","/","%"].indexOf(a.value)>=0?c=this.BuildBinary(a,b):"["==a.value?c=this.BuildArrayAccess(a,b):Guard.raise("Value of infix node isn't implemented: "+a.value);break;case "prefix":["+","-","!"].indexOf(a.value)>=0?c=this.BuildUnary(a,b):["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):"{"==a.value?c=this.BuildNewExpression(a,b):Guard.raise("Value of prefix node isn't implemented: "+
a.value);break;case "suffix":["++","--"].indexOf(a.value)>=0?c=this.BuildIncDec(a,b):Guard.raise("Value of suffix node isn't implemented: "+a.value);break;case "string":case "number":c=this.BuildLiteral(a,b);break;case "ternary":a.value=="?"?c=this.BuildDecision(a,b):Guard.raise("Value of ternary node isn't implemented: "+a.value);break;case null:case void 0:c=a.type=="boolean"&&(a.value=="true"||a.value=="false")?this.BuildBoolLiteral(a,b):this.BuildVariable(a,b);break;default:Guard.raise("Arity isn't implemented: "+
a.arity)}return c},BuildNewExpression:function(a){for(var b=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]),a=a.first,c=0;c<a.length;c++)b.values.push(this.Build(a[c],b));return b},BuildLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value)},BuildBoolLiteral:function(a){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.type,a.value=="true"?true:false)},BuildVariable:function(a,b){if(!a.first){if(b.type==
MEMBERACCESS){var c;c=this._isLambdaParam(a.value)?"LAMBDAPARAM":this._isParamRoot(a.value)?"PARAMETERROOT":this._isParam(a.value)?"PARAMETER":"PROPERTY"}else this._isLambdaParam(a.value)?c="LAMBDAPARAM":this._isParamRoot(a.value)?c="PARAMETERROOT":this._isParam(a.value)?c="PARAMETER":window[a.value]!=void 0?c="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+
a.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:a.value}));return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,a.value,c)}c=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",a.value);var d=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true),e=this.Build(a.first,d);d.left=c;d.right=e;c.JSONASSIGN=true;e.JSONASSIGN=true;return d},BuildMember:function(a){if(a.value!="."||a.arity!=
"infix")return a.type=="string"?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,a.arity,a.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,a.value);var b=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true),c=this.Build(a.first,b),a=this.Build(a.second,b);b.expression=c;b.member=a;return b},BuildUnary:function(a){var b=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,a.value);b.operand=this.Build(a.first,
b);return b},BuildIncDec:function(a){var b=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,a.value,null,a.arity=="suffix");b.operand=this.Build(a.first,b);return b},BuildBinary:function(a){a.first||Guard.raise("Cannot build binary: node.first is null");a.second||Guard.raise("Cannot build binary: node.second is null");var b=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildEquality:function(a){var b=
$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,a.value);b.left=this.Build(a.first,b);b.right=this.Build(a.second,b);return b},BuildDecision:function(a){var b=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);b.expression=this.Build(a.first,b);b.left=this.Build(a.second,b);b.right=this.Build(a.third,b);return b},BuildMethodCall:function(a){var b=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(a.first.type=="function"){b.object=
this.Build(a.first.first,b);b.method=a.first.second.value}else{a.first.type!=null&&Guard.raise("Cannot build MethodCall because type is "+type);b.object=null;b.method=a.first.value}for(var a=a.second,c=[],d=0;d<a.length;d++)c[d]=this.Build(a[d],b);b.args=c;return b},BuildArrayAccess:function(a){var b=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);b.array=this.Build(a.first,b);b.index=this.Build(a.second,b);return b}},null);
$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.associationInfo=a},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}});
$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Container.resolveType(Container.getTypeName(a))==$data.String&&a.replace(/^[\s\xA0]+/,"").match("^function")!="function"&&(a="function (it) { return "+a+"; }");this.source=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}});
$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(a){this.scopeContext=a;this.parameters=[]},VisitBinary:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,b),e=this.scopeContext.resolveBinaryOperator(a.nodeType,a,b.frameType);return Container.createSimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,e)},VisitUnary:function(a,b){var c=this.Visit(a.operand,b),d=this.scopeContext.resolveUnaryOperator(a.nodeType,a,b.frameType);
return Container.createUnaryExpression(c,a.operator,a.nodeType,d)},VisitParameter:function(a,b){Guard.requireValue("context",b);var c=$data.Expressions.ExpressionType;switch(a.nodeType){case c.LambdaParameterReference:return Container.createEntityExpression(b.lambdaParameters[a.paramIndex],{lambda:a.name});case c.LambdaParameter:break;default:Guard.raise("Global parameter "+a.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(a,b){var c=this.parameters.push({name:"",
value:void 0})-1;return Container.createQueryParameterExpression("",c,b.queryParameters,void 0)},VisitFunction:function(a,b){return $data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments).body},VisitCall:function(a,b){var c=this,d=this.Visit(a.expression,b),e=this.Visit(a.member,b),h=a.args.map(function(a){return c.Visit(a,b)});switch(true){case d instanceof $data.Expressions.QueryParameterExpression:h=h.map(function(a){return a.value});h=a.implementation(d.value,e.value,
h);return Container.createQueryParameterExpression(d.name+"$"+e.value,d.index,h,typeof h);case d instanceof $data.Expressions.EntityFieldExpression:case d instanceof $data.Expressions.EntityFieldOperationExpression:var f=this.scopeContext.resolveFieldOperation(e.value,d,b.frameType);f||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return h=Container.createEntityFieldOperationExpression(d,e,h);case d instanceof $data.Expressions.EntitySetExpression:(f=
this.scopeContext.resolveSetOperations(e.value,d,b.frameType))||Guard.raise("Unknown entity field operation: "+e.getJSON());e=Container.createMemberInfoExpression(f);return h=Container.createFrameOperationExpression(d,e,h);default:Guard.raise("VisitCall: Only fields can have operations: "+a.getType().name)}},VisitProperty:function(a,b){var c=this.Visit(a.expression,b),d=this.Visit(a.member,b);Guard.requireType("member",d,$data.Expressions.ConstantExpression);switch(c.expressionType){case $data.Expressions.EntityExpression:var e=
c.getMemberDefinition(d.value);e||Guard.raise(new Exception("Unknown member: "+d.value,"MemberNotFound"));switch(e.storageModel.PhysicalType.memberDefinitions.getMember(e.name).kind){case "property":d=Container.createMemberInfoExpression(e);return c=Container.createEntityFieldExpression(c,d);case "navProperty":d=e.storageModel.Associations[e.name];c=Container.createEntitySetExpression(c,Container.createAssociationInfoExpression(d));return d.ToMultiplicity!=="*"?Container.createEntityExpression(c,
{}):c;case "complexProperty":d=Container.createMemberInfoExpression(e);return c=Container.createComplexTypeExpression(c,d)}case $data.Expressions.ComplexTypeExpression:(e=c.getMemberDefinition(d.value))||Guard.raise("Unknown member "+d.value+" on "+c.entityType.name);d=Container.createMemberInfoExpression(e);if(Container.isPrimitiveType(Container.resolveType(e.dataType)))return c=Container.createEntityFieldExpression(c,d);return c=Container.createComplexTypeExpression(c,d);case $data.Expressions.QueryParameterExpression:e=
a.implementation(c.value,d.value);this.parameters[c.index].name=this.parameters[c.index].name+("$"+d.value);this.parameters[c.index].value=e;return Container.createQueryParameterExpression(c.name+"$"+d.value,c.index,e,Container.getTypeName(e));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:(e=this.scopeContext.resolveFieldOperation(d.value,c,b.frameType))||Guard.raise("Unknown entity field operation: "+d.getJSON());d=Container.createMemberInfoExpression(e);
return c=Container.createEntityFieldOperationExpression(c,d,[]);default:Guard.raise("Unknown expression type to handle: "+c.expressionType.name)}}});
$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireType("source",a,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",b,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=a;this.selector=b;var c=a.entityType.getMemberDefinition(b.memberName).dataType;this.entityType=Container.resolveType(c)},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},
nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){Object.defineProperty(this,"instance",{value:a,enumerable:false})},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}});
$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){Guard.requireValue("source",a);Guard.requireValue("selector",b);!(a instanceof $data.Expressions.EntitySetExpression)&&!(a instanceof $data.Expressions.ServiceOperationExpression)&&Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");this.source=a;this.selector=b;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",
this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(a){var b=this.entityType.getMemberDefinition(a);b||Guard.raise(new Exception("Unknown member "+a+" on type "+this.entityType.name,"MemberNotFound"));b.storageModel=this.storageModel;return b},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(a){return a instanceof $data.Expressions.ExpressionNode},Visit:function(a,b){if(!this.canVisit(a))return a;var c="Visit"+a.getType().name;if(c in this){c=this[c].call(this,a,b);return typeof c==="undefined"?a:c}return a},VisitToArrayExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createToArrayExpression(c):a},VisitForEachExpression:function(a,
b){var c=this.Visit(a.source,b);return c!==a.source?Container.createForEachExpression(c):a},VisitMemberInfoExpression:function(a){return a},VisitSingleExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSingleExpression(c):a},VisitFirstExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createFirstExpression(c):a},VisitSomeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createSomeExpression(c):
a},VisitEveryExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createEveryExpression(c):a},VisitCountExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createCountExpression(c):a},VisitObjectLiteralExpression:function(a,b){for(var c=a.members.map(function(a){return this.Visit(a,b)},this),d=true,e=0;e<a.members.length;e++)d=d&&a.members[e]===c[e];return!d?Container.createObjectLiteralExpression(c):a},VisitObjectFieldExpression:function(a,
b){var c=this.Visit(a.expression,b);return a.expression!==c?Container.createObjectFieldExpression(a.fieldName,c):a},VisitIncludeExpression:function(a,b){var c=this.Visit(a.source,b);return c!==a.source?Container.createIncludeExpression(c,a.selector):a},VisitUnaryExpression:function(a,b){var c=this.Visit(a.operand,b);return a.operand!==c?Container.createUnaryExpression(c,a.operator,a.nodeType,a.resolution):a},VisitSimpleBinaryExpression:function(a,b){var c=this.Visit(a.left,b),d=this.Visit(a.right,
b);return c!==a.left||d!==a.right?new $data.Expressions.SimpleBinaryExpression(c,d,a.nodeType,a.operator,a.type,a.resolution):a},VisitEntityContextExpression:function(a){return a},VisitCodeExpression:function(a){return a},VisitComplexTypeExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createComplexTypeExpression(c,d):a},VisitEntityExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==
a.source||d!==a.selector?Container.createEntityExpression(c,d):a},VisitEntityFieldExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntityFieldExpression(c,d):a},VisitEntityFieldOperationExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.operation,b),e=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createEntityFieldOperationExpression(c,d,e)},VisitParametricQueryExpression:function(a,
b){var c=this.Visit(a.expression,b),d=a.parameters.map(function(a){return this.Visit(a)},this);return Container.createParametricQueryExpression(c,d)},VisitEntitySetExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createEntitySetExpression(c,d,a.params,a.instance):a},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,
d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createProjectionExpression(c,d,a.params,a.instance):a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a},VisitPagingExpression:function(a,b){var c=this.Visit(a.source,b),d=this.Visit(a.amount,b);return c!==
a.source||d!==a.amount?Container.createPagingExpression(c,d,a.nodeType):a}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.selector=b;this.source=a;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)this.memberName=this.selector.name},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});
$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.source=a;this.operation=b;this.parameters=c},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});
$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);Object.defineProperty(this,"source",{value:a,enumerable:true,writable:true});Object.defineProperty(this,"selector",{value:b,enumerable:true,
writable:true});Object.defineProperty(this,"params",{value:c,enumerable:true,writable:true});Object.defineProperty(this,"instance",{value:d,enumerable:false,writable:true});this.storage_type={};a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",b,$data.Expressions.MemberInfoExpression);this.elementType=b.memberDefinition.elementType;this.storageModel=
a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",b,$data.Expressions.AssociationInfoExpression);this.elementType=b.associationInfo.ToType;this.storageModel=a.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof
$data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:!0}});
$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true}});
$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}});
$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}});$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}});
$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}});$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}});
$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(a){this.source=a;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}});$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:ExpressionType.Include,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a){this.memberDefinition=a;this.memberName=a.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}});$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(a,b,c){this.nodeType=c},nodeType:{value:ExpressionType.OrderBy,writable:!0},toString:function(){return"unimplemented"}},null);
$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b){this.expression=a;this.parameters=b},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}});$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}});
$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){Guard.requireValue("scopeContext",a);this.scopeContext=a},VisitEntitySetExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitServiceOperationExpression:function(a){a.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(a);return a},VisitCodeExpression:function(a,b){var c=a.source.toString(),
c=Container.createCodeParser(this.scopeContext).createExpression(c);this.scopeContext.log({event:"JSCodeExpression",data:c});var d=Container.createConstantValueResolver(a.parameters,window),c=Container.createParameterResolverVisitor().Visit(c,d);this.scopeContext.log({event:"JSCodeExpressionResolved",data:c});d=Container.createCodeToEntityConverter(this.scopeContext);c=d.Visit(c,{queryParameters:a.parameters,lambdaParameters:this.lambdaTypes,frameType:b.frameType});d=Container.createParametricQueryExpression(c,
d.parameters);this.scopeContext.log({event:"EntityExpression",data:c});return d},VisitFilterExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createFilterExpression(c,d,a.params,a.instance):a},VisitProjectionExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createProjectionExpression(c,
d,a.params,a.instance):a},VisitOrderExpression:function(a,b){var c=this.Visit(a.source,b),b=b||{};b.frameType=a.getType();var d=this.Visit(a.selector,b);return c!==a.source||d!==a.selector?Container.createOrderExpression(c,d,a.nodeType):a}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c){this.name=a;this.index=b;this.value=c;this.type=Container.getTypeName(c)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}});
$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(a){return this.entityType.getMemberDefinition(a)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});
$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(a,b,c,d){Guard.requireType("source",a,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",a,[$data.Expressions.MemberInfoExpression]);Object.defineProperty(this,"source",{value:a,enumerable:true,writable:true});Object.defineProperty(this,"selector",{value:b,enumerable:true,writable:true});Object.defineProperty(this,"params",{value:c,enumerable:true,writable:true});Object.defineProperty(this,
"cfg",{value:d,enumerable:false,writable:true});a:{for(;a;){if(a instanceof $data.Expressions.EntityContextExpression)break a;a=a.source}a=void 0}switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=d.elementType?Container.resolveType(d.elementType):Container.resolveType(d.returnType);this.storageModel=d.elementType?a.instance._storageModel.getStorageModel(Container.resolveType(d.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+
this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}});$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(a,b,c){this.Message=a;this.PropertyDefinition=b;this.Type=c},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);
$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;
$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(a){var b=[];a.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){b=b.concat(this.ValidateEntityField(a,c,void 0,true))},this);return b},ValidateEntityField:function(a,b,c,d){var e=[],h=Container.resolveName(Container.resolveType(b.dataType));this.fieldValidate(a,b,!d?c:a[b.name],e,h);return e},getValidationValue:function(a,b){return a[b]&&a[b].value?a[b].value:
a[b]},getValidationMessage:function(a,b,c){if(typeof a[b]=="object"&&a[b].message)c=a[b].message;else if(a.errorMessage)c=a.errorMessage;return c},createValidationError:function(a,b,c){return new $data.Validation.ValidationError(this.getValidationMessage(a,b,c),a,b)},supportedValidations:{value:{"$data.Number":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||
a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Integer":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.String":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||
typeof b=="function"?b(a):true},minLength:function(a,b){return Object.isNullOrUndefined(a)||a.length>=b},maxLength:function(a,b){return Object.isNullOrUndefined(a)||a.length<=b},length:function(a,b){return Object.isNullOrUndefined(a)||a.length==b},regex:function(a,b){return Object.isNullOrUndefined(a)||a.match(b)}},"$data.Date":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},minValue:function(a,
b){return Object.isNullOrUndefined(a)||a>=b},maxValue:function(a,b){return Object.isNullOrUndefined(a)||a<=b}},"$data.Boolean":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}},"$data.Array":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true},length:function(a,b){return Object.isNullOrUndefined(a)||
a.length==b}},"$data.Object":{required:function(a){return!Object.isNullOrUndefined(a)},customValidator:function(a,b){return Object.isNullOrUndefined(a)||typeof b=="function"?b(a):true}}}},fieldValidate:function(a,b,c,d,e){if(!(a.entityState==$data.EntityState.Modified&&a[b.name]==void 0)){var h=this.supportedValidations[e];h&&Object.keys(h).forEach(function(e){b[e]&&h[e]&&!h[e].call(a,c,this.getValidationValue(b,e))&&d.push(this.createValidationError(b,e,"Validation error!"))},this)}}},null);
$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(a){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(a))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null);
$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(a){this.broadcastUrl=a},distributeData:function(a){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(a),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);
$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(a){var b=[];a.forEach(function(a){var d={entityState:a.data.entityState,typeName:a.data.getType().name},e=[];switch(a.data.entityState){case $data.EntityState.Added:e=a.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:e=a.data.changedProperties;break;case $data.EntityState.Deleted:e=a.data.getType().memberDefinitions.getKeyProperties()}e.forEach(function(b){d[b.name]=
a.data[b.name]});b.push(d)});return b}},null);
$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe",
"Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);
$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(a){a=$data.typeSystem.createCallbackSetting(a);return cbWrapper={success:a.success,error:a.error,notify:a.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(a,b,c){this.handler=a;this.state=b;this.thisArg=c},handler:{},state:{},thisArg:{}});
$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(a,b){function c(a,b){a.forEach(function(c,d){c.handler==b&&a.splice(d,1)})}var d=null;this.attach=function(a,c,f){d||(d=[]);d.push(new EventSubscriber(a,c,f||b))};this.detach=function(a){c(d,a)};this.fire=function(c,h){var f=h||b||this;c.eventName=a;d&&d.forEach(function(a){a.handler.call(a.thisArg,f,c,a.state)})}}});
var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(a,b,c){this.propertyName=a;this.oldValue=b;this.newValue=c},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(a,b,c,d){this.propertyName=a;this.oldValue=b;this.newValue=c;this.errors=d;this.cancel=false},propertyName:{},
oldValue:{},newValue:{},errors:{},cancel:{}});
$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(a){this.getType().__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this);Object.defineProperty(this,"initData",{enumerable:false,configurable:true,writable:true,value:{}});var b=null;Object.defineProperty(this,"context",{enumerable:false,configurable:false,get:function(){return b},set:function(a){b=a}});if(arguments.length==1&&typeof a==="object"){var c=this.getType().memberDefinitions.getPublicMappedProperties().map(function(a){return a.name});
if(Object.keys(a).every(function(a){return c.indexOf(a)!=-1}))this.initData=a}},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var a={},b=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(c){a[c.name]=b[c.name]});return a},equals:function(a){if(a.getType()!==this.getType())return false;for(var b=this.getType().memberDefinitions.getKeyProperties(),c=0;c<b.length;c++)if(this[b[c].name]==a[b[c].name])return true;
return false},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyChanging");if(a){delete this.propertyChanging;delete a.get;delete a.set;Object.defineProperty(this,"propertyChanging",a.createPropertyDescriptor());return this.propertyChanging=new Event("propertyChanging",this)}},set:function(){}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,
notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyChanged");if(a){delete this.propertyChanged;delete a.get;delete a.set;Object.defineProperty(this,"propertyChanged",a.createPropertyDescriptor());return this.propertyChanged=new Event("propertyChanged",this)}},set:function(){}},propertyValidationError:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){var a=this.getType().memberDefinitions.getMember("propertyValidationError");
if(a){delete this.propertyValidationError;delete a.get;delete a.set;Object.defineProperty(this,"propertyValidationError",a.createPropertyDescriptor());return this.propertyValidationError=new Event("propertyValidationError",this)}},set:function(){}},storeProperty:function(a,b){var c=null;if(a.monitorChanges!=false&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var d=this[a.name],c=new PropertyChangeEventData(a.name,d,b);this._propertyChanging&&this.propertyChanging.fire(c)}if(a.monitorChanges!=
false&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var e=$data.Validation.Entity.ValidateEntityField(this,a,b);if(e.length>0){d=this[a.name];d=new PropertyValidationEventData(a.name,d,b,e);this._propertyValidationError&&this.propertyValidationError.fire(d);"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(d,this);if(d.cancel==true)return}}if(a.storeOnObject==true){d="_"+a.name;this[d]?this[d]=b:Object.defineProperty(this,
d,a.createStorePropertyDescriptor(b))}else this.initData[a.name]=b;this.isValidated=false;if(a.monitorChanges!=false&&this.entityState==$data.EntityState.Unchanged)this.entityState=$data.EntityState.Modified;if(a.monitorChanges!=false){if(!this.changedProperties)this.changedProperties=[];this.changedProperties.some(function(b){return b.name==a.name})||this.changedProperties.push(a);this._propertyChanged&&this.propertyChanged.fire(c);"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(c,
this)}},retrieveProperty:function(a){return a.storeOnObject==true?this["_"+a.name]:this.initData[a.name]},getProperty:function(a,b){if(this[a.name]!=void 0)b(this[a.name]);else{this.context||Guard.raise(new Exception("Entity not in context","Invalid operation"));return this.context.loadItemProperty(this,a,b)}},setProperty:function(a,b,c){this[a.name]=b;c()},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);this.isValidated=true}return this.ValidationErrors.length==
0},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",storeOnObject:!0,monitorChanges:!1,
notMapped:!0,enumerable:!1}},{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0}});$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},TableName:{},ComplexTypes:{},Associations:{},EntitySetReference:{}},null);
$data.Class.define("$data.Assiociation",null,null,{constructor:function(a){if(a){this.From=a.From;this.FromType=a.FromType;this.FromMultiplicity=a.FromMultiplicity;this.FromPropertyName=a.FromPropertyName;this.To=a.To;this.ToType=a.ToType;this.ToMultiplicity=a.ToMultiplicity;this.ToPropertyName=a.ToPropertyName}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);
$data.Class.define("$data.ComplexType",$data.Assiociation,null,{},null);
$data.Class.define("$data.EntityContext",null,null,{constructor:function(a){this.trackChanges=this.lazyLoad=false;this._entitySetReferences={};this._storageModel=[];var b=this;this._storageModel.getStorageModel=function(a){var c=Container.resolveType(a);return b._storageModel.filter(function(a){return a.LogicalType===c})[0]};if(typeof a.name==="string")a.name=[a.name];for(var c=0,d;!(d=$data.StorageProviderBase.getProvider(a.name[c]))&&c<a.name.length;)c++;if(d){this.storageProvider=new d(a,this);
this.storageProvider.setContext(this);this.stateManager=new $data.EntityStateManager(this);if(a.name in this.getType()._storageModelCache)this._storageModel=this.getType()._storageModelCache[a.name];else{this._initializeStorageModel();this.getType()._storageModelCache[a.name]=this._storageModel}}else Guard.raise(new Exception("Provider fallback failed!","Not Found"));this._initializeEntitySets(this.constructor);this._isOK=false;a=$data.typeSystem.createCallbackSetting({success:this._successInitProvider});
this.storageProvider&&this.storageProvider.initializeStore(a)},getDataType:function(a){if(typeof a=="string"){var b=this[a];if(b===void 0||b===null)b=eval(a);return b}return a},_initializeEntitySets:function(a){a.inheritsFrom!==null&&a.inheritsFrom!==void 0&&this._initializeEntitySets(a.inheritsFrom);this._storageModel.forEach(function(a){this[a.ItemName]=new $data.EntitySet(a.LogicalType,this,a.ItemName);this[a.ItemName].name=a.ItemName;this[a.ItemName].tableName=a.TableName;this._entitySetReferences[a.LogicalType.name]=
this[a.ItemName];a.EntitySetReference=this[a.ItemName]},this)},_initializeStorageModel:function(){this.getType().memberDefinitions.asArray().forEach(function(a){if("dataType"in a){var b=Container.resolveType(a.dataType);if(b&&b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){b=new $data.StorageModel;b.TableName=a.tableName||a.name;b.ItemName=a.name;b.LogicalType=Container.resolveType(a.elementType);b.LogicalTypeName=b.LogicalType.name;b.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(b.LogicalTypeName);
this._storageModel.push(b)}}},this);typeof intellisense==="undefined"&&this._storageModel.forEach(function(a){var b={};a.Associations=a.Associations||[];a.ComplexTypes=a.ComplexTypes||[];a.LogicalType.memberDefinitions.getPublicMappedProperties().forEach(function(c){var e=Container.resolveType(c.dataType);if(this.storageProvider.supportedDataTypes.indexOf(e)>-1&&Object.isNullOrUndefined(c.inverseProperty)){var h=JSON.parse(JSON.stringify(c));h.dataType=e;b[c.name]=h}else{this._buildDbType_navigationPropertyComplite(c,
e,a);if((e===$data.Array||e.isAssignableTo&&e.isAssignableTo($data.EntitySet))&&c.inverseProperty&&c.inverseProperty!=="$$unbound")this._buildDbType_Collection_OneManyDefinition(b,a,e,c);else if(c.inverseProperty)if(c.inverseProperty==="$$unbound")e===$data.Array?this._buildDbType_Collection_OneManyDefinition(b,a,e,c):this._buildDbType_ElementType_OneManyDefinition(b,a,e,c);else(h=e.memberDefinitions.getMember(c.inverseProperty))?h.elementType?Container.resolveType(h.elementType)===a.LogicalType?
this._buildDbType_ElementType_OneManyDefinition(b,a,e,c):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+a.LogicalTypeName,", property: "+c.name)):this._buildDbType_ElementType_OneOneDefinition(b,a,e,c):typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property not valid"));else this._buildDbType_addComplexTypePropertyDefinition(b,a,e,c)}},this);this._buildDbType_modifyInstanceDefinition(b,a,this);
var c={};c.convertTo=this._buildDbType_generateConvertToFunction(a,this);this._buildDbType_modifyClassDefinition(c,a,this);a.PhysicalType=$data.Class.define(a.PhysicalTypeName,$data.Entity,null,b,c)},this)},_buildDbType_navigationPropertyComplite:function(a,b,c){if(a.inverseProperty){e=null;e=b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)?this._storageModel.getStorageModel(Container.resolveType(a.elementType)):this._storageModel.getStorageModel(b);if(b=e.LogicalType.memberDefinitions.getMember(a.inverseProperty))b.inverseProperty?
b.inverseProperty!=a.name&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Inverse property mismatch")):b.inverseProperty=a.name}else{var d=null;if(b===$data.Array||b.isAssignableTo&&b.isAssignableTo($data.EntitySet)){var e=this._storageModel.getStorageModel(Container.resolveType(a.elementType));e&&(d=e.LogicalType.memberDefinitions.getPublicMappedProperties().filter(function(b){return b.inverseProperty==a.name&&Container.resolveType(b.dataType)===Container.resolveType(c.LogicalType)}))}else(e=
this._storageModel.getStorageModel(b))&&(d=e.LogicalType.memberDefinitions.getPublicMappedProperties().filter(function(b){return b.elementType?b.inverseProperty==a.name&&Container.resolveType(b.elementType)===c.LogicalType:b.inverseProperty==a.name&&Container.resolveType(b.dataType)===c.LogicalType}));if(d){d.length>1&&typeof intellisense!=="undefined"&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+a.name+", type: "+Container.resolveName(c.LogicalType)));
if(b=d.pop())a.inverseProperty=b.name}}},_buildDbType_generateConvertToFunction:function(){return function(a){return a}},_buildDbType_modifyInstanceDefinition:function(){},_buildDbType_modifyClassDefinition:function(){},_buildDbType_addComplexTypePropertyDefinition:function(a,b,c,d){this._addNavigationPropertyDefinition(a,d,d.name,$data.MemberTypes.complexProperty);a=this._createComplexElement(b.LogicalType,"",d.name,c,"","");b.ComplexTypes[d.name]=a;b.ComplexTypes.push(a)},_buildDbType_Collection_OneManyDefinition:function(a,
b,c,d){var e=Container.resolveType(d.elementType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty===
"$$unbound"?"$$unbound":"0..1",d.name,c.LogicalType,"*",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneManyDefinition:function(a,b,c,d){var e=Container.resolveType(d.dataType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type",
"Field definition",d));this._addNavigationPropertyDefinition(a,d,d.name);a=this._addAssociationElement(b.LogicalType,d.inverseProperty==="$$unbound"?"$$unbound":"*",d.name,c.LogicalType,"0..1",d.inverseProperty);b.Associations[d.name]=a;b.Associations.push(a)},_buildDbType_ElementType_OneOneDefinition:function(a,b,c,d){var e=Container.resolveType(d.dataType);(e===void 0||e===null)&&typeof intellisense==="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",d));
(c=this._storageModel.filter(function(a){return a.LogicalType===e})[0])||typeof intellisense==="undefined"&&Guard.raise(new Exception("No EntitySet definition following element type","Field definition",d));!c.LogicalType.memberDefinitions.getMember(d.inverseProperty).required&&!d.required&&typeof intellisense==="undefined"&&typeof intellisense==="undefined"&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",d));this._addNavigationPropertyDefinition(a,
d,d.name);association=this._addAssociationElement(b.LogicalType,d.required?"0..1":"1",d.name,c.LogicalType,d.required?"1":"0..1",d.inverseProperty);b.Associations[d.name]=association;b.Associations.push(association)},_addNavigationPropertyDefinition:function(a,b,c,d){var e=JSON.parse(JSON.stringify(b));e.dataType=$data.EntitySet;e.notMapped=true;e.kind=d?d:$data.MemberTypes.navProperty;e.association=c;a[b.name]=e},_addAssociationElement:function(a,b,c,d,e,h){return new $data.Assiociation({From:a.name,
FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:h})},_createComplexElement:function(a,b,c,d,e,h){return new $data.ComplexType({From:a.name,FromType:a,FromMultiplicity:b,FromPropertyName:c,To:d.name,ToType:d,ToMultiplicity:e,ReferentialConstraint:[],ToPropertyName:h})},_successInitProvider:function(a){if(a!=void 0&&a._isOK!=void 0){a._isOK=true;if(a.onReadyFunction)a.onReadyFunction(a)}},onReady:function(a){var b=new $data.PromiseHandler,
a=b.createCallback(a);this.onReadyFunction=a.success;this._isOK&&a.success(this);return b.getPromise()},getEntitySetFromElementType:function(a){var b=this._entitySetReferences[a];if(!b)try{b=this._entitySetReferences[eval(a).name]}catch(c){}return b},executeQuery:function(a,b){var c=new $data.Query(a.expression,a.defaultType,this),b=$data.typeSystem.createCallbackSetting(b),d=this,e={success:function(a){a.buildResultSet(d);a.expression.nodeType===$data.Expressions.ExpressionType.Single||a.expression.nodeType===
$data.Expressions.ExpressionType.Count||a.expression.nodeType===$data.Expressions.ExpressionType.Some||a.expression.nodeType===$data.Expressions.ExpressionType.Every?a.result.length!==1?b.error(new Exception("result count failed")):b.success(a.result[0]):a.expression.nodeType===$data.Expressions.ExpressionType.First?a.result.length===0?b.error(new Exception("result count failed")):b.success(a.result[0]):b.success(a.result)}};e.error=b.error;this.storageProvider.executeQuery(c,e)},saveChanges:function(a){for(var b=
[],c=this.stateManager.trackedEntities,d=new $data.PromiseHandler,e=d.createCallback(a),a=d.getPromise(),h=[];c.length>0;){var f=[];c.forEach(function(a){var b=this._storageModel.getStorageModel(a.data.getType());if(a.data.entityState==$data.EntityState.Unchanged){a.skipSave=true;h.push(a.data)}else if(a.data.entityState==$data.EntityState.Modified&&a.data.changedProperties&&!a.data.changedProperties.some(function(a){a=b.PhysicalType.memberDefinitions.getMember(a.name);if(a.kind==$data.MemberTypes.navProperty){a=
b.Associations[a.association];a=a.FromMultiplicity+a.ToMultiplicity;return a=="*0..1"||a=="0..11"}return true})){a.skipSave=true;h.push(a.data)}b.PhysicalType.memberDefinitions.asArray().filter(function(a){return a.kind==$data.MemberTypes.navProperty}).forEach(function(c){var d=b.Associations[c.name],e=d.ToPropertyName;[].concat(a.data[c.name]).forEach(function(b){if(b){var c=b[e],h=d.FromMultiplicity+d.ToMultiplicity;if(d.FromMultiplicity==="$$unbound")if(b instanceof $data.Array){a.dependentOn=
a.dependentOn||[];b.forEach(function(){a.dependentOn.indexOf(b)<0&&b.skipSave!==true&&a.dependentOn.push(b)},this)}else{a.dependentOn=a.dependentOn||[];a.dependentOn.indexOf(b)<0&&b.skipSave!==true&&a.dependentOn.push(b)}else{switch(h){case "*0..1":c?c instanceof Array?c.indexOf(a.data)==-1&&c.push(a.data):typeof intellisense==="undefined"&&Guard.raise("Item must be array or subtype of array"):b[e]=[a.data];break;default:c?c!==a.data&&typeof intellisense==="undefined"&&Guard.raise("Integrity check error! Item assigned to another entity!"):
b[e]=a.data}switch(h){case "*0..1":case "0..11":a.dependentOn=a.dependentOn||[];a.dependentOn.indexOf(b)<0&&b.skipSave!==true&&a.dependentOn.push(b)}}if(!b.entityState)b.entityState=$data.EntityState.Added;f.indexOf(b)==-1&&f.push(b)}},this)},this)},this);c.forEach(function(a){a.skipSave!==true&&b.push(a)});c=[];f.forEach(function(a){h.some(function(b){return b==a})||b.some(function(b){return b.data==a})||c.push({data:a,entitySet:this.getEntitySetFromElementType(a.getType().name)})},this)}b.forEach(function(a){if(a.dependentOn){for(var b=
[],c=0;c<a.dependentOn.length;c++)h.indexOf(a.dependentOn[c])<0&&b.push(a.dependentOn[c]);a.dependentOn=b}});var h=null,k=this;if(b.length==0){e.success();return a}var i=[];b.forEach(function(a){a.data.entityState===$data.EntityState.Added&&a.data.getType().memberDefinitions.getPublicMappedProperties().forEach(function(b){b.required&&!b.computed&&!a.data[b.name]&&(a.data[b.name]=Container.getDefault(b.dataType))},this);(a.data.entityState!=$data.EntityState.Added||a.data.entityState!=$data.EntityState.Modified)&&
!a.data.isValid()&&i.push({item:a.data,errors:a.data.ValidationErrors})});if(i.length>0){e.error(i);return a}this.storageProvider.saveChanges({success:function(){k._postProcessSavedItems(e,b)},error:e.error},b);return a},prepareRequest:function(){},_postProcessSavedItems:function(a,b){this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(b);b.forEach(function(a){a.data.entityState=$data.EntityState.Unchanged;a.data.changedProperties=
[];a.physicalData=void 0});this.trackChanges||this.stateManager.reset();a.success(b.length)},forEachEntitySet:function(a,b){for(var c in this._entitySetReferences)a.call(b,this._entitySetReferences[c])},loadItemProperty:function(a,b,c){Guard.requireType("entity",a,$data.Entity);var d=typeof b==="string"?a.getType().memberDefinitions.getMember(b):b;if(a[d.name]!=void 0){b=new $data.PromiseHandler;callBack=b.createCallback(c);c.success(a[d.name]);return b.getPromise()}var b=true,e=this._storageModel.getStorageModel(a.getType().fullName),
h=Container.resolveType(d.dataType);if(h===$data.Array||h.isAssignableTo&&h.isAssignableTo($data.EntitySet)){h=Container.resolveType(d.elementType);b=false}else{var f=e.Associations.filter(function(a){return a.FromPropertyName==d.name})[0];f&&f.FromMultiplicity==="0..1"&&f.ToMultiplicity==="1"&&(b=false)}if(b===true){var k="function (e) { return",i={};e.LogicalType.memberDefinitions.getKeyProperties().forEach(function(b,c){c>0&&(k=k+" &&");k=k+(" e."+b.name+" == this.key"+c);i["key"+c]=a[b.name]});
k=k+"; }";return e.EntitySetReference.map("function (e) { return e."+d.name+" }").single(k,i,c)}k="function (e) { return";i={};e.LogicalType.memberDefinitions.getKeyProperties().forEach(function(b,c){c>0&&(k=k+" &&");k=k+(" e."+d.inverseProperty+"."+b.name+" == this.key"+c);i["key"+c]=a[b.name]});k=k+"; }";return this.getEntitySetFromElementType(h).filter(k,i).toArray(c)},getTraceString:function(a){return this.storageProvider.getTraceString(new $data.Query(a.expression,a.defaultType,this))},log:function(){},
resolveBinaryOperator:function(a,b,c){return this.storageProvider.resolveBinaryOperator(a,b,c)},resolveUnaryOperator:function(a,b,c){return this.storageProvider.resolveUnaryOperator(a,b,c)},resolveFieldOperation:function(a,b,c){return this.storageProvider.resolveFieldOperation(a,b,c)},resolveSetOperations:function(a,b,c){return this.storageProvider.resolveSetOperations(a,b,c)},_generateServiceOperationQueryable:function(a,b,c,d){typeof console!=="undefined"&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext");
for(var e=[],h=0;h<d.length;h++){var f={};f[d[h]]=Container.resolveType(Container.getTypeName(c[h]));e.push(f)}return $data.EntityContext.generateServiceOperation({serviceName:a,returnType:$data.Queryable,elementType:this[b].elementType,params:e}).apply(this,c)},attach:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attach(a)},attachOrGet:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).attachOrGet(a)},
add:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).add(a)},remove:function(a){a instanceof $data.EntityWrapper&&(a=a.getEntity());return this.getEntitySetFromElementType(a.getType()).remove(a)}},{generateServiceOperation:function(a){return function(){var b=a.elementType?this.getEntitySetFromElementType(Container.resolveType(a.elementType)):null,c=null;if(a.params)for(var c=[],d=0;d<a.params.length;d++)for(var e in a.params[d])c.push(Container.createConstantExpression(arguments[d],
Container.resolveType(a.params[d][e]),e));d=Container.createEntityContextExpression(this);e=this.getType().getMemberDefinition(a.serviceName);c=Container.createServiceOperationExpression(d,Container.createMemberInfoExpression(e),c,a);d=arguments[arguments.length-1];typeof d!=="function"&&(d=void 0);if(b){b=Container.createQueryable(b,c);if(d){c.isTerminated=true;return b._runQuery(d)}return b}e=Container.resolveType(a.returnType);b=Container.createQueryable(this,c);b.defaultType=e;if(e===$data.Queryable){b.defaultType=
Container.resolveType(a.elementType);if(d){c.isTerminated=true;return b._runQuery(d)}return b}c.isTerminated=true;return b._runQuery(d)}},_convertLogicalTypeNameToPhysical:function(a){return a+"_$db$"},_storageModelCache:{get:function(){if(!this.__storageModelCache)this.__storageModelCache={};return this.__storageModelCache},set:function(){}}});
$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(){},getTraceString:function(){}},null);
$data.Class.define("$data.ModelBinder",null,null,{constructor:function(a){this.context=a;this.cache={}},call:function(a,b){if(!Object.getOwnPropertyNames(b).length)return a;if(b.$type)var c=Container.resolveName(b.$type),d=this.context.storageProvider.fieldConverter.fromDb[c],e=d?d():Container["create"+Container.resolveType(b.$type).name]();if(b.$selector){var h=b.$selector;h instanceof Array||(h=[h]);for(var d=0,f;d<h.length;){f=a;c=h[d].split(":");switch(c[0]){case "json":for(c=c[1].split(".");c.length;)if(typeof f[c[0]]===
"undefined"){if(d===h.length)return;if(c.length)break}else{f=f[c[0]];c=c.slice(1)}if(!c.length)d=h.length;break;case "css":case "xml":if(f.querySelector)f=f[b.$item?"querySelectorAll":"querySelector"](c[1]);else{f=$(f).find(c[1]);b.$item||(f=f[0])}}d++}a=f;if(!a)return a}if(b.$value)if(typeof b.$value==="function")e=b.$value();else if(b.$type){c=Container.resolveName(b.$type);e=(d=this.context.storageProvider.fieldConverter.fromDb[c])?d(b.$value):Container["create"+Container.resolveType(b.$type).name](b.$value)}else e=
b.$value;else if(b.$source)if(b.$type){c=Container.resolveName(b.$type);e=(d=this.context.storageProvider.fieldConverter.fromDb[c])?d(a[b.$source]):Container["create"+Container.resolveType(b.$type).name](a[b.$source])}else e=b.$source.split(":")[0]=="attr"&&a.getAttribute?a.getAttribute(b.$source.split(":")[1]):b.$source=="textContent"&&!a[b.$source]?$(a).text():a[b.$source];else if(b.$item)for(d=0;d<a.length;d++){var k=this.call(a[d],b.$item);e.push(k)}else{f="";if(b.$keys){for(k=0;k<b.$keys.length;k++)f=
f+(b.$type+"_"+b.$keys[k]+"#"+a[b.$keys[k]]);if(this.cache[f]){e=this.cache[f];for(k in b)k.indexOf("$")<0&&b[k].$item&&e[k].push(this.call(a,b[k].$item))}else{for(k in b)if(k.indexOf("$")<0)if(b[k].$item)e[k]=this.call(a,b[k]);else if(b[k].$type||b[k].$source)e[k]=this.call(a,b[k]);else if(b.$type){c=Container.resolveName(b.$type.memberDefinitions.getMember(k).type);d=this.context.storageProvider.fieldConverter.fromDb[c];e[k]=d?d(a[b[k]]):Container["create"+Container.resolveType(b.$type.memberDefinitions.getMember(k).type).name](a[b[k]])}else e[k]=
b[k].$source?a[b[k].$source]:a[b[k]];this.cache[f]=e}}else for(k in b)if(k.indexOf("$")<0)if(b[k].$item)e[k]=this.call(a,b[k]);else if(b[k].$type||b[k].$source)e[k]=this.call(a,b[k]);else if(b.$type){c=Container.resolveName(Container.resolveType(b.$type).memberDefinitions.getMember(k).type);d=this.context.storageProvider.fieldConverter.fromDb[c];e[k]=d?d(a[b[k]]):Container["create"+Container.resolveType(b.$type.memberDefinitions.getMember(k).type).name](a[b[k]])}else e[k]=b[k].$source?a[b[k].$source]:
a[b[k]]}return e}});
$C("$data.Query",null,null,{constructor:function(a,b,c){Object.defineProperty(this,"expression",{value:a,enumerable:true});Object.defineProperty(this,"context",{value:c,enumerable:true});this.expressions=a;this.defaultType=b;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=c},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){this.result=(new $data.ModelBinder(this.context)).call(this.rawDataList,this.modelBinderConfig)}},null);
$data.Class.define("$data.Queryable",null,null,{constructor:function(a,b){var c=a instanceof $data.EntityContext?a:a.entityContext;this.defaultType=a instanceof $data.EntityContext?null:a.defaultType;Object.defineProperty(this,"entityContext",{value:c,writable:false,enumerable:true});this.expression=b},filter:function(a,b){this._checkOperation("filter");var c=Container.createCodeExpression(a,b),d=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression)var d=this.expression.source,
e=this.entityContext.storageProvider.resolveBinaryOperator("and"),c=Container.createSimpleBinaryExpression(this.expression.selector,c,"and","filter","boolean",e);c=Container.createFilterExpression(d,c);return Container.createQueryable(this,c)},where:function(a,b){return this.filter(a,b)},map:function(a,b){this._checkOperation("map");var c=Container.createCodeExpression(a,b),c=Container.createProjectionExpression(this.expression,c);return Container.createQueryable(this,c)},select:function(a,b){return this.map(a,
b)},length:function(a){this._checkOperation("length");var b=new $data.PromiseHandler,a=b.createCallback(a),c=Container.createCountExpression(this.expression),d=Container.createQueryExpressionCreator(this.entityContext);try{var e=d.Visit(c);this.entityContext.log({event:"EntityExpression",data:e});this.entityContext.executeQuery(Container.createQueryable(this,e),a)}catch(h){a.error(h)}return b.getPromise()},count:function(a){return this.length(a)},forEach:function(a){this._checkOperation("forEach");
var b=new $data.PromiseHandler,c=b.createCallback(function(b){b.forEach(a)}),d=Container.createForEachExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{var h=e.Visit(d);this.entityContext.log({event:"EntityExpression",data:h});this.entityContext.executeQuery(Container.createQueryable(this,h),c)}catch(f){c.error(f)}return b.getPromise()},toArray:function(a){if(a instanceof $data.Array)return this.toArray(function(b){a.length=0;b.forEach(function(b){a.push(b)})});
this._checkOperation("toArray");var b=new $data.PromiseHandler,c=b.createCallback(a),d=Container.createToArrayExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{var h=e.Visit(d);this.entityContext.log({event:"EntityExpression",data:h});this.entityContext.executeQuery(Container.createQueryable(this,h),c)}catch(f){c.error(f)}return b.getPromise()},single:function(a,b,c){this._checkOperation("single");var d=this;a&&(d=this.filter(a,b));var d=d.take(2),a=new $data.PromiseHandler,
c=a.createCallback(c),b=Container.createSingleExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);try{var h=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:h});d.entityContext.executeQuery(Container.createQueryable(d,h),c)}catch(f){c.error(f)}return a.getPromise()},some:function(a,b,c){this._checkOperation("some");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createSomeExpression(d.expression),
e=Container.createQueryExpressionCreator(d.entityContext);try{var h=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:h});d.entityContext.executeQuery(Container.createQueryable(d,h),c)}catch(f){c.error(f)}return a.getPromise()},every:function(a,b,c){this._checkOperation("every");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createEveryExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);
try{var h=e.Visit(b);this.entityContext.log({event:"EntityExpression",data:h});d.entityContext.executeQuery(Container.createQueryable(d,h),c)}catch(f){c.error(f)}return a.getPromise()},take:function(a){this._checkOperation("take");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,a,ExpressionType.Take);return Container.createQueryable(this,a)},skip:function(a){this._checkOperation("skip");a=Container.createConstantExpression(a,"number");a=Container.createPagingExpression(this.expression,
a,ExpressionType.Skip);return Container.createQueryable(this,a)},orderBy:function(a,b){this._checkOperation("orderBy");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,ExpressionType.OrderBy);return Container.createQueryable(this,c)},orderByDescending:function(a,b){this._checkOperation("orderByDescending");var c=Container.createCodeExpression(a,b),c=Container.createOrderExpression(this.expression,c,ExpressionType.OrderByDescending);return Container.createQueryable(this,
c)},first:function(a,b,c){this._checkOperation("first");var d=this;a&&(d=this.filter(a,b));var d=d.take(1),a=new $data.PromiseHandler,c=a.createCallback(c),b=Container.createFirstExpression(d.expression),e=Container.createQueryExpressionCreator(d.entityContext);try{var h=e.Visit(b);d.entityContext.log({event:"EntityExpression",data:h});d.entityContext.executeQuery(Container.createQueryable(d,h),c)}catch(f){c.error(f)}return a.getPromise()},include:function(a){this._checkOperation("include");a=Container.createConstantExpression(a,
"string");a=Container.createIncludeExpression(this.expression,a);return Container.createQueryable(this,a)},_runQuery:function(a){var b=new $data.PromiseHandler,a=b.createCallback(a),c=Container.createQueryExpressionCreator(this.entityContext);try{var d=c.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:d});this.entityContext.executeQuery(Container.createQueryable(this,d),a)}catch(e){a.error(e)}return b.getPromise()},toTraceString:function(a){var b=this.expression,b=a?Container["create"+
a+"Expression"](b):Container.createToArrayExpression(b),b=Container.createQueryExpressionCreator(this.entityContext).Visit(b),a=Container.createQueryable(this,b);return a.entityContext.getTraceString(a)},_checkOperation:function(a){var b=this.entityContext.resolveSetOperations(a);b.invokable!=void 0&&!b.invokable&&Guard.raise(new Exception("Operation '"+a+"' is not invokable with the provider"))},defaultType:{}},null);$data.EntitySchemaConfig=function(){this.Name=""};
$data.entitySetState={created:0,defined:1,active:2};
$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(a,b,c){this.createNew=this[a.name]=a;this.stateManager=new $data.EntityStateManager(this);Object.defineProperty(this,"elementType",{value:a,enumerable:true});Object.defineProperty(this,"collectionName",{value:c,enumerable:true});this._checkRootExpression()},executeQuery:function(a,b){var c=$data.typeSystem.createCallbackSetting(b);this.entityContext.executeQuery(a,c)},getTraceString:function(a){return this.entityContext.getTraceString(a)},
setContext:function(a){this.entitySetState=$data.entitySetState.active;this.entityContext=a;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(a){for(var b=this.entityContext.stateManager.trackedEntities,c=0;c<b.length;c++)if(b[c].data===a)return;b.push({entitySet:this,data:a})},add:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Added;b.changedProperties=void 0;
b.context=this.entityContext;this._trackEntity(b)},remove:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));b.entityState=$data.EntityState.Deleted;b.changedProperties=void 0;this._trackEntity(b)},attach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));for(a=0;a<this.entityContext.stateManager.trackedEntities.length;a++){var c=this.entityContext.stateManager.trackedEntities[a];
if(c.data===b)break;c.data.equals(b)&&Guard.raise(new Exception("Context already contains this entity!!!"))}b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b)},detach:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));var c=this.entityContext.stateManager.trackedEntities.filter(function(a){return a.data.equals(b)}).pop();if(c){c=this.entityContext.stateManager.trackedEntities.indexOf(c);
a.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(c,1)}},attachOrGet:function(a){var b=a;a instanceof $data.EntityWrapper?b=a.getEntity():a instanceof this.createNew||(b=new this.createNew(a));if(a=this.entityContext.stateManager.trackedEntities.filter(function(a){return a.data.equals(b)}).pop())return a.data;b.entityState=$data.EntityState.Unchanged;b.changedProperties=void 0;b.context=this.entityContext;this._trackEntity(b);return b},loadItemProperty:function(a,
b,c){return this.entityContext.loadItemProperty(a,b,c)},_checkRootExpression:function(){if(!this.expression){var a=Container.createEntityContextExpression(this.entityContext),b=this.entityContext.getType().getMemberDefinition(this.collectionName);this.expression=Container.createEntitySetExpression(a,Container.createMemberInfoExpression(b),null,this);this.defaultType=this.elementType}}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};
$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(a){this.entityContext=null;this.trackedEntities=[];this.init(a)},init:function(a){this.entityContext=a},reset:function(){this.trackedEntities=[]}},null);function Exception(a,b,c){Error.call(this);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=b||"Exception";this.message=a;this.data=c}Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){};
$data.ConcurrencyMode={Fixed:"fixed",None:"nonde"};
$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(a){this.providerConfiguration=a||{}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},buildIndependentBlocks:function(a){for(var b=[],c=[],d=0;d<a.length;d++){var e=a[d];if(e.dependentOn&&e.dependentOn.length!=0){for(var h=null,f=0;f<e.dependentOn.length;f++){var k=e.dependentOn[f];if(k.entityState!=$data.EntityState.Unchanged){for(var h=
h||{},i=-1,u=0;u<a.length;u++)if(a[u].data==k){i=u;break}i==-1&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",e.dependentOn[f]));h[i]=true;from=c[i]||{};from[d]=true;c[i]=from}}h!==null&&(b[d]=h)}}d=[];e=[];for(h=0;h<a.length;h++)b.hasOwnProperty(h)||e.push(h);for(;e.length>0;){h=[].concat(e);e=[];for(f=0;f<h.length;f++){k=c[h[f]];if(typeof k!=="undefined")for(var o in k){delete b[o][h[f]];a:{i=b[o];u=void 0;for(u in i)if(i.hasOwnProperty(u)){i=true;break a}i=false}if(!i){delete b[o];
e.push(o)}}delete c[h[f]]}f=[];for(k=0;k<h.length;k++){i=a[h[k]];i.data.entityState!=$data.EntityState.Unchanged&&f.push(i)}f.length>0&&d.push(f)}return d},getTraceString:function(){Guard.raise("Pure class")},setContext:function(a){this.context=a},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,
writable:!0},resolveFieldOperation:function(a,b,c){(b=this.supportedFieldOperations[a])||Guard.raise(new Exception("Field operation '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},
enumerable:!0,writable:!0},resolveBinaryOperator:function(a,b,c){(b=this.supportedBinaryOperators[a])||Guard.raise(new Exception("Binary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedUnaryOperators:{value:{not:{mapTo:"not"}},
enumerable:!0,writable:!0},resolveUnaryOperator:function(a,b,c){(b=this.supportedUnaryOperators[a])||Guard.raise(new Exception("Unary operator '"+a+"' is not supported by the provider"));c&&b.allowedIn&&(b.allowedIn instanceof Array&&!b.allowedIn.some(function(a){return c===Container.resolveType(a)})||!(b.allowedIn instanceof Array)&&c!==Container.resolveType(b.allowedIn))&&Guard.raise(new Exception(a+" not supported in: "+c.name));b.name=a;return b},supportedSetOperations:{value:{toArray:{invokable:!0,
allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(a,b,c){(b=this.supportedSetOperations[a])||Guard.raise(new Exception("Operation '"+a+"' is not supported by the provider"));var d=b.allowedIn||[];c&&d&&(d instanceof Array&&!d.some(function(a){return c===Container.resolveType(a)})||!(d instanceof Array)&&c!==Container.resolveType(d))&&Guard.raise(new Exception(a+" not supported in: "+c.name));return b},makePhysicalTypeDefinition:function(){}},{registerProvider:function(a,b){$data.RegistredStorageProviders=
$data.RegistredStorageProviders||[];$data.RegistredStorageProviders[a]=b},getProvider:function(a){var b=$data.RegistredStorageProviders[a];b||console.warn("Provider not found: '"+a+"'");return b},isSupported:{get:function(){return true},set:function(){}}});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});"undefined"!==typeof jQuery&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax);
"undefined"!==typeof WinJS&&WinJS.xhr&&($data.ajax=$data.ajax||function(a){$data.typeSystem.extend(a,{dataType:"json",headers:{}});var b={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(a){return a}},html:{accept:"text/html",convert:function(a){return a}},xml:{accept:"application/xml, text/xml",convert:function(a){return a}}}[a.dataType.toLowerCase()];a.headers.Accept=b.accept;var c=a.success||$data.defaultSuccessCallback,d=a.error||
$data.defaultErrorCallback,e=a.progress;WinJS.xhr(a).done(function(a){a=b.convert(a.responseText);c(a)},function(a){a=b.convert(a.responseText);d(a)},e)});"undefined"!==typeof Ext&&typeof Ext.Ajax&&($data.ajax=$data.ajax||function(a){Ext.Ajax.request(a)});$data.ajax=$data.ajax||function(){$data.TypeSystem.createCallbackSetting(arguments[arguments.length-1]).error("Not implemented")};
$data.Class.define("$data.dbClient.DbCommand",null,null,{connection:{},parameters:{},execute:function(){Guard.raise("Pure class")}},null);$data.Class.define("$data.dbClient.DbConnection",null,null,{connectionParams:{},database:{},isOpen:function(){Guard.raise("Pure class")},open:function(){Guard.raise("Pure class")},close:function(){Guard.raise("Pure class")},createCommand:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){this.connection.open({success:function(e){function h(){--i==
0&&c(f?k[0]:k)}var f=false;if(!(a instanceof Array)){f=true;a=[a];b=[b]}var k=[],i=0;a.forEach(function(c,f){i++;if(c)e.executeSql(a[f],b[f],function(a,b){var c={rows:[]};try{c.insertId=b.insertId}catch(d){c.rowsAffected=b.rowsAffected;for(var e=b.rows.length,i=0;i<e;i++)c.rows.push(b.rows.item(i))}k[f]=c;h()},function(a,b){d&&d(b)});else{k[f]=null;h()}})}})}},null);
$data.Class.define("$data.dbClient.openDatabaseClient.OpenDbConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0&&this.transaction!==null&&this.transaction!==void 0},open:function(a){if(this.database)this.database.transaction(function(b){a.success(b)});else{var b=this.connectionParams;this.database=openDatabase(b.fileName,b.version,b.displayName,b.maxSize);this.database.transaction(function(b){a.success(b)})}},
close:function(){this.database=this.transaction=void 0},createCommand:function(a,b){return new $data.dbClient.openDatabaseClient.OpenDbCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.jayStorageClient.JayStorageCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){if(b==null||b==void 0)b={};var e=false;if(!(a instanceof
Array)){e=true;a=[a];b=[b]}var h=[],f=a.length,k=function(){--f==0&&c(e?h[0]:h)};a.forEach(function(a,c){if(a)$data.ajax({url:"http"+(this.connection.connectionParams.storage.ssl?"s":"")+"://"+this.connection.connectionParams.storage.src.replace("http://","").replace("https://","")+"?db="+this.connection.connectionParams.storage.key,type:"POST",headers:{"X-PINGOTHER":"pingpong"},data:{query:a,parameters:b[c]},dataType:"json",contentType:"application/json;charset=UTF-8",success:function(a){if(a&&a.error){console.log("JayStorage error",
a.error);d(a.error)}else{h[c]=this.lastID?{insertId:this.lastID,rows:(a||{rows:[]}).rows}:{rows:(a||{rows:[]}).rows};k()}}});else{h[c]=null;k()}},this)}},null);$data.Class.define("$data.dbClient.jayStorageClient.JayStorageConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return true},open:function(){},close:function(){},createCommand:function(a,b){return new $data.dbClient.jayStorageClient.JayStorageCommand(this,a,b)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjCommand",$data.dbClient.DbCommand,null,{constructor:function(a,b,c){this.query=b;this.connection=a;this.parameters=c},executeNonQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},executeQuery:function(a){a=$data.typeSystem.createCallbackSetting(a);this.exec(this.query,this.parameters,a.success,a.error)},exec:function(a,b,c,d){this.connection.isOpen()||this.connection.open();
if(b==null||b==void 0)b={};var e=false;if(!(a instanceof Array)){e=true;a=[a];b=[b]}var h=this,f=[],k=0,i=function(){if(--k==0){h.connection.database.exec("COMMIT");c(e?f[0]:f)}};h.connection.database.exec("BEGIN");a.forEach(function(a,c){k++;if(a){var e=function(a,b){if(a!=null)d(a);else{f[c]=this.lastID?{insertId:this.lastID,rows:[]}:{rows:b};i()}},K=h.connection.database.prepare(a,b[c]);a.indexOf("SELECT")==0?K.all(e):K.run(e);K.finalize()}else{f[c]=null;i()}},this)}},null);
$data.Class.define("$data.dbClient.sqLiteNJClient.SqLiteNjConnection",$data.dbClient.DbConnection,null,{constructor:function(a){this.connectionParams=a},isOpen:function(){return this.database!==null&&this.database!==void 0},open:function(){if(this.database==null)this.database=new sqLiteModule.Database(this.connectionParams.fileName)},close:function(){},createCommand:function(a,b){return new $data.dbClient.sqLiteNJClient.SqLiteNjCommand(this,a,b)}},null);
$data.Class.define("$data.storageProviders.sqLite.SqLiteStorageProvider",$data.StorageProviderBase,null,{constructor:function(a,b){this.SqlCommands=[];this.context=b;this.providerConfiguration=$data.typeSystem.extend({databaseName:"JayDataDemo",version:"",displayName:"JayData demo db",maxSize:1048576,dbCreation:$data.storageProviders.sqLite.DbCreationType.DropTableIfChanged},a);if(this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction)this.context._buildDbType_generateConvertToFunction=
this.buildDbType_generateConvertToFunction;if(this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition)this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition},_createSqlConnection:function(){var a={fileName:this.providerConfiguration.databaseName,version:"",displayName:this.providerConfiguration.displayName,maxSize:this.providerConfiguration.maxSize,storage:this.providerConfiguration.storage};if(this.connection)return this.connection;
var b=null;return this.connection=b=this.providerConfiguration.storage?new $data.dbClient.jayStorageClient.JayStorageConnection(a):typeof sqLiteModule!=="undefined"?new $data.dbClient.sqLiteNJClient.SqLiteNjConnection(a):new $data.dbClient.openDatabaseClient.OpenDbConnection(a)},supportedDataTypes:{value:[$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date],writable:!1},fieldConverter:{value:{fromDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},
"$data.Date":function(a){return new Date(a)},"$data.String":function(a){return a},"$data.Boolean":function(a){return a===1?true:false},"$data.Blob":function(a){return a}},toDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},"$data.Date":function(a){return a?a.valueOf():null},"$data.String":function(a){return a},"$data.Boolean":function(a){return a?1:0},"$data.Blob":function(a){return a}}}},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.ProjectionExpression]},substr:{dataType:"string",allowedIn:$data.Expressions.FilterExpression,parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string",mapTo:"lower"},toUpperCase:{dataType:"string",mapTo:"upper"},contains:{mapTo:"like",dataType:"boolean",allowedIn:$data.Expressions.FilterExpression,parameters:[{name:"strFragment",dataType:"string",prefix:"%",suffix:"%"}]},startsWith:{mapTo:"like",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.ProjectionExpression],parameters:[{name:"strFragment",dataType:"string",suffix:"%"}]},endsWith:{mapTo:"like",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"strFragment",dataType:"string",prefix:"%"}]},trim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"trim",parameters:[{name:"@expression",dataType:$data.String},{name:"chars",dataType:$data.String}]},
ltrim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"ltrim",parameters:[{name:"@expression",dataType:$data.String},{name:"chars",dataType:$data.String}]},rtrim:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"rtrim",parameters:[{name:"@expression",dataType:$data.String},{name:"chars",dataType:$data.String}]}},enumerable:!0,writable:!0},supportedBinaryOperators:{value:{equal:{mapTo:"=",
dataType:"boolean"},notEqual:{mapTo:"!=",dataType:"boolean"},equalTyped:{mapTo:"=",dataType:"boolean"},notEqualTyped:{mapTo:"!=",dataType:"boolean"},greaterThan:{mapTo:">",dataType:"boolean"},greaterThanOrEqual:{mapTo:">=",dataType:"boolean"},lessThan:{mapTo:"<",dataType:"boolean"},lessThenOrEqual:{mapTo:"<=",dataType:"boolean"},or:{mapTo:"OR",dataType:"boolean"},and:{mapTo:"AND",dataType:"boolean"},add:{mapTo:"+",dataType:"number"},divide:{mapTo:"/"},multiply:{mapTo:"*"},subtract:{mapTo:"-"},modulo:{mapTo:"%"},
orBitwise:{maptTo:"|"},andBitwsise:{mapTo:"&"},"in":{mapTo:"in",dataType:"boolean"}}},supportedUnaryOperators:{value:{not:{mapTo:"not"},positive:{mapTo:"+"},negative:{maptTo:"-"}}},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{}},enumerable:!0,writable:!0},buildDbType_modifyInstanceDefinition:function(a,b){var c=function(a){var b=JSON.parse(JSON.stringify(a));b.dataType=Container.resolveType(a.dataType);
b.key=false;b.computed=false;return b},d=function(a,b,c,d){var i={};i[a.name]=c;i[b.name]=d+"__"+c;return i};b.Associations&&b.Associations.forEach(function(b){var h=false,f=b.FromType,k=b.ToType,i=b.ToPropertyName;b.ReferentialConstraint=b.ReferentialConstraint||[];if(b.FromMultiplicity=="*"&&b.ToMultiplicity=="0..1"||b.FromMultiplicity=="0..1"&&b.ToMultiplicity=="1"){f=b.ToType;k=b.FromType;i=b.FromPropertyName;h=true}f.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.key}).forEach(function(u){h&&
(a[i+"__"+u.name]=c(u));b.ReferentialConstraint.push(d(f,k,u.name,i))},this)},this);b.ComplexTypes&&b.ComplexTypes.forEach(function(b){b.ReferentialConstraint=b.ReferentialConstraint||[];b.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(h){a[b.FromPropertyName+"__"+h.name]=c(h);b.ReferentialConstraint.push(d(b.ToType,b.FromType,h.name,b.FromPropertyName))},this)},this)},buildDbType_generateConvertToFunction:function(a){return function(b){var c=new a.PhysicalType;c.entityState=
b.entityState;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){c[a.name]=b[a.name]},this);a.Associations&&a.Associations.forEach(function(a){if(a.FromMultiplicity=="*"&&a.ToMultiplicity=="0..1"||a.FromMultiplicity=="0..1"&&a.ToMultiplicity=="1"){var e=b[a.FromPropertyName];e!==void 0&&a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},this)}},this);a.ComplexTypes&&a.ComplexTypes.forEach(function(a){var e=b[a.FromPropertyName];e!==void 0&&
a.ReferentialConstraint.forEach(function(b){c[b[a.From]]=e!==null?e[b[a.To]]:null},this)},this);return c}},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);this.context._storageModel.forEach(function(a){this.SqlCommands.push(this.createSqlFromStorageModel(a)+" ")},this);var b=this._createSqlConnection(),c=this;b.createCommand("SELECT * FROM sqlite_master WHERE type = 'table'",null).executeQuery({success:function(d){for(var e={},h=0;h<d.rows.length;h++){var f=d.rows[h];e[f.tbl_name]=
f}switch(c.providerConfiguration.dbCreation){case $data.storageProviders.sqLite.DbCreationType.Merge:Guard.raise(new Exception("Not supported db creation type"));break;case $data.storageProviders.sqLite.DbCreationType.DropTableIfChanged:d=[];for(h=0;h<c.SqlCommands.length;h++)if(c.SqlCommands[h]!=""){var f=/^CREATE TABLE IF NOT EXISTS ([^ ]*) (\(.*\))/g,k=f.exec(c.SqlCommands[h]);if(k){f=k[1];k=k[2];if(e[f.slice(1,f.length-1)]){var i=/^CREATE TABLE ([^ ]*) (\(.*\))/g.exec(e[f.slice(1,f.length-1)].sql)[2];
k.toLowerCase()!=i.toLowerCase()&&d.push("DROP TABLE IF EXISTS ["+e[f.slice(1,f.length-1)].tbl_name+"];")}}else{console.dir(f);console.dir(c.SqlCommands[h])}}c.SqlCommands=c.SqlCommands.concat(d);console.log(d);break;case $data.storageProviders.sqLite.DbCreationType.DropAllExistingTables:for(k in e)k&&!k.match("^__")&&!k.match("^sqlite_")&&c.SqlCommands.push("DROP TABLE IF EXISTS ["+e[k].tbl_name+"];")}c._runSqlCommands(b,{success:a.success,error:a.error})},error:a.error})},executeQuery:function(a,
b){var b=$data.typeSystem.createCallbackSetting(b),c=this._createSqlConnection(),d=this._compile(a);a.actionPack=d.actions;a.sqlConvertMetadata=d.converter;a.modelBinderConfig=d.modelBinderConfig;c.createCommand(d.sqlText,d.params).executeQuery({success:function(c){if(b.success){a.rawDataList=c.rows;b.success(a)}},error:b.error})},_compile:function(a){var b=new $data.storageProviders.sqLite.SQLiteCompiler,a=b.compile(a);a.hasSelect=b.select!=null;return a},getTraceString:function(a){return this._compile(a)},
_runSqlCommands:function(a,b){if(this.SqlCommands&&this.SqlCommands.length>0){var c=this.SqlCommands.pop(),d=this;a.createCommand(c,null).executeQuery({success:function(){d._runSqlCommands.apply(d,[a,b])},error:b.error})}else b.success(this.context)},setContext:function(a){this.context=a},saveChanges:function(a,b){var c=this._createSqlConnection(),d=this.buildIndependentBlocks(b);this.saveIndependentBlocks(b,d,c,a)},saveIndependentBlocks:function(a,b,c,d){function e(){if(f.length===0)d.success();
else{var a=f.shift().map(function(a){var b=h.context._storageModel.getStorageModel(a.data.getType()).PhysicalType;a.physicalData=b.convertTo(a.data);return a},this);h.saveIndependentItems(a,c,{success:function(){h.postProcessItems(a);e()},error:d.error})}}var h=this,f=[].concat(b);e()},saveIndependentItems:function(a,b,c){function d(a,b){var c=[],d=[];b.forEach(function(a,b){if(a){if(a.query)c[b]=a.query;if(a.param)d[b]=a.param}});return a.createCommand(c,d)}var e=this,h=a.map(function(a){return e.saveEntitySet(a)}),
h=h.filter(function(a){return a});h.length===0?c.success(a):d(b,h).executeQuery({success:function(f){f=f.map(function(c,d){return c&&c.insertId?e.save_reloadSavedEntity(c.insertId,a[d].entitySet.tableName,b):null});f=d(b,f);f.query.length>0?f.executeQuery(function(b){b.forEach(function(b,c){if(b&&b.rows)a[c].physicalData.initData=b.rows[0]});c.success(a)}):c.success(0)},error:c.error})},postProcessItems:function(a){function b(a){var b=a.name;if(c.hasOwnProperty(b))return c[b];a=a.memberDefinitions.getPublicMappedProperties().filter(function(a){return a.computed});
return c[b]=a}var c={};a.forEach(function(a){a.physicalData&&b(a.data.getType()).forEach(function(b){a.data[b.name]=a.physicalData[b.name]},this)},this)},saveEntitySet:function(a){switch(a.data.entityState){case $data.EntityState.Added:return this.save_NewEntity(a);case $data.EntityState.Deleted:return this.save_DeleteEntity(a);case $data.EntityState.Modified:return this.save_UpdateEntity(a);case $data.EntityState.Unchanged:break;default:Guard.raise(new Exception("Not supported entity state"))}},
save_DeleteEntity:function(a){for(var b="DELETE FROM ["+a.entitySet.name+"] WHERE(",c=false,d=false,e=[];!c;){a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(h){c&&!b.match(" AND $")&&(b=b+" AND ");if(h.key||d){b=b+("(["+h.name+"] == ?)");e.push(this.fieldConverter.toDb[Container.resolveName(h.dataType)](a.data[h.name]));c=true}},this);c||(d=true)}b.match(" AND $")&&(b=b.slice(0,b.length-5));b=b+");";return{query:b,param:e}},save_UpdateEntity:function(a){var b=
" SET ",c="WHERE(",d=false,e=[],h=[];a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(f){if(a.physicalData[f.name]!==void 0){d&&!c.match(" AND $")&&(c=c+" AND ");b.length>5&&!b.match(",$")&&(b=b+",");if(f.key){c=c+("(["+f.name+"] == ?)");e.push(this.fieldConverter.toDb[Container.resolveName(f.dataType)](a.physicalData[f.name]));d=true}else{b=b+("["+f.name+"] = ?");h.push(this.fieldConverter.toDb[Container.resolveName(f.dataType)](a.physicalData[f.name]))}}},
this);d||Guard.raise(new Exception("Not supported UPDATE function without primary key!"));c.match(" AND $")&&(c=c.slice(0,c.length-5));b.match(",$")&&(b=b.slice(0,b.length-1));return{query:"UPDATE ["+a.entitySet.tableName+"]"+b+" "+c+");",param:h.concat(e)}},save_NewEntity:function(a){var b="INSERT INTO ["+a.entitySet.tableName+"](",c="",d="",e=[];a.physicalData.constructor.memberDefinitions.getPublicMappedProperties().forEach(function(b){if(c.length>0&&c[c.length-1]!=","){c=c+",";d=d+","}var f=b.name;
if(a.physicalData[f]!==void 0&&b.dataType&&(!b.dataType.isAssignableTo||b.dataType.isAssignableTo&&!b.dataType.isAssignableTo($data.EntitySet))){d=d+"?";c=c+("["+f+"]");e.push(this.fieldConverter.toDb[Container.resolveName(b.dataType)](a.physicalData[f]))}},this);e.length<1&&Guard.raise(new Exception("None of the fields contain values in the entity to be saved."));c[c.length-1]==","&&(c=c.slice(0,c.length-1));d[d.length-1]==","&&(d=d.slice(0,d.length-1));return{query:b+(c+") VALUES("+d+");"),param:e}},
save_reloadSavedEntity:function(a,b){return{query:"SELECT * FROM "+b+" WHERE rowid=?",param:[a]}},createSqlFromStorageModel:function(a){(a===void 0||a===null||a.PhysicalType===void 0)&&Guard.raise("StorageModel not contains physical entity definition");var b=0,c=0;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){a.key&&b++;a.computed&&c++},this);c===1&&b>1&&Guard.raise(new Exception("Do not use computed field with multiple primary key!"));c>1&&b>1&&Guard.raise(new Exception("Do not use multiple computed field!"));
var d="CREATE TABLE IF NOT EXISTS ["+a.TableName+"] (",e=",PRIMARY KEY (";a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(b,f){f>0&&!d.match(", $")&&!d.match("\\($")&&(d=d+", ");d=d+this.createSqlFragmentFromField(b,c===1,a);if(c===0&&b.key){e.length>14&&!e.match(", $")&&(e=e+", ");e=e+("["+b.name+"]")}},this);d.match(", $")&&(d=d.substr(0,d.length-2));c===0&&e.length>14&&(d=d+(e+")"));return d=d+");"},createSqlFragmentFromField:function(a,b,c){return"schemaCreate"in
a&&a.schemaCreate?a.schemaCreate(a):(new this.FieldTypeBuilder(a,this,b,c)).build()},FieldTypeBuilder:function(a,b,c,d){this.fieldDef="";this.fld=a;this.provider=b;this.parsePk=c;this.entitySet=d;this.build=function(){switch(Container.resolveType(this.fld.dataType)){case $data.String:case "text":case "string":this.buildFieldNameAndType("TEXT");break;case $data.Boolean:case $data.Integer:case "bool":case "boolean":case "int":case "integer":this.buildFieldNameAndType("INTEGER");break;case $data.Number:case $data.Date:case "number":case "datetime":case "date":this.buildFieldNameAndType("REAL");
break;case $data.Blob:case "blob":this.buildFieldNameAndType("BLOB");break;default:this.buildRelations()}return this.fieldDef};this.buildFieldNameAndType=function(a){this.fieldDef="["+this.fld.name+"] "+a;this.parsePk?this.buildPrimaryKey():this.buildNotNull()};this.buildPrimaryKey=function(){if(this.fld.key){this.fieldDef=this.fieldDef+" PRIMARY KEY";this.buildAutoIncrement()}else this.buildNotNull()};this.buildNotNull=function(){if(this.fld.required)this.fieldDef=this.fieldDef+" NOT NULL"};this.buildAutoIncrement=
function(){if(this.fld.computed)this.fieldDef=this.fieldDef+" AUTOINCREMENT"}}},{isSupported:{get:function(){return"openDatabase"in window},set:function(){}}});$data.storageProviders.sqLite.DbCreationType={Merge:10,DropTableIfChanged:20,DropAllExistingTables:30};
$data.storageProviders.sqLite.SqLiteStorageProvider.isSupported&&($data.StorageProviderBase.registerProvider("webSql",$data.storageProviders.sqLite.SqLiteStorageProvider),$data.StorageProviderBase.registerProvider("sqLite",$data.storageProviders.sqLite.SqLiteStorageProvider),$data.webSqlProvider=$data.storageProviders.sqLite.SqLiteStorageProvider);
var SqlStatementBlocks={beginGroup:"(",endGroup:")",nameSeparator:".",valueSeparator:", ",select:"SELECT ",where:" WHERE ",from:" FROM ",skip:" OFFSET ",take:" LIMIT ",parameter:"?",order:" ORDER BY ",as:" AS ",scalarFieldName:"d",rowIdName:"rowid$$",count:"select count(*) cnt from ("};
$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this.modelBinderConfig=this._binderConfig={};this._binderConfigPropertyStack=[]},selectTextPart:function(a){this._fragments[a]||(this._fragments[a]={text:"",params:[]});this.selectedFragment=this._fragments[a]},getTextPart:function(a){return this._fragments[a]},addText:function(a){this.selectedFragment.text=this.selectedFragment.text+a},addParameter:function(a){this.selectedFragment.params.push(a)},
selectModelBinderProperty:function(a){this._binderConfigPropertyStack.push(this.modelBinderConfig);a in this.modelBinderConfig||(this.modelBinderConfig[a]={});this.modelBinderConfig=this.modelBinderConfig[a]},popModelBinderProperty:function(){this.modelBinderConfig=this._binderConfigPropertyStack.length===0?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(a){this.modelBinderConfig.$keys||
(this.modelBinderConfig.$keys=[]);this.modelBinderConfig.$keys.push(a)}});$C("$data.sqLite.SqlBuilder",$data.queryBuilder,null,{constructor:function(a,b){this.sets=a;this.entityContext=b},getExpressionAlias:function(a){var b=this.sets.indexOf(a);b==-1&&(b=this.sets.push(a)-1);return"T"+b}});
$C("$data.sqLite.SqlCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this.queryExpression=a;this.sets=b.sets;this.infos=b.infos;this.entityContext=b.entityContext;this.associations=[];this.filters=[];this.newFilters={};this.sortedFilterPart=["projection","from","filter","order","take","skip"]},compile:function(){var a=Container.createSqlBuilder(this.sets,this.entityContext);this.Visit(this.queryExpression,a);a.getTextPart("projection")===void 0&&this.VisitDefaultProjection(a);
a.selectTextPart("result");this.sortedFilterPart.forEach(function(b){if(b=a.getTextPart(b)){a.addText(b.text);a.selectedFragment.params=a.selectedFragment.params.concat(b.params)}},this);var b=a.getTextPart("count");if(b!==void 0){a.selectedFragment.text=b.text+a.selectedFragment.text;a.addText(SqlStatementBlocks.endGroup);a.selectedFragment.params=a.selectedFragment.params.concat(b.params)}a.resetModelBinderProperty();this.filters.push(a)},VisitToArrayExpression:function(a,b){this.Visit(a.source,
b)},VisitCountExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("count");b.addText(SqlStatementBlocks.count)},VisitFilterExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("filter");b.addText(SqlStatementBlocks.where);Container.createSqlFilterCompiler().Visit(a.selector,b);return a},VisitOrderExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("order");if(this.addOrders)b.addText(SqlStatementBlocks.valueSeparator);else{this.addOrders=true;b.addText(SqlStatementBlocks.order)}Container.createSqlOrderCompiler().Visit(a,
b);return a},VisitPagingExpression:function(a,b){this.Visit(a.source,b);switch(a.nodeType){case ExpressionType.Skip:b.selectTextPart("skip");b.addText(SqlStatementBlocks.skip);break;case ExpressionType.Take:b.selectTextPart("take");b.addText(SqlStatementBlocks.take);break;default:Guard.raise("Not supported nodeType")}Container.createSqlPagingCompiler().Visit(a,b);return a},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);b.selectTextPart("projection");this.hasProjection=true;b.addText(SqlStatementBlocks.select);
Container.createSqlProjectionCompiler().Visit(a,b)},VisitIncludeExpression:function(a){var b=Container.createSqlBuilder(this.sets,this.entityContext);this.Visit(a.source,b);this.newFilters.include=projectionBuilder},VisitEntitySetExpression:function(a,b){b.selectTextPart("from");b.addText(SqlStatementBlocks.from);b.sets.forEach(function(a,d){d>0&&b.addText(" \n\tLEFT OUTER JOIN ");var e=b.getExpressionAlias(a);b.addText(a.instance.tableName+" ");b.addText(e);if(d>0){b.addText(" ON (");var h=this.infos[d],
f="T"+h.AliasNumber,k=h.NavigationPath.substring(0,h.NavigationPath.lastIndexOf(".")),e=this.infos.filter(function(a){return a.NavigationPath==k},this),i="T0";e.length>0&&(i="T"+e[0].AliasNumber);h.Association.associationInfo.ReferentialConstraint.forEach(function(a){b.addText(i+"."+a[h.Association.associationInfo.From]);b.addText(" = ");b.addText(f+"."+a[h.Association.associationInfo.To])},this);b.addText(")")}},this)},VisitDefaultProjection:function(a){a.selectTextPart("projection");if(a.sets.length>
1){a.addText(SqlStatementBlocks.select);a.sets[0].storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(b,c){c>0&&a.addText(SqlStatementBlocks.valueSeparator);a.addText("T0.");a.addText(b.name)},this)}else a.addText("SELECT *")}});$data.Expressions.ExpressionNode.prototype.monitor=function(a,b){return Container.createExpressionMonitor(a).Visit(this,b)};
$C("$data.storageProviders.sqLite.SQLiteCompiler",null,null,{compile:function(a){var b={sets:[],infos:[],entityContext:a.context},c=a.expression.monitor({MonitorEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityContextExpression&&b.sets.indexOf(a)==-1){b.sets.push(a);b.infos.push({AliasNumber:0,Association:null,FromType:null,FromPropertyName:null})}},MutateEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityContextExpression){this.backupContextExpression=
a.source;this.path="";return a}a.selector.associationInfo.FromMultiplicity=="0..1"&&a.selector.associationInfo.FromMultiplicity=="*"&&Guard.raise("Not supported query on this navigation property: "+a.selector.associationInfo.From+" "+a.selector.associationInfo.FromPropertyName);this.path=this.path+("."+a.selector.associationInfo.FromPropertyName);var c=b.infos.filter(function(a){return a.NavigationPath==this.path},this);if(c.length>0)return b.sets[c[0].AliasNumber];(c=this.backupContextExpression.instance.getType().memberDefinitions.getMember(a.storageModel.EntitySetReference.name))||
Guard.raise("Context schema error");c=Container.createMemberInfoExpression(c);c=Container.createEntitySetExpression(this.backupContextExpression,c);c.instance=this.backupContextExpression.instance[a.storageModel.EntitySetReference.name];var f=b.sets.push(c);b.infos.push({AliasNumber:f-1,Association:a.selector,NavigationPath:this.path});return c}},b),b=Container.createSqlCompiler(c,b);b.compile();Container.createSqlBuilder(this.sets,this.entityContext);a.modelBinderConfig={};Container.createsqLite_ModelBinderCompiler(a,
[]).Visit(c);return{sqlText:b.filters[0].selectedFragment.text,params:b.filters[0].selectedFragment.params,modelBinderConfig:a.modelBinderConfig}}},null);$C("$data.sqLite.SqlPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitPagingExpression:function(a,b){this.Visit(a.amount,b)},VisitConstantExpression:function(a,b){b.addParameter(a.value);b.addText(SqlStatementBlocks.parameter)}});
$C("$data.sqLite.SqlOrderCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitEntitySetExpression:function(a,b){var c=b.getExpressionAlias(a);b.addText(c);b.addText(SqlStatementBlocks.nameSeparator)},VisitOrderExpression:function(a,b){this.Visit(a.selector,b);a.nodeType==ExpressionType.OrderByDescending?b.addText(" DESC"):b.addText(" ASC")},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,
b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);b.addText("__")}});
$C("$data.sqLite.SqlProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.anonymFiledPrefix="";this.currentObjectLiteralName=null},VisitProjectionExpression:function(a,b){this.Visit(a.selector,b)},VisitParametricQueryExpression:function(a,b){if(a.expression instanceof $data.Expressions.EntityExpression)this.VisitEntityExpressionAsProjection(a,b);else if(a.expression instanceof $data.Expressions.ObjectLiteralExpression)this.Visit(a.expression,b);else{this.VisitEntitySetExpression(b.sets[0],
b);b.addText("rowid");b.addText(SqlStatementBlocks.as);b.addText(SqlStatementBlocks.rowIdName);b.addText(", ");b.addKeyField(SqlStatementBlocks.rowIdName);this.Visit(a.expression,b);b.addText(SqlStatementBlocks.as);b.addText(SqlStatementBlocks.scalarFieldName)}},VisitEntityExpressionAsProjection:function(a,b){var c=a.expression,d=b.getExpressionAlias(c.source),e=this.anonymFiledPrefix+(a.fieldName?a.fieldName:""),e=e?e+"__":"";c.storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a,
c){c>0&&b.addText(SqlStatementBlocks.valueSeparator);var k=e+a.name;b.addText(d);b.addText(SqlStatementBlocks.nameSeparator);b.addText(a.name);b.addText(SqlStatementBlocks.as);b.addText(k)},this)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition,d=c.mapTo||c.name;b.addText(d);b.addText(SqlStatementBlocks.beginGroup);if(d==="like"){d=Container.createSqlBuilder();this.Visit(a.parameters[0],
d);d.params.forEach(function(a){var d=c.parameters[0],a=d.prefix?d.prefix+a:a,a=d.suffix?a+d.suffix:a;b.addParameter(a)});b.addText(d.sql);b.addText(" , ");this.Visit(a.source,b)}else{this.Visit(a.source,b);a.parameters.forEach(function(a){b.addText(" , ");this.Visit(a,b)},this)}b.addText(SqlStatementBlocks.endGroup)},VisitUnaryExpression:function(a,b){b.addText(a.resolution.mapTo);b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.operand,b);b.addText(SqlStatementBlocks.endGroup)},VisitSimpleBinaryExpression:function(a,
b){b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.left,b);var c=this;b.addText(" "+a.resolution.mapTo+" ");if(a.nodeType=="in"){Guard.requireType("expression.right",a.right,$data.Expressions.ConstantExpression);var d=a.right.value;if(d instanceof Array){b.addText(SqlStatementBlocks.beginGroup);d.forEach(function(a,d){d>0&&b.addText(SqlStatementBlocks.valueSeparator);var f=Container.createConstantExpression(a);c.Visit(f,b)});b.addText(SqlStatementBlocks.endGroup)}else d instanceof $data.Queryable?
Guard.raise("not yet... but coming"):Guard.raise(new Exception("Only constant arrays and Queryables can be on the right side of 'in' operator","UnsupportedType"))}else this.Visit(a.right,b);b.addText(SqlStatementBlocks.endGroup)},VisitConstantExpression:function(a,b){b.addParameter(a.value);b.addText(SqlStatementBlocks.parameter)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitEntitySetExpression:function(a,b){var c=b.getExpressionAlias(a);b.addText(c);
b.addText(SqlStatementBlocks.nameSeparator)},VisitComplexTypeExpression:function(a,b){var c=b.getExpressionAlias(a.source.source),d=a.source.storageModel.ComplexTypes[a.selector.memberName];d.ReferentialConstraint.forEach(function(a,h){h>0&&b.addText(SqlStatementBlocks.valueSeparator);b.addText(c);b.addText(SqlStatementBlocks.nameSeparator);b.addText(a[d.From]);b.addText(SqlStatementBlocks.as);b.addText(this.anonymFiledPrefix+a[d.To])},this)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},
VisitObjectLiteralExpression:function(a,b){this.VisitEntitySetExpression(b.sets[0],b);b.addText("rowid AS "+this.anonymFiledPrefix+SqlStatementBlocks.rowIdName+", ");for(var c=a.members.length,d=0;d<c;d++){d!=0&&b.addText(SqlStatementBlocks.valueSeparator);this.Visit(a.members[d],b)}},VisitObjectFieldExpression:function(a,b){var c=this.currentObjectLiteralName;this.currentObjectLiteralName=this.currentObjectLiteralName?this.currentObjectLiteralName+("."+a.fieldName):a.fieldName;if(a.expression instanceof
$data.Expressions.EntityExpression)this.VisitEntityExpressionAsProjection(a,b);else{var d=this.anonymFiledPrefix;this.anonymFiledPrefix=this.anonymFiledPrefix+(a.fieldName+"__");this.Visit(a.expression,b);this.anonymFiledPrefix=d;if(!(a.expression instanceof $data.Expressions.ObjectLiteralExpression)&&!(a.expression instanceof $data.Expressions.ComplexTypeExpression)){b.addText(SqlStatementBlocks.as);b.addText(this.anonymFiledPrefix+a.fieldName)}}this.currentObjectLiteralName=c}},null);
$C("$data.sqLite.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.Visit=function(b,c){var d=b,e;if(this.canVisit(b)){a.VisitExpressionNode&&a.VisitExpressionNode.apply(a,arguments);e="Visit"+b.getType().name;e in a&&(d=a[e].apply(a,arguments))}var h=arguments;d!==b&&(h=[d,c]);d=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,h);h=[d,c];if(this.canVisit(d)){var f=d.getType().name;a.MonitorExpressionNode&&a.MonitorExpressionNode.apply(a,
h);e="Monitor"+f;e in a&&a[e].apply(a,h);a.MutateExpressionNode&&a.MutateExpressionNode.apply(a,h);e="Mutate"+f;e in a&&(d=a[e].apply(a,h))}return d}}});
$C("$data.sqLite.SqlFilterCompiler",$data.Expressions.EntityExpressionVisitor,null,{VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitUnaryExpression:function(a,b){b.addText(a.resolution.mapTo);b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.operand,b);b.addText(SqlStatementBlocks.endGroup)},VisitSimpleBinaryExpression:function(a,b){var c=this;if(a.nodeType=="arrayIndex")this.Visit(a.left,b);else{b.addText(SqlStatementBlocks.beginGroup);this.Visit(a.left,b);b.addText(" "+
a.resolution.mapTo+" ");if(a.nodeType=="in"){Guard.requireType("expression.right",a.right,$data.Expressions.ConstantExpression);var d=a.right.value;if(d instanceof Array){b.addText(SqlStatementBlocks.beginGroup);d.forEach(function(a,d){d>0&&b.addText(SqlStatementBlocks.valueSeparator);var f=Container.createConstantExpression(a);c.Visit(f,b)});b.addText(SqlStatementBlocks.endGroup)}else d instanceof $data.Queryable?b.addText("(SELECT d FROM ("+d.toTraceString().sqlText+"))"):Guard.raise(new Exception("Only constant arrays and Queryables can be on the right side of 'in' operator",
"UnsupportedType"))}else this.Visit(a.right,b);b.addText(SqlStatementBlocks.endGroup)}},VisitEntitySetExpression:function(a,b){var c=b.getExpressionAlias(a);b.addText(c);b.addText(SqlStatementBlocks.nameSeparator)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition,d=c.mapTo||c.name;b.addText(d);b.addText(SqlStatementBlocks.beginGroup);if(d==="like"){d=Container.createSqlBuilder([],
b.entityContext);d.selectTextPart("fragment");this.Visit(a.parameters[0],d);d=d.getTextPart("fragment");d.params.forEach(function(a){var d=c.parameters[0],a=d.prefix?d.prefix+a:a,a=d.suffix?a+d.suffix:a;b.addParameter(a)});b.addText(d.text);b.addText(" , ");this.Visit(a.source,b)}else{this.Visit(a.source,b);a.parameters.forEach(function(a){b.addText(" , ");this.Visit(a,b)},this)}b.addText(SqlStatementBlocks.endGroup)},VisitMemberInfoExpression:function(a,b){b.addText(a.memberName)},VisitQueryParameterExpression:function(a,
b){var c=null,c=a.type=="array"?a.value[a.index]:a.value;b.addParameter(c);b.addText(SqlStatementBlocks.parameter)},VisitConstantExpression:function(a,b){var c=Container.getTypeName(a.value),c=b.entityContext.storageProvider.fieldConverter.toDb[Container.resolveName(Container.resolveType(c))](a.value);b.addParameter(c);b.addText(SqlStatementBlocks.parameter)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,
b);this.Visit(a.selector,b);b.addText("__")}});
$C("$data.sqLite.sqLite_ModelBinderCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this._query=a;this._includes=b},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},VisitForEachExpression:function(a){this._defaultModelBinder(a)},
VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();c.Visit(a);c.projectionExpression?this.Visit(c.projectionExpression,b):this.DefaultSelection(b)},_defaultModelBinder:function(a){var b=
Container.createqueryBuilder();b.modelBinderConfig.$type=$data.Array;b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,b){var c=this._query.context._storageModel.getStorageModel(a);a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name]){a.key&&(this.currentObjectFieldName?
b.addKeyField(this.currentObjectFieldName+"__"+a.name):b.addKeyField(a.name));b.modelBinderConfig[a.name]=this.currentObjectFieldName?this.currentObjectFieldName+"__"+a.name:a.name}},this);c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){b.selectModelBinderProperty(a.FromPropertyName);b.modelBinderConfig.$type=a.ToType;var d=this.currentObjectFieldName;this.currentObjectFieldName=this.currentObjectFieldName?this.currentObjectFieldName+
"__":"";this.currentObjectFieldName=this.currentObjectFieldName+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty();this.currentObjectFieldName=d},this)},DefaultSelection:function(a){a.modelBinderConfig.$type=this._query.defaultType;var b=this._query.context._storageModel.getStorageModel(this._query.defaultType);this._addPropertyToModelBinderConfig(this._query.defaultType,a);this._includes&&this._includes.forEach(function(c){for(var d=c.name.split("."),e=
null,h=b,f=0;f<d.length;f++){a.selectModelBinderProperty(d[f]);e=h.Associations[d[f]];h=this._query.context._storageModel.getStorageModel(e.ToType)}a.modelBinderConfig.$selector="json:"+c.name;if(e.ToMultiplicity==="*"){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,a);a.popModelBinderProperty()}else{a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,a)}for(f=0;f<d.length;f++)a.popModelBinderProperty()},
this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b)},VisitParametricQueryExpression:function(a,b){if(a.expression instanceof $data.Expressions.EntityExpression)this.VisitEntityAsProjection(a.expression,b);else{this.Visit(a.expression,b);if(a.expression instanceof $data.Expressions.EntityFieldExpression){b.modelBinderConfig.$source="d";b.modelBinderConfig.$keys=["rowid$$"]}}},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$source=
this.currentObjectFieldName},VisitEntityAsProjection:function(a,b){this.Visit(a.source,b);b.modelBinderConfig.$type=a.entityType;this._addPropertyToModelBinderConfig(a.entityType,b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){if(a.memberDefinition instanceof $data.MemberDefinition){b.modelBinderConfig.$type=a.memberDefinition.type;a.memberName in a.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),
b):b.modelBinderConfig.$source=this.currentObjectFieldName}},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){"$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0?b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+".":b.modelBinderConfig.$selector="json:";b.modelBinderConfig.$selector=
b.modelBinderConfig.$selector+a.associationInfo.FromPropertyName},VisitSimpleBinaryExpression:function(a,b){this.Visit(a.left,b);this.Visit(a.right,b);b.modelBinderConfig.$type=void 0},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$keys=this.currentObjectFieldName?[this.currentObjectFieldName+"__rowid$$"]:["rowid$$"];b.modelBinderConfig.$type=$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,b){var c=this.currentObjectFieldName;
b.selectModelBinderProperty(a.fieldName);this.currentObjectFieldName=this.currentObjectFieldName?this.currentObjectFieldName+"__":"";this.currentObjectFieldName=this.currentObjectFieldName+a.fieldName;a.expression instanceof $data.Expressions.EntityExpression?this.VisitEntityAsProjection(a.expression,b):this.Visit(a.expression,b);this.currentObjectFieldName=c;b.popModelBinderProperty()}});
$C("$data.storageProviders.oData.oDataProvider",$data.StorageProviderBase,null,{constructor:function(a,b){typeof OData==="undefined"&&Guard.raise(new Exception("datajs is required","Not Found!"));this.SqlCommands=[];this.context=b;this.providerConfiguration=$data.typeSystem.extend({dbCreation:$data.storageProviders.sqLite.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"2.0",user:null,password:null},a);if(this.context&&this.context._buildDbType_generateConvertToFunction&&
this.buildDbType_generateConvertToFunction)this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction;if(this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition)this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition},initializeStore:function(a){a=$data.typeSystem.createCallbackSetting(a);switch(this.providerConfiguration.dbCreation){case $data.storageProviders.sqLite.DbCreationType.DropAllExistingTables:var b=
this;if(this.providerConfiguration.serviceUrl){var c=[{requestUri:b.providerConfiguration.serviceUrl+"/Delete",method:"POST"},function(){console.log("RESET oData database");a.success(b.context)},function(){a.success(b.context)}];if(this.providerConfiguration.user){c[0].user=this.providerConfiguration.user;c[0].password=this.providerConfiguration.password||""}this.context.prepareRequest.call(this,c);OData.request.apply(this,c)}else a.success(b.context);break;default:a.success(this.context)}},buildDbType_generateConvertToFunction:function(a,
b){return function(c,d){var e=new a.PhysicalType;e.entityState=c.entityState;a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){e[a.name]=c[a.name]},this);a.Associations&&a.Associations.forEach(function(a){if(a.FromMultiplicity=="*"&&a.ToMultiplicity=="0..1"||a.FromMultiplicity=="0..1"&&a.ToMultiplicity=="1"||a.FromMultiplicity=="$$unbound"){var f=c[a.FromPropertyName];if(f!==null&&f!==void 0)if(f instanceof $data.Array){e[a.FromPropertyName]=e[a.FromPropertyName]||[];
f.forEach(function(b){b=d.indexOf(b);b<0&&Guard.raise("Dependency graph error");e[a.FromPropertyName].push({__metadata:{uri:"$"+(b+1)}})},this)}else if(f.entityState===$data.EntityState.Modified){var k=b._storageModel.getStorageModel(f.getType()).TableName,i="(";f.getType().memberDefinitions.getKeyProperties().forEach(function(a,b){b>0&&(i=i+",");i=i+f[a.name]},this);i=i+")";e[a.FromPropertyName]={__metadata:{uri:k+i}}}else{k=d.indexOf(f);k<0&&Guard.raise("Dependency graph error");e[a.FromPropertyName]=
{__metadata:{uri:"$"+(k+1)}}}}},this);a.ComplexTypes&&a.ComplexTypes.forEach(function(a){e[a.FromPropertyName]=c[a.FromPropertyName]},this);return e}},executeQuery:function(a,b){var b=$data.typeSystem.createCallbackSetting(b),c;try{c=this._compile(a)}catch(d){b.error(d);return}c=[{requestUri:this.providerConfiguration.oDataServiceHost+c.queryText,headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},function(c){if(b.success){a.rawDataList=typeof c==="string"?[{cnt:c}]:
c;b.success(a)}},function(a,c,d){b.error(d)}];if(this.providerConfiguration.user){c[0].user=this.providerConfiguration.user;c[0].password=this.providerConfiguration.password||""}this.context.prepareRequest.call(this,c);OData.request.apply(this,c)},_compile:function(a){return(new $data.storageProviders.oData.oDataCompiler).compile(a)},saveChanges:function(a,b){b.length>0?this.saveInternal(this.buildIndependentBlocks(b),0,a):a.success(0)},saveInternal:function(a,b,c){batchRequests=[];convertedItem=
[];for(b=0;b<a.length;b++)for(var d=0;d<a[b].length;d++){convertedItem.push(a[b][d].data);var e={};e.headers={"Content-Id":convertedItem.length};switch(a[b][d].data.entityState){case $data.EntityState.Unchanged:continue;case $data.EntityState.Added:e.method="POST";e.requestUri=a[b][d].entitySet.name;e.data=this.save_getInitData(a[b][d],convertedItem);break;case $data.EntityState.Modified:e.method="MERGE";e.requestUri=a[b][d].entitySet.name;e.requestUri=e.requestUri+("("+this.getEntityKeysValue(a[b][d])+
")");this.save_addConcurrencyHeader(a[b][d],e.headers);e.data=this.save_getInitData(a[b][d],convertedItem);break;case $data.EntityState.Deleted:e.method="DELETE";e.requestUri=a[b][d].entitySet.name;e.requestUri=e.requestUri+("("+this.getEntityKeysValue(a[b][d])+")");break;default:Guard.raise(new Exception("Not supported Entity state"))}batchRequests.push(e)}a=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:batchRequests}]}},
function(a,b){if(b.statusCode==202){for(var d=a.__batchResponses[0].__changeResponses,e=0;e<d.length;e++){var u=convertedItem[e];if(d[e].statusCode==204){if(d[e].headers.ETag){var o=u.getType().memberDefinitions.getPublicMappedProperties().filter(function(a){return a.concurrencyMode===$data.ConcurrencyMode.Fixed});if(o&&o[0])u[o[0].name]=d[e].headers.ETag}}else u.getType().memberDefinitions.getPublicMappedProperties().forEach(function(a){a.computed&&(u[a.name]=a.concurrencyMode===$data.ConcurrencyMode.Fixed?
d[e].headers.ETag:d[e].data[a.name])},this)}c.success&&c.success(convertedItem.length)}else c.error(b)},c.error,OData.batchHandler];if(this.providerConfiguration.user){a[0].user=this.providerConfiguration.user;a[0].password=this.providerConfiguration.password||""}this.context.prepareRequest.call(this,a);OData.request.apply(this,a)},save_getInitData:function(a,b){a.physicalData=this.context._storageModel.getStorageModel(a.data.getType()).PhysicalType.convertTo(a.data,b);var c={};a.physicalData.getType().memberDefinitions.asArray().forEach(function(b){if(b.kind==
$data.MemberTypes.navProperty||b.kind==$data.MemberTypes.complexProperty||b.kind==$data.MemberTypes.property&&!b.notMapped)c[b.name]=a.physicalData[b.name]},this);return c},save_addConcurrencyHeader:function(a,b){var c=a.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(a){return a.concurrencyMode===$data.ConcurrencyMode.Fixed});if(c&&c[0]){b["If-Match"]=a.data[c[0].name];a.data[c[0].name]=""}},getTraceString:function(a){this._compile(a);return a},supportedDataTypes:{value:[$data.Integer,
$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},divide:{mapTo:"div",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},
multiply:{mapTo:"mul",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",
dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],
parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",
dataType:"date"}]},month:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],
parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]}},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],
parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:$data.Expressions.SomeExpression},every:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"all",frameType:$data.Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{}},enumerable:!0,writable:!0},fieldConverter:{value:{fromDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},"$data.Date":function(a){return a?
new Date(parseInt(a.substr(6))):void 0},"$data.String":function(a){return a},"$data.Boolean":function(a){return a},"$data.Blob":function(a){return a},"$data.Object":function(a){return a===void 0?new $data.Object:JSON.parse(a)},"$data.Array":function(a){return a===void 0?new $data.Array:JSON.parse(a)}},toDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a%1==0?a:a+"m"},"$data.Date":function(a){return a?"datetime'"+a.toISOString()+"'":null},"$data.String":function(a){return"'"+
a.replace(/'/g,"''")+"'"},"$data.Boolean":function(a){return a?"true":"false"},"$data.Blob":function(a){return a},"$data.Object":function(a){return JSON.stringify(a)},"$data.Array":function(a){return JSON.stringify(a)}}}},getEntityKeysValue:function(a){for(var b=[],c=void 0,d=a.entitySet.createNew.memberDefinitions.asArray(),e=0,h=d.length;e<h;e++){var f=d[e];if(f.key){c=a.data[f.name];f.dataType=="string"&&(c="'"+c+"'");b.push(f.name+"="+c)}}return b.length>1?b.join(","):c}},null);
$data.StorageProviderBase.registerProvider("oData",$data.storageProviders.oData.oDataProvider);
$C("$data.storageProviders.oData.oDataCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={};this.provider={};this.mainEntitySet=this.includes=null},compile:function(a){this.provider=a.context.storageProvider;this.context=a.context;this.mainEntitySet=a.context.getEntitySetFromElementType(a.defaultType);var b={urlText:""};this.Visit(a.expression,b);a.modelBinderConfig={};Container.createModelBinderConfigCompiler(a,this.includes,true).Visit(a.expression);var c=
b.urlText,d=false,e;for(e in b)if(e!="urlText"&&e!="actionPack"&&e!="data"&&e!="lambda"&&b[e]!=""){c=d?c+"&":c+"?";d=true;c=e!="$urlParams"?c+(e+"="+b[e]):c+b[e]}a.queryText=c;return{queryText:c,params:[]}},VisitOrderExpression:function(a,b){this.Visit(a.source,b);Container.createoDataOrderCompiler(this.provider).compile(a,b)},VisitPagingExpression:function(a,b){this.Visit(a.source,b);Container.createoDataPagingCompiler().compile(a,b)},VisitIncludeExpression:function(a,b){this.Visit(a.source,b);if(!b.$select){b.$expand=
b.$expand?b.$expand+",":"";b.$expand=b.$expand+a.selector.value.replace(".","/");this.includes=this.includes||[];for(var c=a.selector.value.split("."),d=null,e=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew),h=0;h<c.length;h++){d=d?d+("."+c[h]):c[h];(e=e.Associations[c[h]])?this.includes.some(function(a){return a.name==d},this)||this.includes.push({name:d,type:e.ToType}):Guard.raise(new Exception("The given include path is invalid: "+a.selector.value+", invalid point: "+
d));e=this.mainEntitySet.entityContext._storageModel.getStorageModel(e.ToType)}}},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);Container.createoDataProjectionCompiler(this.context).compile(a,b)},VisitFilterExpression:function(a,b){this.Visit(a.source,b);var c=Container.createoDataWhereCompiler(this.provider);b.data="";c.compile(a.selector,b);b.$filter=b.data;b.data=""},VisitEntitySetExpression:function(a,b){b.urlText=b.urlText+("/"+a.instance.tableName);if(a.params)for(var c=0;c<
a.params.length;c++)this.Visit(a.params[c],b)},VisitServiceOperationExpression:function(a,b){b.urlText=b.urlText+("/"+a.cfg.serviceName);if(a.params)for(var c=0;c<a.params.length;c++)this.Visit(a.params[c],b)},VisitConstantExpression:function(a,b){b.$urlParams=b.$urlParams?b.$urlParams+"&":"";var c=Container.getTypeName(a.value);b.$urlParams=b.$urlParams+(a.name+"="+this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(c))](a.value))},VisitCountExpression:function(a,b){this.Visit(a.source,
b);b.urlText=b.urlText+"/$count"}},{});
$C("$data.storageProviders.oData.oDataWhereCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b){this.provider=a;this.lambdaPrefix=b},compile:function(a,b){this.Visit(a,b)},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitUnaryExpression:function(a,b){b.data=b.data+a.resolution.mapTo;b.data=b.data+"(";this.Visit(a.operand,b);b.data=b.data+")"},VisitSimpleBinaryExpression:function(a,b){b.data=b.data+"(";if(a.nodeType=="in"){Guard.requireType("expression.right",
a.type,$data.Expressions.ConstantExpression);var c=a.right.value;!c instanceof Array&&Guard.raise(new Exception("Right to the 'in' operator must be an array value"));var d=null,e={mapTo:"or",dataType:"boolean",name:"or"},h={mapTo:"eq",dataType:"boolean",name:"equal"};c.forEach(function(b){b=Container.createConstantExpression(b);b=Container.createSimpleBinaryExpression(a.left,b,$data.Expressions.ExpressionType.Equal,"==","boolean",h);d=d?Container.createSimpleBinaryExpression(d,b,$data.Expressions.ExpressionType.Or,
"||","boolean",e):b});c=b.data;b.data="";this.Visit(d,b);b.data=c+b.data.replace(/\(/g,"").replace(/\)/g,"")}else{this.Visit(a.left,b);b.data=b.data+" ";b.data=b.data+a.resolution.mapTo;b.data=b.data+" ";this.Visit(a.right,b)}b.data=b.data+")"},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitAssociationInfoExpression:function(a,b){b.data=b.data+a.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(a,b){b.data=b.data+a.memberName},VisitQueryParameterExpression:function(a,
b){b.data=b.data+this.provider.fieldConverter.toDb[a.type](a.value)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;b.data=b.data+(c.mapTo||c.name);b.data=b.data+"(";var d=0;(c.parameters||[{name:"@expression"}]).map(function(b){return b.name==="@expression"?a.source:a.parameters[d++]}).forEach(function(a,c){if(c>0)b.data=b.data+",";this.Visit(a,b)},this);b.data=b.data+
")"},VisitConstantExpression:function(a,b){var c=Container.getTypeName(a.value);b.data=b.data+this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(c))](a.value)},VisitEntityExpression:function(a,b){this.Visit(a.source,b);if(this.lambdaPrefix&&a.selector.lambda){b.lambda=a.selector.lambda;b.data=b.data+(a.selector.lambda+"/")}},VisitEntitySetExpression:function(a,b){this.Visit(a.source,b);if(a.selector instanceof $data.Expressions.AssociationInfoExpression){this.Visit(a.selector,
b);b.data=b.data+"/"}},VisitFrameOperationExpression:function(a,b){this.Visit(a.source,b);Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition;b.data=b.data+(c.mapTo||c.name);b.data=b.data+"(";for(var d=0,e=(c.parameters||[{name:"@expression"}]).map(function(b){return b.name==="@expression"?a.source:a.parameters[d++]}),h=0;h<e.length;h++){var f=e[h];if(f.value instanceof $data.Queryable){var k=new c.frameType(f.value.expression),
f=Container.createQueryExpressionCreator(f.value.entityContext).Visit(k),k={data:""};(new $data.storageProviders.oData.oDataWhereCompiler(this.provider,true)).compile(f,k);b.data=b.data+(k.lambda+": "+k.data)}}b.data=b.data+")"}});
$C("$data.storageProviders.oData.oDataOrderCompiler",$data.storageProviders.oData.oDataWhereCompiler,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitOrderExpression:function(a,b){var c={data:""};this.Visit(a.selector,c);b.$orderby=b.$orderby?b.$orderby+",":"";b.$orderby=b.$orderby+(c.data+(a.nodeType==ExpressionType.OrderByDescending?" desc":""))},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b)},VisitEntityFieldExpression:function(a,
b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);b.data=b.data+"/"},VisitEntitySetExpression:function(a,b){if(a.selector instanceof $data.Expressions.AssociationInfoExpression){this.Visit(a.source,b);this.Visit(a.selector,b)}},VisitAssociationInfoExpression:function(a,b){b.data=b.data+(a.associationInfo.FromPropertyName+"/")},VisitEntityExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,
b)},VisitMemberInfoExpression:function(a,b){b.data=b.data+a.memberName}});
$C("$data.storageProviders.oData.oDataPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.provider=a},compile:function(a,b){this.Visit(a,b)},VisitPagingExpression:function(a,b){var c={data:""};this.Visit(a.amount,c);switch(a.nodeType){case ExpressionType.Skip:b.$skip=c.data;break;case ExpressionType.Take:b.$top=c.data;break;default:Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(a,b){b.data=b.data+a.value}});
$C("$data.storageProviders.oData.oDataProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a){this.entityContext=a;this.hasObjectLiteral=false;this.ObjectLiteralPath="";this.modelBinderMapping=[]},compile:function(a,b){this.Visit(a,b)},VisitProjectionExpression:function(a,b){this.mapping=b.data="";this.Visit(a.selector,b);b.$select=b.$select?b.$select+",":"";b.$select=b.$select+b.data;b.data=""},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,
b);if(a.expression instanceof $data.Expressions.EntityExpression){b.$expand=b.$expand?b.$expand+",":"";b.$expand=b.$expand+this.mapping.replace(/\./g,"/")}var c=this.mapping.split(".");c.pop();if(c.length>0){b.$expand=b.$expand?b.$expand+",":"";b.$expand=b.$expand+c.join("/")}},VisitObjectLiteralExpression:function(a,b){var c=this.ObjectLiteralPath;this.hasObjectLiteral=true;a.members.forEach(function(c,e){this.Visit(c,b);if(e<a.members.length-1)b.data=b.data+",";this.mapping=""},this);this.ObjectLiteralPath=
c},VisitObjectFieldExpression:function(a,b){this.ObjectLiteralPath=this.ObjectLiteralPath?this.ObjectLiteralPath+("."+a.fieldName):a.fieldName;this.Visit(a.expression,b);if(a.expression instanceof $data.Expressions.EntityExpression){b.$expand=b.$expand?b.$expand+",":"";b.$expand=b.$expand+this.mapping.replace(/\./g,"/")}else{var c=this.mapping.split(".");c.pop();if(c.length>0){b.$expand=b.$expand?b.$expand+",":"";b.$expand=b.$expand+c.join("/")}}},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,
b);this.Visit(a.selector,b)},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitEntitySetExpression:function(a,b){a.source instanceof $data.Expressions.EntityExpression&&this.Visit(a.source,b);a.selector instanceof $data.Expressions.AssociationInfoExpression&&this.Visit(a.selector,b)},VisitAssociationInfoExpression:function(a,b){if(b.data&&b.data.length>0&&b.data[b.data.length-1]!=",")b.data=b.data+
"/";b.data=b.data+a.associationInfo.FromPropertyName;if(this.mapping&&this.mapping.length>0)this.mapping=this.mapping+".";this.mapping=this.mapping+a.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(a,b){if(b.data&&b.data.length>0&&b.data[b.data.length-1]!=",")b.data=b.data+"/";b.data=b.data+a.memberName;if(this.mapping&&this.mapping.length>0)this.mapping=this.mapping+".";this.mapping=this.mapping+a.memberName},VisitConstantExpression:function(a,b){b.data=b.data.slice(0,b.data.length-
1)}});$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(a){this.projectionExpression=a}});
$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(a,b,c){this._query=a;this._includes=b;this._isoDataProvider=c||false},VisitSingleExpression:function(a){this._defaultModelBinder(a)},VisitSomeExpression:function(a){this._defaultModelBinder(a)},VisitEveryExpression:function(a){this._defaultModelBinder(a)},VisitToArrayExpression:function(a){this._defaultModelBinder(a)},VisitFirstExpression:function(a){this._defaultModelBinder(a)},VisitForEachExpression:function(a){this._defaultModelBinder(a)},
VisitServiceOperationExpression:function(a){var b=Container.createqueryBuilder(),c=Container.resolveType(a.cfg.returnType);b.modelBinderConfig.$type=c;c.inheritsFrom===$data.Entity?b.modelBinderConfig.$selector=["json:"+a.cfg.serviceName]:b.modelBinderConfig.$source=a.cfg.serviceName;this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},VisitCountExpression:function(){var a=Container.createqueryBuilder();a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");
a.modelBinderConfig.$type=$data.Integer;a.modelBinderConfig.$source="cnt";a.resetModelBinderProperty();this._query.modelBinderConfig=a.modelBinderConfig},VisitConstantExpression:function(a,b){b.modelBinderConfig.$type=a.type;b.modelBinderConfig.$value=a.value},VisitExpression:function(a,b){var c=Container.createFindProjectionVisitor();c.Visit(a);c.projectionExpression?this.Visit(c.projectionExpression,b):this.DefaultSelection(b)},_defaultModelBinder:function(a){var b=Container.createqueryBuilder();
b.modelBinderConfig.$type=$data.Array;this._isoDataProvider&&(b.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]);b.modelBinderConfig.$item={};b.selectModelBinderProperty("$item");this.VisitExpression(a,b);b.resetModelBinderProperty();this._query.modelBinderConfig=b.modelBinderConfig},_addPropertyToModelBinderConfig:function(a,b){var c=this._query.context._storageModel.getStorageModel(a);if(a.memberDefinitions)a.memberDefinitions.getPublicMappedProperties().forEach(function(a){if(!c||
c&&!c.Associations[a.name]&&!c.ComplexTypes[a.name])if(!c&&this._query.context.storageProvider.supportedDataTypes.indexOf(Container.resolveType(a.dataType))<0){b.selectModelBinderProperty(a.name);b.modelBinderConfig.$type=Container.resolveType(a.dataType);b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.name+".results","json:"+a.name]:"json:"+a.name;this._addPropertyToModelBinderConfig(Container.resolveType(a.dataType),b);b.popModelBinderProperty()}else{a.key&&b.addKeyField(a.name);
b.modelBinderConfig[a.name]=a.concurrencyMode===$data.ConcurrencyMode.Fixed?{$selector:"json:__metadata",$source:"etag"}:a.name}},this);else{b._binderConfig.$item={};b.modelBinderConfig=b._binderConfig.$item}c&&this._addComplexTypeProperties(c.ComplexTypes,b)},_addComplexTypeProperties:function(a,b){a.forEach(function(a){b.selectModelBinderProperty(a.FromPropertyName);b.modelBinderConfig.$type=a.ToType;b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.FromPropertyName+".results","json:"+
a.FromPropertyName]:"json:"+a.FromPropertyName;this._addPropertyToModelBinderConfig(a.ToType,b);b.popModelBinderProperty()},this)},DefaultSelection:function(a){a.modelBinderConfig.$type=this._query.defaultType;var b=this._query.context._storageModel.getStorageModel(this._query.defaultType);this._addPropertyToModelBinderConfig(this._query.defaultType,a);this._includes&&this._includes.forEach(function(c){for(var d=c.name.split("."),e=null,h=b,f=0;f<d.length;f++){a.modelBinderConfig.$item&&a.selectModelBinderProperty("$item");
a.selectModelBinderProperty(d[f]);e=h.Associations[d[f]];h=this._query.context._storageModel.getStorageModel(e.ToType)}a.modelBinderConfig.$selector=this._isoDataProvider?["json:"+d[d.length-1]+".results","json:"+d[d.length-1]]:"json:"+d[d.length-1];if(e.ToMultiplicity==="*"){a.modelBinderConfig.$type=$data.Array;a.selectModelBinderProperty("$item");a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,a);a.popModelBinderProperty()}else{a.modelBinderConfig.$type=c.type;this._addPropertyToModelBinderConfig(c.type,
a)}for(f=0;f<d.length;f++)a.popModelBinderProperty()},this)},VisitProjectionExpression:function(a,b){this.hasProjection=true;this.Visit(a.selector,b)},VisitParametricQueryExpression:function(a,b){a.expression instanceof $data.Expressions.EntityExpression?this.VisitEntityAsProjection(a.expression,b):this.Visit(a.expression,b)},VisitEntityAsProjection:function(a,b){this.Visit(a.source,b);b.modelBinderConfig.$type=a.entityType;this._addPropertyToModelBinderConfig(a.entityType,b)},VisitEntityFieldExpression:function(a,
b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){b.modelBinderConfig.$type=a.memberDefinition.type;a.memberDefinition.storageModel&&a.memberName in a.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(a.memberDefinition.type),b):b.modelBinderConfig.$source=a.memberName},VisitEntitySetExpression:function(a,b){if(a.source instanceof $data.Expressions.EntityExpression){this.Visit(a.source,b);this.Visit(a.selector,
b)}},VisitComplexTypeExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b);if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.selector.memberName+".results";b.modelBinderConfig.$selector[1]=c+"."+a.selector.memberName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.selector.memberName);else b.modelBinderConfig.$selector=
this._isoDataProvider?["json:"+a.selector.memberName+".results","json:"+a.selector.memberName]:"json:"+a.selector.memberName},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},VisitAssociationInfoExpression:function(a,b){if("$selector"in b.modelBinderConfig&&b.modelBinderConfig.$selector.length>0)if(b.modelBinderConfig.$selector instanceof $data.Array){var c=b.modelBinderConfig.$selector[1];b.modelBinderConfig.$selector[0]=c+"."+a.associationInfo.FromPropertyName+".results";b.modelBinderConfig.$selector[1]=
c+"."+a.associationInfo.FromPropertyName}else b.modelBinderConfig.$selector=b.modelBinderConfig.$selector+("."+a.associationInfo.FromPropertyName);else b.modelBinderConfig.$selector=this._isoDataProvider?["json:"+a.associationInfo.FromPropertyName+".results","json:"+a.associationInfo.FromPropertyName]:"json:"+a.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(a,b){b.modelBinderConfig.$type=$data.Object;a.members.forEach(function(a){this.Visit(a,b)},this)},VisitObjectFieldExpression:function(a,
b){b.selectModelBinderProperty(a.fieldName);a.expression instanceof $data.Expressions.EntityExpression?this.VisitEntityAsProjection(a.expression,b):this.Visit(a.expression,b);b.popModelBinderProperty()}});
$data.Class.define("$data.storageProviders.indexedDb.IndexedDBStorageProvider",$data.StorageProviderBase,null,{constructor:function(a){this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;this.IDBRequest=window.IDBRequest||window.webkitIDBRequest||window.mozIDBRequest||window.msIDBRequest;this.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.msIDBTransaction;this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||
window.mozIDBKeyRange||window.msIDBKeyRange;this.IDBDatabaseException=window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.msIDBDatabaseException;this.IDBOpenDBRequest=window.IDBOpenDBRequest||window.webkitIDBOpenDBRequest||window.mozIDBOpenDBRequest||window.msIDBOpenDBRequest;this.newVersionAPI=!(!window.IDBFactory||!IDBFactory.prototype.deleteDatabase);this.sequenceStore="__jayData_sequence";this.SqlCommands=[];this.context={};this.providerConfiguration=
$data.typeSystem.extend({databaseName:"JayDataDemo",version:1,dbCreation:$data.storageProviders.indexedDb.DbCreationType.Default},a);this._setupExtensionMethods()},supportedBinaryOperators:{value:{equal:{mapTo:" == ",dataType:$data.Boolean},notEqual:{mapTo:" != ",dataType:$data.Boolean},equalTyped:{mapTo:" == ",dataType:$data.Boolean},notEqualTyped:{mapTo:" != ",dataType:$data.Boolean},greaterThan:{mapTo:" > ",dataType:$data.Boolean},greaterThanOrEqual:{mapTo:" >= ",dataType:$data.Boolean},lessThan:{mapTo:" < ",
dataType:$data.Boolean},lessThenOrEqual:{mapTo:" <= ",dataType:$data.Boolean},or:{mapTo:" || ",dataType:$data.Boolean},and:{mapTo:" && ",dataType:$data.Boolean}}},supportedSetOperations:{value:{length:{},toArray:{},forEach:{}},enumerable:!0,writable:!0},_setupExtensionMethods:function(){var a=this,b=this.IDBRequest,c=this.IDBTransaction,d=this.IDBOpenDBRequest,e=function(b){typeof b!=="object"&&Guard.raise(new Exception("Invalid callbackSettings",null,b));for(var c in b)typeof this[c]==="undefined"||
typeof b[c]!=="function"||(this[c]=b[c]);this.readyState==a.IDBRequest.DONE&&console.log("WARNING: request finished before setCallbacks. Do not use breakpoints between creating the request object and finishing the setting of callbacks");return this};if(typeof b.prototype.setCallbacks!=="function")b.prototype.setCallbacks=e;if(typeof c.prototype.setCallbacks!=="function")c.prototype.setCallbacks=e;if(d&&typeof d.prototype.setCallbacks!=="function")d.prototype.setCallbacks=e},supportedDataTypes:{value:[$data.Integer,
$data.Number,$data.Date,$data.String,$data.Boolean,$data.Blob,$data.Array,$data.Object],writable:!1},fieldConverter:{value:{fromDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},"$data.Date":function(a){return a},"$data.String":function(a){return a},"$data.Boolean":function(a){return a},"$data.Blob":function(a){return a},"$data.Array":function(a){return a===void 0?new $data.Array:a},"$data.Object":function(a){return a}},toDb:{"$data.Integer":function(a){return a},"$data.Number":function(a){return a},
"$data.Date":function(a){return a},"$data.String":function(a){return a},"$data.Boolean":function(a){return a},"$data.Blob":function(a){return a},"$data.Array":function(a){return a},"$data.Object":function(a){return a}}}},initializeStore:function(a){var a=$data.typeSystem.createCallbackSetting(a),b=this,c=function(a){a.onversionchange=function(a){return a.target.close()};var c=[];b.context._storageModel.forEach(function(d){function e(){var i={},o=b._getKeySettings(d);b.newVersionAPI?o.autoIncrement&&
c.push(d.TableName):i.autoIncrement=o.autoIncrement;if(o.keyPath!==void 0)i.keyPath=o.keyPath;a.createObjectStore(d.TableName,i)}if(a.objectStoreNames.contains(d.TableName)){if(b.providerConfiguration.dbCreation===$data.storageProviders.indexedDb.DbCreationType.DropStoreIfExists){a.deleteObjectStore(d.TableName);e()}}else e()});if(c.length>0&&!a.objectStoreNames.contains(b.sequenceStore)){a.createObjectStore(b.sequenceStore,{keyPath:"store"});c=[]}return c},d=null,e={onupgradeneeded:function(a){d=
c(a.target.result)},onerror:a.error,onblocked:a.error,onsuccess:function(e){b.db=e.target.result;b.db.onversionchange=function(a){a.target.close()};if(b.newVersionAPI){if(d&&d.length>0){var f=b.db.transaction([b.sequenceStore],b.IDBTransaction.READ_WRITE).setCallbacks({onerror:a.error,oncomplete:function(){a.success(b.context)}}).objectStore(b.sequenceStore);switch(b.providerConfiguration.dbCreation){case $data.storageProviders.indexedDb.DbCreationType.DropStoreIfExists:case $data.storageProviders.indexedDb.DbCreationType.DropStoreIfOlderVersion:f.clear();
break;default:d.forEach(function(a){f["delete"](a)})}}a.success(b.context)}else b.db.setVersion(b.providerConfiguration.version).setCallbacks({onerror:a.error,onblocked:a.error,onsuccess:function(){c(b.db);a.success(b.context)}})}};b.newVersionAPI?b.indexedDB.open(b.providerConfiguration.databaseName,parseInt(b.providerConfiguration.version,10)).setCallbacks(e):b.indexedDB.open(b.providerConfiguration.databaseName).setCallbacks(e)},executeQuery:function(a,b){var b=$data.typeSystem.createCallbackSetting(b),
c=a.context.getEntitySetFromElementType(a.defaultType),c=this.db.transaction([c.tableName],this.IDBTransaction.READ_ONLY).setCallbacks({onerror:b.error,onabort:b.error,oncomplete:function(){b.success(a)}}).objectStore(c.tableName);Container.createModelBinderConfigCompiler(a,[]).Visit(a.expression);switch(a.expression.nodeType){case $data.Expressions.ExpressionType.Count:c.count().onsuccess=function(b){a.rawDataList.push({cnt:b.target.result})};break;default:c.openCursor().onsuccess=function(b){if(b=
b.target.result){a.rawDataList.push(b.value);b["continue"]()}}}},_getKeySettings:function(a){var b={autoIncrement:false},c=[];a.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(a){a.key&&c.push(a.name);if(a.computed){a.key||Guard.raise(new Exception("Only key field can be a computed field!"));b.autoIncrement=true}});if(c.length>1){b.autoIncrement&&Guard.raise(new Exception("Auto increment is only valid for a single key!"));b.keys=c}else c.length==1?b.keyPath=c[0]:Guard.raise(new Exception("No valid key found!"));
return b},saveChanges:function(a,b){function c(){if(e.length===0)a.success();else{var b={},f=e.shift().map(function(a){b[a.entitySet.tableName]=true;a.physicalData={};d.context._storageModel.getStorageModel(a.data.getType()).PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(b){if(!b.key||!(b.computed&&a.data[b.name]==void 0))a.physicalData[b.name]=a.data[b.name]});return a}),k=[],i;for(i in b)k.push(i);var u=d.db.transaction(k,d.IDBTransaction.READ_WRITE).setCallbacks({onerror:function(b){b.target.errorCode!==
d.IDBDatabaseException.ABORT_ERR&&a.error(b)},oncomplete:function(){c()}}),o=new function(){var a={};this.getSettingsForItem=function(b){var c=b.data.getType().fullName;a.hasOwnProperty(c)||(a[c]=d._getKeySettings(d.context._storageModel.getStorageModel(b.data.getType())));return a[c]}};f.forEach(function(b){var c=u.objectStore(b.entitySet.tableName),e=o.getSettingsForItem(b),f=e.keys&&e.keys.map(function(a){return b.physicalData[a]})||null;try{var h=function(h){var i=e.keyPath?b.physicalData[e.keyPath]:
f,j=b.physicalData;c.openCursor(d.IDBKeyRange.only(i)).onsuccess=function(c){try{var d=c.target.result;d?h(d,i,j):Guard.raise(new Exception("Object not found",null,b))}catch(e){u.abort();a.error(e)}}};switch(b.data.entityState){case $data.EntityState.Added:h=function(a,b){var b=$data.typeSystem.createCallbackSetting(b),c=null,f=d.db.transaction([d.sequenceStore],d.IDBTransaction.READ_WRITE).setCallbacks({onerror:b.error,oncomplete:function(){a.physicalData[e.keyPath]=c.lastInsertedId;b.success(a)}}).objectStore(d.sequenceStore);
f.openCursor(d.IDBKeyRange.only(a.entitySet.tableName)).onsuccess=function(b){if(b=b.target.result){c=b.value;var d=c.lastInsertedId;typeof d!=="number"&&Guard.raise(new Exception("Invalid field type! Must be number",null,d));++c.lastInsertedId;b.update(c)}else f.add(c={store:a.entitySet.tableName,lastInsertedId:1})}};if(e.keyPath){var i=function(a){c.add(a.physicalData).onsuccess=function(b){a.data[e.keyPath]=b.target.result}};d.newVersionAPI&&b.physicalData[e.keyPath]===void 0?h(b,{success:i,error:function(a){Guard.raise(new Exception("Can't generate new id",
null,a))}}):i(b)}else c.add(b.physicalData,f);break;case $data.EntityState.Deleted:h(function(a){a["delete"]()});break;case $data.EntityState.Modified:h(function(a,b,c){a.update(c)});break;case $data.EntityState.Unchanged:break;default:Guard.raise(new Exception("Not supported entity state",null,b))}}catch(k){u.abort();a.error(k)}})}}var d=this,e=d.buildIndependentBlocks(b);c()},_compile:function(a){return Container.createIndexedDBCompiler().compile(a)}},{isSupported:{get:function(){return window.indexedDB||
window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB},set:function(){}}});$data.storageProviders.indexedDb.DbCreationType={Default:1,DropStoreIfOlderVersion:2,DropStoreIfExists:3};$data.storageProviders.indexedDb.IndexedDBStorageProvider.isSupported&&$data.StorageProviderBase.registerProvider("indexedDb",$data.storageProviders.indexedDb.IndexedDBStorageProvider);
$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null);
$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=a||{};this.Authenticated=false},Login:function(){},Logout:function(){},CreateRequest:function(a){$data.ajax(a)}},null);
$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(a){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},a)},Login:function(a){if(!this.Authenticated){var b=this;b.configuration.stateCallbacks=a||{};$data.ajax({url:this.configuration.Url_code,data:"type="+b.configuration.type_code+"&client_id="+b.configuration.app_id+"&scope="+b.configuration.scope,
type:"POST",dataType:"json",success:function(a){typeof b.configuration.stateCallbacks.pending=="function"&&b.configuration.stateCallbacks.pending(a);b._processRequestToken(a);b.Authenticated=true},error:function(){typeof b.configuration.stateCallbacks.error=="function"&&b.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=false},CreateRequest:function(a){if(a){if(a.url&&this.Authenticated){var b="?";a.url.indexOf(b)>0&&(b="&");if(this.configuration.access_token)a.url=
a.url+b+"access_token="+this.configuration.access_token}$data.ajax(a)}},_processRequestToken:function(a){var b=this;$data.ajax({url:b.configuration.Url_token,data:"type="+b.configuration.type_token+"&client_id="+b.configuration.app_id+"&code="+a.code,type:"POST",dataType:"json",success:function(a){b.configuration.access_token=a.access_token;typeof b.configuration.stateCallbacks.success=="function"&&b.configuration.stateCallbacks.success(a)},error:function(c){var d=eval("("+c.responseText+")");d.error&&
(d.error.message=="authorization_pending"?setTimeout(function(){b._processRequestToken(a)},2E3):typeof b.configuration.stateCallbacks.abort=="function"&&b.configuration.stateCallbacks.abort(arguments))}})}},null);
$data.Class.define("$data.storageProviders.Facebook.FacebookProvider",$data.StorageProviderBase,null,{constructor:function(a){this.SqlCommands=[];this.context={};this.providerConfiguration=$data.typeSystem.extend({FQLFormat:"format=json",FQLQueryUrl:"https://graph.facebook.com/fql?q="},a);this.initializeStore=function(a){a=$data.typeSystem.createCallbackSetting(a);a.success(this.context)}},AuthenticationProvider:{dataType:"$data.Authentication.AuthenticationBase",enumerable:!1},supportedDataTypes:{value:[$data.Integer,
$data.Number,$data.Date,$data.String,$data.Boolean,$data.Blob,$data.Array],writable:!1},supportedFieldOperations:{value:{contains:{dataType:$data.String,allowedIn:$data.Expressions.FilterExpression,mapTo:"strpos",parameters:[{name:"@expression",dataType:$data.String},{name:"strFragment",dataType:$data.String}],rigthValue:") >= 0"},startsWith:{dataType:$data.String,allowedIn:$data.Expressions.FilterExpression,mapTo:"strpos",parameters:[{name:"@expression",dataType:$data.String},{name:"strFragment",
dataType:$data.String}],rigthValue:") = 0"},strpos:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"strpos",parameters:[{name:"@expression",dataType:$data.String},{name:"strFragment",dataType:$data.String}]},substr:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"substr",parameters:[{name:"@expression",dataType:$data.String},{name:"startIdx",dataType:$data.Number},
{name:"length",dataType:$data.Number}]},strlen:{dataType:$data.String,allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],mapTo:"strlen",parameters:[{name:"@expression",dataType:$data.String}]}},enumerable:!0,writable:!0},supportedBinaryOperators:{value:{equal:{mapTo:" = ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},notEqual:{mapTo:" != ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},equalTyped:{mapTo:" = ",dataType:$data.Boolean,
allowedIn:$data.Expressions.FilterExpression},notEqualTyped:{mapTo:" != ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},greaterThan:{mapTo:" > ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},greaterThanOrEqual:{mapTo:" >= ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},lessThan:{mapTo:" < ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},lessThenOrEqual:{mapTo:" <= ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},
or:{mapTo:" OR ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},and:{mapTo:" AND ",dataType:$data.Booleanv},"in":{mapTo:" IN ",dataType:$data.Boolean,resolvableType:[$data.Array,$data.Queryable],allowedIn:$data.Expressions.FilterExpression}}},supportedUnaryOperators:{value:{}},fieldConverter:{value:{fromDb:{"$data.Number":function(a){return typeof a==="number"?a:parseInt(a)},"$data.Integer":function(a){return typeof a==="number"?a:parseFloat(a)},"$data.String":function(a){return a},
"$data.Date":function(a){return new Date(typeof a==="string"?parseInt(a):a)},"$data.Boolean":function(a){return!!a},"$data.Blob":function(a){return a},"$data.Array":function(a){return a===void 0?new $data.Array:a}},toDb:{"$data.Number":function(a){return a},"$data.Integer":function(a){return a},"$data.String":function(a){return"'"+a+"'"},"$data.Date":function(a){return a?a.valueOf():null},"$data.Boolean":function(a){return a},"$data.Blob":function(a){return a},"$data.Array":function(a){return"("+
a.join(", ")+")"}}}},supportedSetOperations:{value:{filter:{},map:{},forEach:{},toArray:{},single:{},take:{},skip:{},orderBy:{},orderByDescending:{},first:{}},enumerable:!0,writable:!0},executeQuery:function(a,b){b=$data.typeSystem.createCallbackSetting(b);if(!this.AuthenticationProvider)this.AuthenticationProvider=new $data.Authentication.Anonymous({});var c;try{c=this._compile(a)}catch(d){b.error(d);return}var e=a.defaultType,h=[];c.selectMapping||this._discoverType("",e,h);c={url:this.providerConfiguration.FQLQueryUrl+
encodeURIComponent(c.queryText)+"&"+this.providerConfiguration.FQLFormat,dataType:"JSON",success:function(c){a.rawDataList=c.data;Container.createModelBinderConfigCompiler(a,[]).Visit(a.expression);b.success(a)},error:function(a,c,d){c={};try{c=JSON.parse(a.responseText).error}catch(e){c=d+": "+a.responseText}b.error(c)}};this.context.prepareRequest.call(this,c);this.AuthenticationProvider.CreateRequest(c)},_discoverType:function(a,b,c){b.memberDefinitions.getPublicMappedProperties().forEach(function(b){var e=
Container.resolveType(b.dataType);if(e.isAssignableTo||e==Array){var h=a?a+"."+b.name:b.name;if(e==Array||e.isAssignableTo($data.EntitySet))if(b.inverseProperty)e=Container.resolveType(b.elementType);else return;c.push({name:h,type:e});this._discoverType(h,e,c)}},this)},_compile:function(a){return Container.createFacebookCompiler().compile(a)},getTraceString:function(a){if(!this.AuthenticationProvider)this.AuthenticationProvider=new $data.Authentication.Anonymous({});return this._compile(a)},setContext:function(a){this.context=
a},saveChanges:function(){Guard.raise(new Exception("Not implemented","Not implemented"))}},null);$data.StorageProviderBase.registerProvider("Facebook",$data.storageProviders.Facebook.FacebookProvider);
$C("$data.storageProviders.Facebook.FacebookCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.provider={}},compile:function(a){this.provider=a.context.storageProvider;var b={filterSql:{sql:""},projectionSql:{sql:""},orderSql:{sql:""},skipSql:{sql:""},takeSql:{sql:""},tableName:""};this.Visit(a.expression,b);var c=false;if(!b.projectionSql.sql){b.projectionSql=this.autoGenerateProjection(a);c=true}b.filterSql.sql==""&&Guard.raise(new Exception("Filter/where statement is required",
"invalid operation"));return{queryText:b.projectionSql.sql+" FROM "+b.tableName+b.filterSql.sql+b.orderSql.sql+b.takeSql.sql+(b.takeSql.sql?b.skipSql.sql:""),selectMapping:c==false?b.projectionSql.selectFields:null,params:[]}},autoGenerateProjection:function(a){var b=a.context.getEntitySetFromElementType(a.defaultType),b=new $data.Queryable(a.context,b.expression),c=Container.createCodeExpression(this.generateProjectionFunc(a)),c=Container.createProjectionExpression(b.expression,c),b=Container.createQueryable(b,
c).expression,b=Container.createQueryExpressionCreator(a.context).Visit(b),a={projectionSql:{sql:""}};this.Visit(b,a);return a.projectionSql},generateProjectionFunc:function(a){var b=this.provider.AuthenticationProvider.Authenticated,a=a.defaultType.memberDefinitions.getPublicMappedProperties();!b&&a.some(function(a){return a.isPublic==true})&&(a=a.filter(function(a){return a.isPublic==true}));var c="function (s){ return {";a.forEach(function(a,b){b!=0&&(c=c+", ");c=c+(a.name+": s."+a.name)});return c=
c+"};"},VisitFilterExpression:function(a,b){this.Visit(a.source,b);b.filterSql.type=a.nodeType;b.filterSql.sql=b.filterSql.sql==""?" WHERE ":b.filterSql.sql+" AND ";this.Visit(a.selector,b.filterSql)},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);b.projectionSql.type=a.nodeType;b.projectionSql.sql==""?b.projectionSql.sql="SELECT ":Guard.raise(new Exception("Multiple select error"));this.Visit(a.selector,b.projectionSql)},VisitOrderExpression:function(a,b){this.Visit(a.source,b);b.orderSql.type=
a.nodeType;b.orderSql.sql==""?b.orderSql.sql=" ORDER BY ":Guard.raise(new Exception("Multiple sorting not supported","not supported"));this.Visit(a.selector,b.orderSql);b.orderSql.sql=b.orderSql.sql+(a.nodeType==ExpressionType.OrderByDescending?" DESC":" ASC")},VisitPagingExpression:function(a,b){this.Visit(a.source,b);if(a.nodeType==ExpressionType.Skip){b.skipSql.type=a.nodeType;b.skipSql.sql=" OFFSET ";this.Visit(a.amount,b.skipSql)}else if(a.nodeType==ExpressionType.Take){b.takeSql.type=a.nodeType;
b.takeSql.sql=" LIMIT ";this.Visit(a.amount,b.takeSql)}},VisitSimpleBinaryExpression:function(a,b){b.sql=b.sql+"(";this.Visit(a.left,b);b.sql=b.sql+a.resolution.mapTo;a.resolution.resolvableType&&!Guard.requireType(a.resolution.mapTo+" expression.right.value",a.right.value,a.resolution.resolvableType)&&Guard.raise(new Exception(a.right.type+" not allowed in '"+a.resolution.mapTo+"' statement","invalid operation"));this.Visit(a.right,b);b.sql=b.sql+")"},VisitEntityFieldExpression:function(a,b){this.Visit(a.selector,
b)},VisitMemberInfoExpression:function(a,b){var c=a.memberName;b.sql=b.sql+c;b.fieldData={name:c,dataType:a.memberDefinition.dataType};if(b.type=="Projection"&&!b.selectFields)b.selectFields=b.fieldOperation===true?[{from:"anon"}]:[{from:c,dataType:a.memberDefinition.dataType}]},VisitConstantExpression:function(a,b){b.type=="Projection"&&Guard.raise(new Exception("Constant value is not supported in Projection.","Not supported!"));this.VisitQueryParameterExpression(a,b)},VisitQueryParameterExpression:function(a,
b){var c=Container.resolveType(Container.getTypeName(a.value));if(this.provider.supportedDataTypes.indexOf(c)!=-1)b.sql=b.sql+this.provider.fieldConverter.toDb[Container.resolveName(c)](a.value);else switch(c){case $data.Queryable:b.sql=b.sql+("("+a.value.toTraceString().queryText+")");break;default:b.sql=b.sql+(""+a.value+"")}},VisitParametricQueryExpression:function(a,b){this.Visit(a.expression,b);b.parameters=a.parameters},VisitEntitySetExpression:function(a,b){b.tableName=a.instance.tableName},
VisitObjectLiteralExpression:function(a,b){var c=this;b.selectFields=b.selectFields||[];a.members.forEach(function(a){if(a.expression instanceof $data.Expressions.ObjectLiteralExpression){b.mappingPrefix=b.mappingPrefix||[];b.mappingPrefix.push(a.fieldName);c.Visit(a,b);b.mappingPrefix.pop()}else{if(b.selectFields.length>0)b.sql=b.sql+", ";c.Visit(a,b);a=b.mappingPrefix instanceof Array?b.mappingPrefix.join(".")+"."+a.fieldName:a.fieldName;b.selectFields.push({from:b.fieldData.name,to:a,dataType:b.fieldData.dataType})}})},
VisitObjectFieldExpression:function(a,b){return this.Visit(a.expression,b)},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition,d=c.mapTo||c.name;b.sql=b.sql+"(";c.expressionInParameter==false&&this.Visit(a.source,b);b.sql=b.sql+d;b.sql=b.sql+"(";var e=0;(c.parameters||[]).map(function(b){var c={dataType:b.dataType};if(b.value)c.value=b.value;else if(b.name==="@expression")c.value=
a.source;else{c.value=a.parameters[e];c.itemType=a.parameters[e++].type}return c}).forEach(function(c,d){var e=c.itemType?Container.resolveType(c.itemType):null;if(!e||c.dataType instanceof Array&&c.dataType.indexOf(e)!=-1||c.dataType==e){if(d>0)b.sql=b.sql+", ";if(b.type=="Projection")b.fieldOperation=true;this.Visit(c.value,b);if(b.type=="Projection")b.fieldOperation=void 0}else Guard.raise(new Exception(parameter.type+" not allowed in '"+a.operation.memberName+"' statement","invalid operation"))},
this);if(b.fieldData&&b.fieldData.name)b.fieldData.name="anon";b.sql=c.rigthValue?b.sql+c.rigthValue:b.sql+")";b.sql=b.sql+")"}},null);
$data.Class.define("$data.Facebook.types.FbUser",$data.Entity,null,{uid:{type:"int",key:!0,isPublic:!0,searchable:!0},username:{type:"string",isPublic:!0,searchable:!0},first_name:{type:"string",isPublic:!0},middle_name:{type:"string",isPublic:!0},last_name:{type:"string",isPublic:!0},name:{type:"string",isPublic:!0,searchable:!0},pic_small:{type:"string"},pic_big:{type:"string"},pic_square:{type:"string"},pic:{type:"string"},affiliations:{type:"Array",elementType:"Object"},profile_update_time:{type:"datetime"},
timezone:{type:"int"},religion:{type:"string"},birthday:{type:"string"},birthday_date:{type:"string"},sex:{type:"string",isPublic:!0},hometown_location:{type:"Array",elementType:"Object"},meeting_sex:{type:"Array",elementType:"Object"},meeting_for:{type:"Array",elementType:"Object"},relationship_status:{type:"string"},significant_other_id:{type:"int"},political:{type:"string"},current_location:{type:"Array",elementType:"Object"},activities:{type:"string"},interests:{type:"string"},is_app_user:{type:"bool"},
music:{type:"string"},tv:{type:"string"},movies:{type:"string"},books:{type:"string"},quotes:{type:"string"},about_me:{type:"string"},hs_info:{type:"Array",elementType:"Object"},education_history:{type:"Array",elementType:"Object"},work_history:{type:"Array",elementType:"Object"},notes_count:{type:"int"},wall_count:{type:"int"},status:{type:"string"},has_added_app:{type:"bool"},online_presence:{type:"string"},locale:{type:"string",isPublic:!0},proxied_email:{type:"string"},profile_url:{type:"string"},
email_hashes:{type:"Array",elementType:"Object"},pic_small_with_logo:{type:"string",isPublic:!0},pic_big_with_logo:{type:"string",isPublic:!0},pic_square_with_logo:{type:"string",isPublic:!0},pic_with_logo:{type:"string",isPublic:!0},allowed_restrictions:{type:"string"},verified:{type:"bool"},profile_blurb:{type:"string"},family:{type:"Array",elementType:"Object"},website:{type:"string"},is_blocked:{type:"bool"},contact_email:{type:"string"},email:{type:"string"},third_party_id:{type:"string",searchable:!0},
name_format:{type:"string"},video_upload_limits:{type:"Array",elementType:"Object"},games:{type:"string"},work:{type:"Array",elementType:"Object"},education:{type:"Array",elementType:"Object"},sports:{type:"Array",elementType:"Object"},favorite_athletes:{type:"Array",elementType:"Object"},favorite_teams:{type:"Array",elementType:"Object"},inspirational_people:{type:"Array",elementType:"Object"},languages:{type:"Array",elementType:"Object"},likes_count:{type:"int"},friend_count:{type:"int"},mutual_friend_count:{type:"int"},
can_post:{type:"bool"}},null);$data.Class.define("$data.Facebook.types.FbFriend",$data.Entity,null,{uid1:{type:"int",key:!0,searchable:!0},uid2:{type:"int",key:!0,searchable:!0}},null);
$data.Class.define("$data.Facebook.types.FbPage",$data.Entity,null,{page_id:{type:"int",key:!0,isPublic:!0,searchable:!0},name:{type:"string",isPublic:!0,searchable:!0},username:{type:"string",isPublic:!0,searchable:!0},description:{type:"string",isPublic:!0},categories:{type:"string",isPublic:!0},is_community_page:{type:"bool",isPublic:!0},pic_small:{type:"string",isPublic:!0},pic_big:{type:"string",isPublic:!0},pic_square:{type:"string",isPublic:!0},pic:{type:"string",isPublic:!0},pic_large:{type:"string",
isPublic:!0},pic_cover:{type:"string",isPublic:!0},unread_notif_count:{type:"int",isPublic:!1},new_like_count:{type:"int",isPublic:!1},fan_count:{type:"int",isPublic:!0},type:{type:"string",isPublic:!0},website:{type:"string",isPublic:!0},has_added_app:{type:"bool",isPublic:!0},general_info:{type:"string",isPublic:!0},can_post:{type:"bool",isPublic:!0},checkins:{type:"int",isPublic:!0},is_published:{type:"bool",isPublic:!0},founded:{type:"string",isPublic:!0},company_overview:{type:"string",isPublic:!0},
mission:{type:"string",isPublic:!0},products:{type:"string",isPublic:!0},location:{type:"string",isPublic:!0},parking:{type:"string",isPublic:!0},hours:{type:"string",isPublic:!0},pharma_safety_info:{type:"string",isPublic:!0},public_transit:{type:"string",isPublic:!0},attire:{type:"string",isPublic:!0},payment_options:{type:"string",isPublic:!0},culinary_team:{type:"string",isPublic:!0},general_manager:{type:"string",isPublic:!0},price_range:{type:"string",isPublic:!0},restaurant_services:{type:"string",
isPublic:!0},restaurant_specialties:{type:"string",isPublic:!0},phone:{type:"string",isPublic:!0},release_date:{type:"string",isPublic:!0},genre:{type:"string",isPublic:!0},starring:{type:"string",isPublic:!0},screenplay_by:{type:"string",isPublic:!0},directed_by:{type:"string",isPublic:!0},produced_by:{type:"string",isPublic:!0},studio:{type:"string",isPublic:!0},awards:{type:"string",isPublic:!0},plot_outline:{type:"string",isPublic:!0},season:{type:"string",isPublic:!0},network:{type:"string",
isPublic:!0},schedule:{type:"string",isPublic:!0},written_by:{type:"string",isPublic:!0},band_members:{type:"string",isPublic:!0},hometown:{type:"string",isPublic:!0},current_location:{type:"string",isPublic:!0},record_label:{type:"string",isPublic:!0},booking_agent:{type:"string",isPublic:!0},press_contact:{type:"string",isPublic:!0},artists_we_like:{type:"string",isPublic:!0},influences:{type:"string",isPublic:!0},band_interests:{type:"string",isPublic:!0},bio:{type:"string",isPublic:!0},affiliation:{type:"string",
isPublic:!0},birthday:{type:"string",isPublic:!0},personal_info:{type:"string",isPublic:!0},personal_interests:{type:"string",isPublic:!0},built:{type:"string",isPublic:!0},features:{type:"string",isPublic:!0},mpg:{type:"string",isPublic:!0}},null);$data.Class.define("$data.storageProviders.Facebook.EntitySets.Command",null,null,{constructor:function(a){this.Config=$data.typeSystem.extend({CommandValue:""},a)},toString:function(){return this.Config.CommandValue},Config:{}},null);
$data.Class.define("$data.Facebook.FQLContext",$data.EntityContext,null,{constructor:function(){var a=this.Friends.where(function(a){return a.uid1==this.me},{me:$data.Facebook.FQLCommands.me}).select(function(a){return a.uid2});this.MyFriends=this.Users.where(function(a){return a.uid==this.me||a.uid in this.friends},{me:$data.Facebook.FQLCommands.me,friends:a})},Users:{dataType:$data.EntitySet,tableName:"user",elementType:$data.Facebook.types.FbUser},Friends:{dataType:$data.EntitySet,tableName:"friend",
elementType:$data.Facebook.types.FbFriend},Pages:{dataType:$data.EntitySet,tableName:"page",elementType:$data.Facebook.types.FbPage}},null);$data.Facebook.FQLCommands={__namespace:!0,me:new $data.storageProviders.Facebook.EntitySets.Command({CommandValue:"me()"}),now:new $data.storageProviders.Facebook.EntitySets.Command({CommandValue:"now()"})};
$data.Class.define("$data.storageProviders.YQL.YQLProvider",$data.StorageProviderBase,null,{constructor:function(a){this.SqlCommands=[];this.context={};this.extendedCreateNew=[];this.providerConfiguration=$data.typeSystem.extend({YQLFormat:"format=json",YQLQueryUrl:"http://query.yahooapis.com/v1/public/yql?q=",YQLEnv:"",resultPath:["query","results"],resultSkipFirstLevel:true},a);this.initializeStore=function(a){a=$data.typeSystem.createCallbackSetting(a);a.success(this.context)}},AuthenticationProvider:{dataType:"$data.Authentication.AuthenticationBase",
enumerable:!1},supportedDataTypes:{value:[$data.Integer,$data.Number,$data.Date,$data.String,$data.Boolean,$data.Blob,$data.Array],writable:!1},supportedFieldOperations:{value:{contains:{dataType:$data.String,allowedIn:$data.Expressions.FilterExpression,mapTo:" LIKE ",expressionInParameter:!1,parameters:[{name:"inStatement",dataType:$data.String,prefix:"%",suffix:"%"}]},startsWith:{dataType:$data.String,allowedIn:$data.Expressions.FilterExpression,mapTo:" LIKE ",expressionInParameter:!1,parameters:[{name:"inStatement",
dataType:$data.String,suffix:"%"}]},endsWith:{dataType:$data.String,allowedIn:$data.Expressions.FilterExpression,mapTo:" LIKE ",expressionInParameter:!1,parameters:[{name:"inStatement",dataType:$data.String,prefix:"%"}]}},enumerable:!0,writable:!0},supportedBinaryOperators:{value:{equal:{mapTo:" = ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},notEqual:{mapTo:" != ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},equalTyped:{mapTo:" = ",dataType:$data.Boolean,
allowedIn:$data.Expressions.FilterExpression},notEqualTyped:{mapTo:" != ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},greaterThan:{mapTo:" > ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},greaterThanOrEqual:{mapTo:" >= ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},lessThan:{mapTo:" < ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},lessThenOrEqual:{mapTo:" <= ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},
or:{mapTo:" OR ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},and:{mapTo:" AND ",dataType:$data.Boolean,allowedIn:$data.Expressions.FilterExpression},"in":{mapTo:" IN ",dataType:$data.Boolean,resolvableType:[$data.Array,$data.Queryable],allowedIn:$data.Expressions.FilterExpression}}},supportedUnaryOperators:{value:{}},supportedSetOperations:{value:{filter:{},map:{},forEach:{},toArray:{},single:{},take:{},skip:{},orderBy:{},orderByDescending:{},first:{}},enumerable:!0,writable:!0},
fieldConverter:{value:{fromDb:{"$data.Number":function(a){return typeof a==="number"?a:parseInt(a)},"$data.Integer":function(a){return typeof a==="number"?a:parseFloat(a)},"$data.String":function(a){return a},"$data.Date":function(a){return new Date(typeof a==="string"?parseInt(a):a)},"$data.Boolean":function(a){return!!a},"$data.Blob":function(a){return a},"$data.Array":function(a){return a===void 0?new $data.Array:a}},toDb:{"$data.Number":function(a){return a},"$data.Integer":function(a){return a},
"$data.String":function(a){return"'"+a+"'"},"$data.Date":function(a){return a?a.valueOf():null},"$data.Boolean":function(a){return a},"$data.Blob":function(a){return a},"$data.Array":function(a){return"("+a.join(", ")+")"}}}},executeQuery:function(a,b){var c=this,b=$data.typeSystem.createCallbackSetting(b),d=a.defaultType,e=a.context.getType().memberDefinitions.asArray().filter(function(a){return a.elementType==d})[0]||{};if(!this.AuthenticationProvider)this.AuthenticationProvider=new $data.Authentication.Anonymous({});
var h;try{h=this._compile(a)}catch(f){b.error(f);return}h={url:this.providerConfiguration.YQLQueryUrl+encodeURIComponent(h.queryText)+"&"+this.providerConfiguration.YQLFormat+(this.providerConfiguration.YQLEnv?"&env="+this.providerConfiguration.YQLEnv:""),dataType:"JSON",success:function(d){d=c._preProcessData(d,e);if(d!=false){a.rawDataList=d;e.anonymousResult?a.rawDataList=d:Container.createModelBinderConfigCompiler(a,[]).Visit(a.expression)}b.success(a)},error:function(a,c,d){c={};try{c=JSON.parse(a.responseText).error}catch(e){c=
d+": "+a.responseText}b.error(c)}};this.context.prepareRequest.call(this,h);this.AuthenticationProvider.CreateRequest(h)},_preProcessData:function(a,b){for(var c=a,d=b.resultPath!=void 0?b.resultPath:this.providerConfiguration.resultPath,e=0;e<d.length;e++)if(c[d[e]])c=c[d[e]];else return false;if((b.resultSkipFirstLevel!=void 0?b.resultSkipFirstLevel:this.providerConfiguration.resultSkipFirstLevel)==true){d=Object.keys(c);if(d.length==1&&(c[d[0]]instanceof Array||!b.anonymousResult))c=c[d[0]]}return c.length?
c:[c]},_compile:function(a){return Container.createYQLCompiler().compile(a)},getTraceString:function(a){if(!this.AuthenticationProvider)this.AuthenticationProvider=new $data.Authentication.Anonymous({});return this._compile(a)},setContext:function(a){this.context=a},saveChanges:function(){Guard.raise(new Exception("Not Implemented","Not Implemented"))}},null);$data.StorageProviderBase.registerProvider("YQL",$data.storageProviders.YQL.YQLProvider);
$C("$data.storageProviders.YQL.YQLCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.provider={};this.cTypeCache={}},compile:function(a){this.provider=a.context.storageProvider;var b={filterSql:{sql:""},projectionSql:{sql:""},orderSql:{sql:""},skipSql:{sql:""},takeSql:{sql:""},tableName:""};this.Visit(a.expression,b);if(b.projectionSql.sql=="")b.projectionSql.sql="SELECT *";if(b.orderSql.sql)b.orderSql.sql=" | sort("+b.orderSql.sql+")";if(b.skipSql.value&&b.takeSql.value){a=
b.skipSql.value;b.skipSql.value=b.takeSql.value;b.takeSql.value=b.takeSql.value+a}if(b.skipSql.value)b.skipSql.sql=b.skipSql.sqlPre+b.skipSql.value+b.skipSql.sqlSuf;if(b.takeSql.value)b.takeSql.sql=b.takeSql.sqlPre+b.takeSql.value+b.takeSql.sqlSuf;return{queryText:b.projectionSql.sql+" FROM "+b.tableName+b.filterSql.sql+b.orderSql.sql+b.takeSql.sql+(b.takeSql.sql?b.skipSql.sql:""),selectMapping:b.projectionSql.selectFields,params:[]}},VisitFilterExpression:function(a,b){this.Visit(a.source,b);b.filterSql.type=
a.nodeType;b.filterSql.sql=b.filterSql.sql==""?" WHERE ":b.filterSql.sql+" AND ";this.Visit(a.selector,b.filterSql)},VisitProjectionExpression:function(a,b){this.Visit(a.source,b);b.projectionSql.type=a.nodeType;b.projectionSql.sql==""?b.projectionSql.sql="SELECT ":Guard.raise(new Exception("multiple select error"));this.Visit(a.selector,b.projectionSql)},VisitOrderExpression:function(a,b){this.Visit(a.source,b);b.orderSql.type=a.nodeType;var c={sql:""};this.Visit(a.selector,c);b.orderSql.sql="field='"+
c.sql+"', descending='"+(a.nodeType==ExpressionType.OrderByDescending)+"'"+(b.orderSql.sql!=""?", "+b.orderSql.sql:"")},VisitPagingExpression:function(a,b){this.Visit(a.source,b);if(a.nodeType==ExpressionType.Skip){b.skipSql.type=a.nodeType;b.skipSql.sqlPre=" | tail(count=";this.Visit(a.amount,b.skipSql);b.skipSql.sqlSuf=")"}else if(a.nodeType==ExpressionType.Take){b.takeSql.type=a.nodeType;b.takeSql.sqlPre=" | truncate(count=";this.Visit(a.amount,b.takeSql);b.takeSql.sqlSuf=")"}},VisitSimpleBinaryExpression:function(a,
b){b.sql=b.sql+"(";this.Visit(a.left,b);b.sql=b.sql+a.resolution.mapTo;a.resolution.resolvableType&&!Guard.requireType(a.resolution.mapTo+" expression.right.value",a.right.value,a.resolution.resolvableType)&&Guard.raise(new Exception(a.right.type+" not allowed in '"+a.resolution.mapTo+"' statement","invalid operation"));this.Visit(a.right,b);b.sql=b.sql+")"},VisitEntityFieldExpression:function(a,b){this.Visit(a.source,b);this.Visit(a.selector,b)},VisitMemberInfoExpression:function(a,b){var c;if(b.wasComplex===
true)b.sql=b.sql+".";b.sql=b.sql+a.memberName;if(b.isComplex==true){b.complex=b.complex+a.memberName;b.wasComplex=true}else{b.wasComplex=false;c=b.complex?b.complex+a.memberName:a.memberName;b.complex=null;b.fieldData={name:c,dataType:a.memberDefinition.dataType};if(b.type=="Projection"&&!b.selectFields)b.selectFields=[{from:c,dataType:a.memberDefinition.dataType}]}},VisitConstantExpression:function(a,b){b.type=="Projection"&&Guard.raise(new Exception("Constant value is not supported in Projection.",
"Not supported!"));this.VisitQueryParameterExpression(a,b)},VisitQueryParameterExpression:function(a,b){b.value=a.value;var c=Container.resolveType(Container.getTypeName(a.value));if(this.provider.supportedDataTypes.indexOf(c)!=-1)b.sql=b.sql+this.provider.fieldConverter.toDb[Container.resolveName(c)](a.value);else switch(c){case $data.Queryable:b.sql=b.sql+("("+a.value.toTraceString().queryText+")");break;default:b.sql=b.sql+(""+a.value+"")}},VisitParametricQueryExpression:function(a,b){if(b.type==
"Projection"){this.Visit(a.expression,b);if(a.expression instanceof $data.Expressions.ComplexTypeExpression){b.selectFields=b.selectFields||[];var c=a.expression.entityType,d=this._getComplexTypeIncludes(c);b.selectFields.push({from:b.complex,type:c,includes:d})}}else{this.Visit(a.expression,b);b.parameters=a.parameters}},VisitEntitySetExpression:function(a,b){if(b.type){if(!b.complex)b.complex=""}else b.tableName=a.instance.tableName},VisitObjectLiteralExpression:function(a,b){var c=this;b.selectFields=
b.selectFields||[];a.members.forEach(function(a){if(a.expression instanceof $data.Expressions.ObjectLiteralExpression){b.mappingPrefix=b.mappingPrefix||[];b.mappingPrefix.push(a.fieldName);c.Visit(a,b);b.mappingPrefix.pop()}else{if(b.selectFields.length>0)b.sql=b.sql+", ";c.Visit(a,b);a={from:b.fieldData.name,to:b.mappingPrefix instanceof Array?b.mappingPrefix.join(".")+"."+a.fieldName:a.fieldName};if(b.selectType){a.type=b.selectType;var e=this._getComplexTypeIncludes(b.selectType);a.includes=e}else a.dataType=
b.fieldData.dataType;b.selectFields.push(a);delete b.fieldData;delete b.selectType}},this)},VisitObjectFieldExpression:function(a,b){this.Visit(a.expression,b);if(a.expression instanceof $data.Expressions.ComplexTypeExpression){b.fieldData=b.fieldData||{};b.fieldData.name=b.complex;b.selectType=a.expression.entityType}},VisitEntityFieldOperationExpression:function(a,b){Guard.requireType("expression.operation",a.operation,$data.Expressions.MemberInfoExpression);var c=a.operation.memberDefinition,d=
c.mapTo||c.name;b.sql=b.sql+"(";c.expressionInParameter==false&&this.Visit(a.source,b);b.sql=b.sql+d;var e=0;(c.parameters||[]).map(function(b){var c={dataType:b.dataType,prefix:b.prefix,suffix:b.suffix};if(b.value)c.value=b.value;else if(b.name==="@expression")c.value=a.source;else{c.value=a.parameters[e];c.itemType=a.parameters[e++].type}return c}).forEach(function(c,e){var k=c.itemType?Container.resolveType(c.itemType):null;if(!k||c.dataType instanceof Array&&c.dataType.indexOf(k)!=-1||c.dataType==
k){if(e>0)b.sql=b.sql+", ";k={sql:""};this.Visit(c.value,k);if(d==" LIKE "){var i=Container.getTypeName(k.value);b.sql=b.sql+(i=="string"?"'":"");b.sql=b.sql+((c.prefix?c.prefix:"")+k.value+(c.suffix?c.suffix:""));b.sql=b.sql+(i=="string"?"'":"")}else b.sql=b.sql+k.sql}else Guard.raise(new Exception(parameter.type+" not allowed in '"+a.operation.memberName+"' statement","invalid operation"))},this);b.sql=c.rigthValue?b.sql+c.rigthValue:b.sql+"";b.sql=b.sql+")"},VisitComplexTypeExpression:function(a,
b){this.Visit(a.source,b);b.isComplex=true;this.Visit(a.selector,b);b.isComplex=false;if(b.complex!="")b.complex=b.complex+"."},VisitEntityExpression:function(a,b){this.Visit(a.source,b)},_findComplexType:function(a,b,c){a.memberDefinitions.getPublicMappedProperties().forEach(function(a){var e=Container.resolveType(a.dataType);if(e.isAssignableTo&&!e.isAssignableTo($data.EntitySet)){a=c?c+"."+a.name:a.name;b.push({name:a,type:e});this._findComplexType(e,b,a)}},this)},_getComplexTypeIncludes:function(a){if(!this.cTypeCache[a.name]){var b=
[];this._findComplexType(a,b);this.cTypeCache[a.name]=b}return this.cTypeCache[a.name]}},null);$data.Class.define("$data.Yahoo.types.Geo.placeTypeNameCf",$data.Entity,null,{code:{type:"string"},content:{type:"string"}},null);$data.Class.define("$data.Yahoo.types.Geo.countryCf",$data.Entity,null,{code:{type:"string"},type:{type:"string"},content:{type:"string"}},null);
$data.Class.define("$data.Yahoo.types.Geo.adminCf",$data.Entity,null,{code:{type:"string"},type:{type:"string"},content:{type:"string"}},null);$data.Class.define("$data.Yahoo.types.Geo.localityCf",$data.Entity,null,{code:{type:"string"},content:{type:"string"}},null);$data.Class.define("$data.Yahoo.types.Geo.centroidCf",$data.Entity,null,{latitude:{type:"string"},longitude:{type:"string"}},null);
$data.Class.define("$data.Yahoo.types.Geo.postalCf",$data.Entity,null,{type:{type:"string"},content:{type:"string"}},null);$data.Class.define("$data.Yahoo.types.Geo.boundingBoxCf",$data.Entity,null,{southWest:{type:"centroidRef"},northEast:{type:"centroidRef"}},null);$data.Class.define("$data.Yahoo.types.Geo.PlaceMeta",null,null,{woeid:{type:"int",key:!0},name:{type:"string"},uri:{type:"string"},placeTypeName:{type:"placeTypeNameRef"},lang:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.PlaceMetaFull",[{type:null},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{country:{type:"countryRef"},admin1:{type:"adminRef"},admin2:{type:"adminRef"},admin3:{type:"adminRef"},locality1:{type:"localityRef"},locality2:{type:"localityRef"},postal:{type:"postalRef"},centroid:{type:"centroidRef"},boundingBox:{type:"boundingBoxRef"},areaRank:{type:"int"},popRank:{type:"int"}},null);
$data.Class.define("$data.Yahoo.types.Geo.placetype",$data.Entity,null,{woeid:{type:"int",key:!0},placeTypeDescription:{type:"string"},uri:{type:"string"},placeTypeName:{type:"placeTypeNameRef"},lang:{type:"string"},placetype:{type:"string"},placetypeid:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.sibling",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{sibling_woeid:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.parent",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{child_woeid:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.neighbor",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{neighbor_woeid:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.common",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{woeid1:{type:"string"},woeid2:{type:"string"},woeid3:{type:"string"},woeid4:{type:"string"},woeid5:{type:"string"},woeid6:{type:"string"},woeid7:{type:"string"},woeid8:{type:"string"},"long":{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.children",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{parent_woeid:{type:"string"},placetype:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.belongto",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{member_woeid:{type:"string"},placetype:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.ancestor",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{descendant_woeid:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.place",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMetaFull}],null,{text:{type:"string"},focus:{type:"string"},placetype:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.county",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.country",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.district",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.sea",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.state",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.continent",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"},view:{type:"string"}},null);
$data.Class.defineEx("$data.Yahoo.types.Geo.ocean",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{place:{type:"string"},view:{type:"string"}},null);$data.Class.defineEx("$data.Yahoo.types.Geo.descendant",[{type:$data.Entity},{type:$data.Yahoo.types.Geo.PlaceMeta}],null,{ancestor_woeid:{type:"string"},placetype:{type:"string"},degree:{type:"string"},view:{type:"string"}},null);Container.registerType("placeTypeNameRef",$data.Yahoo.types.Geo.placeTypeNameCf);
Container.registerType("centroidRef",$data.Yahoo.types.Geo.centroidCf);Container.registerType("countryRef",$data.Yahoo.types.Geo.countryCf);Container.registerType("adminRef",$data.Yahoo.types.Geo.adminCf);Container.registerType("localityRef",$data.Yahoo.types.Geo.localityCf);Container.registerType("postalRef",$data.Yahoo.types.Geo.postalCf);Container.registerType("boundingBoxRef",$data.Yahoo.types.Geo.boundingBoxCf);
$data.Class.define("$data.Yahoo.YQLContext",$data.EntityContext,null,{Continents:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.continent,tableName:"geo.continents"},Counties:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.county,tableName:"geo.counties"},Countries:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.country,tableName:"geo.countries"},Districts:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.district,tableName:"geo.districts"},Oceans:{type:$data.EntitySet,
elementType:$data.Yahoo.types.Geo.ocean,tableName:"geo.oceans"},Places:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.place,tableName:"geo.places"},PlaceTypes:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.placetype,tableName:"geo.placetypes"},PlaceSiblings:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.sibling,tableName:"geo.places.siblings"},PlaceParents:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.parent,tableName:"geo.places.parent"},PlaceNeighbors:{type:$data.EntitySet,
elementType:$data.Yahoo.types.Geo.neighbor,tableName:"geo.places.neighbors"},PlaceCommons:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.common,tableName:"geo.places.common"},PlaceChildrens:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.children,tableName:"geo.places.children"},PlaceBelongtos:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.belongto,tableName:"geo.places.belongtos"},PlaceAncestors:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.ancestor,tableName:"geo.places.ancestors"},
Seas:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.sea,tableName:"geo.seas"},States:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.state,tableName:"geo.states"},PlaceDescendants:{type:$data.EntitySet,elementType:$data.Yahoo.types.Geo.descendant,tableName:"geo.places.descendants"},placeTypeNameRef:{value:$data.Yahoo.types.Geo.placeTypeNameCf},centroidRef:{value:$data.Yahoo.types.Geo.centroidCf},countryRef:{value:$data.Yahoo.types.Geo.countryCf},adminRef:{value:$data.Yahoo.types.Geo.adminCf},
localityRef:{value:$data.Yahoo.types.Geo.localityCf},postalRef:{value:$data.Yahoo.types.Geo.postalCf},boundingBoxRef:{value:$data.Yahoo.types.Geo.boundingBoxCf},Atom:{anonymousResult:!0,tableName:"atom",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLAtom",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0}},null)},Csv:{anonymousResult:!0,tableName:"csv",resultPath:["query","results"],resultSkipFirstLevel:!0,
type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLCsv",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},charset:{type:"string",searchable:!0},columns:{type:"string",searchable:!0}},null)},DataUri:{anonymousResult:!0,tableName:"data.uri",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLDataUri",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0}},null)},Feed:{anonymousResult:!0,
tableName:"feed",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLFeed",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0}},null)},FeedNormalizer:{anonymousResult:!0,tableName:"feednormalizer",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLFeedNormalizer",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},output:{type:"string",
searchable:!0},prexslurl:{type:"string",searchable:!0},postxslurl:{type:"string",searchable:!0},timeout:{type:"string",searchable:!0}},null)},Html:{anonymousResult:!0,tableName:"html",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLHtml",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},charset:{type:"string",searchable:!0},browser:{type:"bool",searchable:!0},xpath:{type:"string",searchable:!0},compat:{type:"string",
searchable:!0,description:"valid values for compat is 'html5' and 'html4'"},Result:{type:"string",searchable:!0}},null)},Json:{anonymousResult:!0,tableName:"json",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLJson",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},itemPath:{type:"string",searchable:!0}},null)},Rss:{anonymousResult:!1,tableName:"rss",resultPath:["query","results"],resultSkipFirstLevel:!0,
type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLRss",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},guid:{type:"GuidField"},title:{type:"string"},description:{type:"string"},link:{type:"string"},pubDate:{type:"string"}},null)},GuidField:{type:$data.Class.define("GuidField",$data.Entity,null,{isPermaLink:{type:"string"},content:{type:"string"}},null)},Xml:{anonymousResult:!0,tableName:"xml",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,
elementType:$data.Class.define("$data.Yahoo.types.YQLXml",$data.Entity,null,{url:{type:"string",required:!0,searchable:!0},itemPath:{type:"string",searchable:!0}},null)},Xslt:{anonymousResult:!0,tableName:"xslt",resultPath:["query","results"],resultSkipFirstLevel:!0,type:$data.EntitySet,elementType:$data.Class.define("$data.Yahoo.types.YQLXslt",$data.Entity,null,{url:{type:"string",searchable:!0},xml:{type:"string",searchable:!0},stylesheet:{type:"string",searchable:!0},stylesheetliteral:{type:"string",
searchable:!0},wrapperelement:{type:"string",searchable:!0}},null)}},null);
