// JayData 1.1.1
// Dual licensed under MIT and GPL v2
// Copyright JayStack Technologies (http://jaydata.org/licensing)
//
// JayData is a standards-based, cross-platform Javascript library and a set of
// practices to access and manipulate data from various online and offline sources.
//
// Credits:
//     Hajnalka Battancs, Dániel József, János Roden, László Horváth, Péter Nochta
//     Péter Zentai, Róbert Bónay, Szabolcs Czinege, Viktor Borza, Viktor Lázár,
//     Zoltán Gyebrovszki
//
// More info: http://jaydata.org
(function(b,d){b.datajs||(b.datajs={});b.OData||(b.OData={});var f=b.datajs,k=b.OData,m=function(a){return a!==null&&a!==d},q=function(a,c){var e,o;e=0;for(o=a.length;e<o;e++)if(a[e]===c)return true;return false},p=function(a){if(arguments.length===1)b.setTimeout(a,0);else{var c=Array.prototype.slice.call(arguments,1);b.setTimeout(function(){a.apply(this,c)},0)}},t=function(a,c){if(!a)return null;if(I(a)){var e,o,d;e=0;for(o=a.length;e<o;e++)if(d=t(a[e],c))return d;return null}return a.dataServices?
t(a.dataServices.schema,c):c(a)},D=function(a){return a.__edmType==="Edm.DateTimeOffset"||!a.__edmType&&a.__offset},v=function(a,c){a=a===0?"":"."+r(a.toString(),3);if(c>0){a===""&&(a=".000");a=a+r(c.toString(),4)}return a},M=function(a){if(typeof a==="string")return a;var c=D(a),e=Ba(a.__offset);if(c&&e!=="Z"){var a=new Date(a.valueOf()),o=Ca(e),c=a.getUTCHours()+o.d*o.h,o=a.getMinutes()+o.d*o.m;a.setUTCHours(c,o)}else c||(e="");var c=a.getUTCFullYear(),o=a.getUTCMonth()+1,d="";if(c<=0){c=-(c-1);
d="-"}var b=v(a.getUTCMilliseconds(),a.__ns);return d+r(c,4)+"-"+r(o,2)+"-"+r(a.getUTCDate(),2)+"T"+r(a.getUTCHours(),2)+":"+r(a.getUTCMinutes(),2)+":"+r(a.getUTCSeconds(),2)+b+e},ea=function(a){var c=a.ms,e="";if(c<0){e="-";c=-c}var o=Math.floor(c/864E5),c=c-864E5*o,d=Math.floor(c/36E5),c=c-36E5*d,b=Math.floor(c/6E4),c=c-6E4*b,h=Math.floor(c/1E3),c=c-h*1E3;return e+"P"+r(o,2)+"DT"+r(d,2)+"H"+r(b,2)+"M"+r(h,2)+v(c,a.ns)+"S"},r=function(a,c,e){for(a=a.toString(10);a.length<c;)a=e?a+"0":"0"+a;return a},
Ba=function(a){return!a||a==="Z"||a==="+00:00"||a==="-00:00"?"Z":a},zb=function(a,c,e,o,j,b){return j.request(a,function(j){try{j.headers&&na(j.headers);j.data===d&&o.read(j,b)}catch(i){if(i.request===d)i.request=a;if(i.response===d)i.response=j;e(i);return}c(j.data,j)},e)},I=function(a){return Object.prototype.toString.call(a)==="[object Array]"},oa=function(a,c){if(a){var e,o;e=0;for(o=a.length;e<o;e++)if(a[e].name===c)return a[e]}return null},fa=function(a,c,e){return a?t(c,function(c){var d;a:{if(c){d=
a.indexOf(c.namespace)===0&&a.charAt(c.namespace.length)==="."?a.substr(c.namespace.length+1):null;c=c[e];if(d&&c){var b,h;b=0;for(h=c.length;b<h;b++)if(c[b].name===d){d=c[b];break a}}}d=null}return d}):null},R=function(a,c){return fa(a,c,"entityType")},Ab={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},na=function(a){for(var c in a){var e=c.toLowerCase();if((e=Ab[e])&&c!==e){var o=a[c];delete a[c];a[e]=o}}},s=function(a){return parseInt(a,
10)},Bb=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,Da=function(a){a=Bb.exec(a);if(a===null)throw{message:"Invalid duration value."};var c=a[2]||"0",e=a[3]||"0",o=s(a[4]||0),d=s(a[5]||0),b=s(a[6]||0),h=parseFloat(a[7]||0);if(c!=="0"||e!=="0")throw{message:"Unsupported duration value."};e=a[8];c=0;if(e){if(e.length>7)throw{message:"Cannot parse duration value to given precision."};c=r(e.substring(3),4,true);e=r(e.substring(0,3),3,true);e=s(e);c=s(c)}else e=
0;e=e+(h*1E3+b*6E4+d*36E5+o*864E5);a[1]==="-"&&(e=-e);a={ms:e,__edmType:"Edm.Time"};if(c)a.ns=c;return a},Ca=function(a){var c=a.substring(0,1),c=c==="+"?1:-1,e=s(a.substring(1)),a=s(a.substring(a.indexOf(":")+1));return{d:c,h:e,m:a}},U=function(a){switch(typeof a){case "object":return!a?"n":I(a)||I(a.results)?"f":a.__metadata&&a.__metadata.uri!==d?"entry":I(a.EntitySets)?"s":I(a.__batchRequests)?"b":Object.prototype.toString.call(a)==="[object Date]"?"p":"c";case "string":case "number":case "boolean":return"p"}return"u"},
Ea=function(a,c,e){if(!a.method)a.method="GET";a.headers?na(a.headers):a.headers={};if(a.headers.Accept===d)a.headers.Accept=c.accept;m(a.data)&&a.body===d&&c.write(a,e);if(!m(a.headers.MaxDataServiceVersion))a.headers.MaxDataServiceVersion=c.maxDataServiceVersion||"1.0"},Cb=function(a){switch(U(a)){case "c":return a.__deferred&&a.__deferred.uri?"d":"c";case "f":case "entry":return"i";case "p":return"p"}return"n"},ga=function(a){throw a;},Db=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,
Fa=["scheme","authority","path","query","fragment"],pa=function(a){var c={isAbsolute:false};if(a){if(a=Db.exec(a)){var e,o;e=0;for(o=Fa.length;e<o;e++)a[e+1]&&(c[Fa[e]]=a[e+1])}if(c.scheme)c.isAbsolute=true}return c},Ga=function(a){return"".concat(a.scheme||"",a.authority||"",a.path||"",a.query||"",a.fragment||"")},Eb=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,Fb=/%[0-9A-F]{2}/ig,Gb=function(a){var a=pa(a),c=a.scheme,e=a.authority;if(c){a.scheme=c.toLowerCase();if(e)if(c=Eb.exec(e))a.authority=
"//"+(c[1]?c[1]+"@":"")+c[2].toLowerCase()+(c[3]?":"+c[3]:"")}a=Ga(a);return a.replace(Fb,function(a){return a.toLowerCase()})},J=function(a,c){if(!c)return a;var e=pa(a);if(e.isAbsolute)return a;var o=pa(c),d={},b;if(e.authority){d.authority=e.authority;b=e.path;d.query=e.query}else{if(e.path){if(e.path.charAt(0)==="/")b=e.path;else{b=e.path;var h=o.path,i="/";if(h){i=h.lastIndexOf("/");i=h.substring(0,i);i.charAt(i.length-1)!=="/"&&(i=i+"/")}b=i+b}d.query=e.query}else{b=o.path;d.query=e.query||
o.query}d.authority=o.authority}for(var i=h="",n;b;)if(b.indexOf("..")===0||b.indexOf(".")===0)b=b.replace(/^\.\.?\/?/g,"");else if(b.indexOf("/..")===0){b=b.replace(/^\/\..\/?/g,"/");n=h.lastIndexOf("/");h=n===-1?"":h.substring(0,n)}else if(b.indexOf("/.")===0)b=b.replace(/^\/\.\/?/g,"/");else{i=b;n=b.indexOf("/",1);n!==-1&&(i=b.substring(0,n));h=h+i;b=b.replace(i,"")}d.path=h;d.scheme=o.scheme;d.fragment=e.fragment;return Ga(d)},V=0,Hb=function(a){var c=b.document.createElement("IFRAME");c.style.display=
"none";a='<html><head><script type="text/javascript" src="'+a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;")+'"><\/script></head><body></body></html>';b.document.getElementsByTagName("BODY")[0].appendChild(c);Ha(c,a);return c},Ib=function(){if(b.XMLHttpRequest)return new b.XMLHttpRequest;var a;if(b.ActiveXObject)try{return new b.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(c){try{return new b.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){a=e}}else a={message:"XMLHttpRequest not supported"};
throw a;},Jb=function(a){if(!(a.indexOf("http://")===0||a.indexOf("https://")===0||a.indexOf("file://")===0))return true;var c=b.location;return a.indexOf(c.protocol+"//"+c.host+"/")===0},qa=function(a){if(a){Ha(a,"");a.parentNode.removeChild(a)}return null},Ha=function(a,c){var e=a.contentWindow?a.contentWindow.document:a.contentDocument.document;e.open();e.write(c);e.close()};k.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(a,
c,e){var o={},j=null,g=false,h;o.abort=function(){h=qa(h);if(!g){g=true;if(j){j.abort();j=null}e({message:"Request aborted"})}};var i=function(){h=qa(h);if(!g){g=true;j=null;e({message:"Request timed out"})}},n,l=a.requestUri,f=a.callbackParameterName!==d?a.callbackParameterName:this.callbackParameterName,k=a.formatQueryString!==d?a.formatQueryString:this.formatQueryString;if(!(a.enableJsonpCallback!==d?a.enableJsonpCallback:this.enableJsonpCallback)||Jb(l)){j=Ib();j.onreadystatechange=function(){if(!g&&
!(j===null||j.readyState!==4)){var d=j.statusText,o=j.status;if(o===1223){o=204;d="No Content"}var b=[],h=j.getAllResponseHeaders().split(/\r?\n/),i,n;i=0;for(n=h.length;i<n;i++)if(h[i]){var f=h[i].split(": ");b[f[0]]=f[1]}d={requestUri:l,statusCode:o,statusText:d,headers:b,body:j.responseText};g=true;j=null;o>=200&&o<=299?c(d):e({message:"HTTP request failed",request:a,response:d})}};j.open(a.method||"GET",l,true,a.user,a.password);if(a.headers)for(n in a.headers)j.setRequestHeader(n,a.headers[n]);
if(a.timeoutMS){j.timeout=a.timeoutMS;j.ontimeout=i}j.send(a.body)}else{if(a.method&&a.method!=="GET")throw{message:"Request is not local and cannot be done through JSONP."};var m=V;V=V+1;var q;n="handleJSONP_"+m.toString();b[n]=function(a){h=qa(h);if(!g){b.clearTimeout(q);var e=n;try{delete b[e]}catch(o){b[e]=d;m===V-1&&(V=V-1)}b.ActiveXObject&&!b.DOMParser&&(a=b.JSON.parse(b.JSON.stringify(a)));p(c,{body:a,statusCode:200,headers:{"Content-Type":"application/json"}})}};q=b.setTimeout(i,a.timeoutMS?
a.timeoutMS:12E4);i=f+"=parent."+n;this.formatQueryString&&(i=i+("&"+k));k=l.indexOf("?");l=k===-1?l+"?"+i:k===l.length-1?l+i:l+"&"+i;h=Hb(l)}return o}};var N=function(a){if(!a)return null;var a=a.split(";"),c={},e,d;e=1;for(d=a.length;e<d;e++){var b=a[e].split("=");c[b[0].trim?b[0].trim():b[0].replace(/^\s+|\s+$/g,"")]=b[1]}return{mediaType:a[0].trim?a[0].trim():a[0].replace(/^\s+|\s+$/g,""),properties:c}},Ia=function(a,c,e,d){return{contentType:a,dataServiceVersion:c,metadata:e?e.metadata:null,
context:e,handler:d}},ra=function(a,c,e){if(a){a=a.headers;a[c]||(a[c]=e)}},sa=function(a,c){var e=a.headers;return e&&e[c]||d},Kb=/^\s?(\d+\.\d+);?.*$/,Ja=function(a){if(a=sa(a,"DataServiceVersion"))if((a=Kb.exec(a))&&a.length)return a[1]},W=function(a,c,e,o){return{accept:e,maxDataServiceVersion:o,read:function(c,e){var o;if(!c||!c.headers)o=false;else{var b=N(sa(c,"Content-Type")),n=Ja(c)||"";o=c.body;if(m(o))if(this.accept.indexOf(b.mediaType)>=0){b=Ia(b,n,e,this);b.response=c;c.data=a(this,o,
b);o=c.data!==d}else o=false;else o=false}return o},write:function(a,e){var o;a:{if(a&&a.headers){var b=N(sa(a,"Content-Type")),n=Ja(a);if(!b||this.accept.indexOf(b.mediaType)>=0){b=Ia(b,n,e,this);b.request=a;a.body=c(this,a.data,b);if(a.body!==d){ra(a,"DataServiceVersion",b.dataServiceVersion||"1.0");if(b=b.contentType){n=b.mediaType;for(o in b.properties)n=n+(";"+o+"="+b.properties[o]);o=n}else o=d;ra(a,"Content-Type",o);ra(a,"MaxDataServiceVersion",this.maxDataServiceVersion);o=true;break a}}}o=
false}return o}}};k.textHandler=W(function(a,c){return c},function(a,c){return m(c)?c.toString():d},"text/plain","2.0");var ha=function(a,c,e){try{a.setProperty(c,e)}catch(o){}},Ka=function(){var a;if(b.ActiveXObject)try{a=new ActiveXObject("Msxml2.DOMDocument.6.0");a.async=false;return a}catch(c){try{a=new ActiveXObject("Msxml2.DOMDocument.3.0");a.async=false;ha(a,"ProhibitDTD",true);ha(a,"MaxElementDepth",256);ha(a,"AllowDocumentFunction",false);ha(a,"AllowXsltScript",false);return a}catch(e){a=
e}}else{if(b.DOMParser)return new b.DOMParser;a={message:"XML DOM parser not supported"}}throw a;},La=function(a){return{name:a.localName,namespace:a.nsURI,value:a.domNode.value}},Na=function(a){var c={name:a.localName,namespace:a.nsURI,value:Ma(a.domNode),attributes:[],children:[]};X(a,function(a){a.nsURI!=="http://www.w3.org/2000/xmlns/"&&c.attributes.push(La(a))});x(a,function(a){c.children.push(Na(a))});return c},Ma=function(a){for(var c=null,e=a.firstChild,o=a.ownerDocument.preserveWhiteSpace===
false,b;e;){if(e.nodeType===3||e.nodeType===4){var g=e.nodeValue,h;if(!(h=o)){h=/^\s*$/;h=!(g===null||h.test(g))}if(!h){if(b===d)a:{for(b=a;b!==null&&b.nodeType===1;){h=E(b,"space","http://www.w3.org/XML/1998/namespace");if(h==="preserve"){b=true;break a}if(h==="default")break;else b=b.parentNode}b=false}h=b}h&&(c=c?c+g:g)}e=e.nextSibling}return c},O=function(a,c,e){if(a.getElementsByTagNameNS){c=a.getElementsByTagNameNS(c,e);if(c.length!==0)return c[0]}else for(a=a.firstChild;a;){if(a.nodeType===
1&&(a.localName?a.localName:a.baseName)===e&&a.namespaceURI===c)return a;a=a.nextSibling}return null},Oa=function(a,c,e){var b=a.ownerDocument,c=b.createAttributeNS?b.createAttributeNS("http://www.w3.org/2000/xmlns/",c):b.createNode(2,c,"http://www.w3.org/2000/xmlns/");c.nodeValue=e;a.setAttributeNode(c)},ta=function(a,c){if(/(^\s)|(\s$)/.test(c))Pa(a,"space","http://www.w3.org/XML/1998/namespace","xml").value="preserve";var e=a.ownerDocument.createTextNode(c);a.appendChild(e)},X=function(a,c){var e,
b=a.domNode,d,g;d=0;for(g=b.attributes.length;d<g;d++){e=b.attributes.item(d);c(F(e))}},x=function(a,c){for(var e=a.domNode.firstChild,b;e!==null;){if(e.nodeType===1){b=J(E(e,"base","http://www.w3.org/XML/1998/namespace"),a.baseURI);c(F(e,b))}e=e.nextSibling}},Qa=function(a){for(var c=a.domNode.firstChild;c!==null;){if(c.nodeType===1){a=J(E(c,"base","http://www.w3.org/XML/1998/namespace"),a.baseURI);return F(c,a)}c=c.nextSibling}return null},A=function(a){var c=a.text;if(c!==d)return c;var c="",e=
a.firstChild;if(e){do{if(e.nodeType===3||e.nodeType===4)c=c+e.nodeValue;var b=e.firstChild;if(b)e=b;else for(;e!==a;)if(b=e.nextSibling){e=b;break}else e=e.parentNode}while(e!==a)}return c},Ra=function(a,c){var e;if(b.ActiveXObject){e=Ka();e.documentElement=e.createNode(1,a,c)}else b.document.implementation&&b.document.implementation.createDocument&&(e=b.document.implementation.createDocument(c,a,null));return F(e.documentElement)},Pa=function(a,c,e,b){var j=a.ownerDocument,c=b?b+":"+c:c;if(j.createAttributeNS){c=
j.createAttributeNS(e,c);a.setAttributeNodeNS(c)}else{c=j.createNode(2,c,e||d);a.setAttributeNode(c)}return c},y=function(a,c,e,b){var j=a.domNode.ownerDocument,c=j.createElementNS?j.createElementNS(e,c):j.createNode(1,c,e||d);b&&ta(c,b);a.domNode.appendChild(c);return F(c)},K=function(a,c,e,b){var j=a.domNode.ownerDocument;if(j.createAttributeNS){c=j.createAttributeNS(e,c);c.value=b;a.domNode.setAttributeNodeNS(c)}else{c=j.createNode(2,c,e||d);c.value=b;a.domNode.setAttributeNode(c)}return F(c)},
ia=function(a,c){var e,b=Ka();if(b.parseFromString){var b=b.parseFromString(a,"text/xml"),d=b.documentElement;e=F(d,"");if(e.localName==="parsererror"&&e.nsURI==="http://www.mozilla.org/newlayout/xml/parsererror.xml"){b=Ma(d);e=O(e,"http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext");throw{message:b,errorXmlText:a,srcText:e?e.nodeValue:""};}if(e.localName==="h3"&&e.nsURI=="http://www.w3.org/1999/xhtml"||O(d,"http://www.w3.org/1999/xhtml","h3"))throw{message:A(d),errorXmlText:a,srcText:""};
}else{b.loadXML(a);if(b.parseError.errorCode!==0)throw{message:b.parseError.reason,errorXmlText:a,srcText:b.parseError.srcText};}e=b.documentElement;b=J(E(e,"base","http://www.w3.org/XML/1998/namespace"),c);return F(e,b)},ua=function(a){var c=a.xml;if(c!==d)return c;if(b.XMLSerializer)return(new b.XMLSerializer).serializeToString(a);throw{message:"XML serialization unsupported"};},E=function(a,c,e){if(a.getAttributeNS)return a.getAttributeNS(e||null,c);return(a=a.attributes.getQualifiedItem(c,e))?
a.value:null},F=function(a,c){var e=a.namespaceURI,b=a.nodeName;e||(e=a.nodeType===2&&(b==="xmlns"||b.indexOf("xmlns:",0)===0)?"http://www.w3.org/2000/xmlns/":null);return{baseURI:c,domNode:a,localName:a.localName?a.localName:a.baseName,nsURI:e}},Lb=function(a){var c=[];x(a,function(a){if(a.localName==="uri"&&a.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices"){a={uri:A(a.domNode)};c.push(a)}});return{results:c}};k.xmlHandler=W(function(a,c){if(c){var e=ia(c);if(e){a:{if(e.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices")switch(e.localName){case "links":e=
Lb(e);break a;case "uri":e={uri:A(e.domNode)};break a}e=d}return e}}},function(a,c,e){e=e.contentType=e.contentType||N("application/xml");a=d;if(e&&e.mediaType==="application/xml"){if(U(c)==="c"&&!c.__metadata&&c.hasOwnProperty("uri")){e=Ra("uri","http://schemas.microsoft.com/ado/2007/08/dataservices");c.uri&&ta(e.domNode,c.uri);c=e}else c=void 0;c&&(a=ua(c.domNode.ownerDocument))}return a},"application/xml","2.0");var Sa=["application/atom+xml","application/atomsvc+xml","application/xml"],Ta=Sa[0],
ja=["http://www.w3.org/2005/Atom","http://www.w3.org/2007/app","http://www.w3.org/XML/1998/namespace","http://www.w3.org/2000/xmlns/"],Ua={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},
aa=function(a){return a},Mb=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(.*)$/,Va=function(a,c){var e=Mb.exec(a),b=e?Ba(e[8]):null;if(!e||!c&&b!=="Z")throw{message:"Invalid date/time value"};var d=s(e[1]);d<=0&&d++;var g=e[7],h=0;if(g){if(g.length>7)throw{message:"Cannot parse date/time value to given precision."};h=r(g.substring(3),4,true);g=r(g.substring(0,3),3,true);g=s(g);h=s(h)}else g=0;var i=s(e[4]),n=s(e[5]),l=s(e[6]);if(b!=="Z")var f=Ca(b),k=-f.d,i=i+f.h*k,n=n+f.m*k;f=
new Date;f.setUTCFullYear(d,s(e[2])-1,s(e[3]));f.setUTCHours(i,n,l,g);if(isNaN(f.valueOf()))throw{message:"Invalid date/time value"};if(c){f.__edmType="Edm.DateTimeOffset";f.__offset=b}if(h)f.__ns=h;return f},ka={"Edm.Boolean":function(a){return a==="true"},"Edm.Binary":aa,"Edm.DateTime":function(a){return Va(a,false)},"Edm.DateTimeOffset":function(a){return Va(a,true)},"Edm.Time":Da,"Edm.Decimal":aa,"Edm.Guid":aa,"Edm.String":aa,"Edm.Byte":s,"Edm.Double":parseFloat,"Edm.Single":parseFloat,"Edm.Int16":s,
"Edm.Int32":s,"Edm.Int64":aa,"Edm.SByte":s},B=function(a){return a.toString()},Nb={"Edm.Binary":B,"Edm.Boolean":B,"Edm.Byte":B,"Edm.DateTime":M,"Edm.DateTimeOffset":M,"Edm.Decimal":B,"Edm.Double":B,"Edm.Guid":B,"Edm.Int16":B,"Edm.Int32":B,"Edm.Int64":B,"Edm.SByte":B,"Edm.Single":B,"Edm.String":B,"Edm.Time":ea},Wa=function(a,c){if(a!==null&&c){var e=ka[c];e&&(a=e(a))}return a},Xa=function(a,c){if(a!==null&&c){Object.prototype.toString.call(a)==="[object Date]"&&(c=D(a)?"Edm.DateTimeOffset":"Edm.DateTime");
var e=Nb[c];e&&(a=e(a))}return a},Za=function(a,c){if(a.nsURI==="http://www.w3.org/2005/Atom")switch(a.localName){case "feed":return Ob(a,c);case "entry":return Ya(a,c)}if(a.nsURI==="http://www.w3.org/2007/app"&&a.localName==="service")return Pb(a)},Ob=function(a,c){var e={},b={results:[],__metadata:e};e.feed_extensions=ba(a);x(a,function(a){switch(a.nsURI){case "http://www.w3.org/2005/Atom":switch(a.localName){case "id":e.uri=J(A(a.domNode),a.baseURI);e.uri_extensions=ba(a);break;case "title":e.title=
A(a.domNode);e.title_extensions=ba(a);break;case "entry":a=Ya(a,c);b.results.push(a);break;case "link":var a=$a(a),d=b.__metadata;switch(a.rel){case "next":b.__next=a.href;d.next_extensions=a.extensions;break;case "self":d.self=a.href;d.self_extensions=a.extensions}}return;case "http://schemas.microsoft.com/ado/2007/08/dataservices/metadata":if(a.localName==="count"){b.__count=s(A(a.domNode));return}}a=ca(a);e.feed_extensions.push(a)});return b},$a=function(a){var c={extensions:[]},e;X(a,function(b){if(!b.nsURI)switch(b.localName){case "href":c.href=
J(b.domNode.nodeValue,a.baseURI);return;case "type":case "rel":c[b.localName]=b.domNode.nodeValue;return}if(!q(ja,b.nsURI)){e=da(b);c.extensions.push(e)}});if(!c.href)throw{error:"href attribute missing on link element",element:a};return c},ca=function(a){var c={name:a.localName,namespaceURI:a.nsURI,attributes:ba(a),children:[]};x(a,function(a){a=ca(a);c.children.push(a)});if(c.children.length===0)if(a=A(a.domNode))c.value=a;return c},ba=function(a){var c=[];X(a,function(a){if(!q(ja,a.nsURI)){a=da(a);
c.push(a)}});return c},da=function(a){return{name:a.localName,namespaceURI:a.nsURI,value:a.domNode.nodeValue}},ab=function(a,c){if(a.indexOf("/")===-1)return c[a];var e=a.split("/"),b,j;b=0;for(j=e.length;b<j;b++){if(c===null)return d;c=c[e[b]];if(c===d)break}return c},Qb=function(a){if(a.childNodes.length)return false;var a=a.attributes,c=a.length;if(c===0)return true;for(var e=0;e<c;e++){var b=a[e].nodeName;if(b!=="xmlns"&&b.indexOf("xmlns:")!==0&&b!=="m:type")return false}return true},bb=function(a,
c,e,b,j,g,h){var i=a["FC_TargetPath"+g],n=Ua[i]||i,i=i!==n?"http://www.w3.org/2005/Atom":a["FC_NsUri"+g],l=a["FC_KeepInContent"+g]==="true"?true:false,f=a["FC_ContentKind"+g],a=a["FC_NsPrefix"+g]||null,b=ab(c,b);if(m(b)){if(!l){h.dataServiceVersion="2.0";a:{h=O(e.domNode,"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata","properties");if(!h)(l=O(e.domNode,"http://www.w3.org/2005/Atom","content"))&&(h=O(l,"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata","properties"));
if(h){var l=h,c=c.split("/"),k,g=0;for(k=c.length-1;g<k;g++){l=O(l,"http://schemas.microsoft.com/ado/2007/08/dataservices",c[g]);if(!l)break a}(c=O(l,"http://schemas.microsoft.com/ado/2007/08/dataservices",c[g]))&&l.removeChild(c);for(c=l;c!==h&&Qb(c);){l=c.parentNode;l.removeChild(c);c=l}}}}j=b=Xa(b,j);c=e.domNode;n=n.split("/");e=0;for(b=n.length;e<b;e++){if(n[e].charAt(0)==="@"){h=n[e].substring(1);l=i;g=c.attributes;(h=g.getNamedItemNS?g.getNamedItemNS(l,h):g.getQualifiedItem(h,l))||(h=Pa(c,n[e].substring(1),
i,a))}else{h=O(c,i,n[e]);if(!h){h=n[e];l=i;g=c.ownerDocument;k=void 0;h=a?a+":"+h:h;k=g.createElementNS?g.createElementNS(l,h):g.createNode(1,h,l||d);c.appendChild(k);h=k}}c=h}if(c.nodeType===2)c.value=j;else{f&&c.setAttribute("type",f);if(f==="xhtml"){i=c;f=ia("<c>"+j+"</c>",null);a=i.ownerDocument;n=f.domNode;"importNode"in a&&(n=a.importNode(f.domNode,true));for(f=n.firstChild;f;){i.appendChild(f);f=f.nextSibling}}else ta(c,j)}}},cb=function(a,c,e,b,j,g){if(!(a["FC_KeepInContent"+g]==="true"||
ab(c,b)===null)){var h=a["FC_TargetPath"+g],i=Ua[h]||h;a:{var h=h!==i?"http://www.w3.org/2005/Atom":a["FC_NsUri"+g],e=e.domNode,a=a["FC_ContentKind"+g]==="xhtml",i=i.split("/"),n,g=0;for(n=i.length;g<n;g++){if(i[g].charAt(0)==="@"){e=E(e,i[g].substring(1),h);break a}e=O(e,h,i[g]);if(!e){e=d;break a}}if(a){h=e.childNodes;i=h.length;if(i===0)e="";else{a=e.ownerDocument.createDocumentFragment();for(e=0;e<i;e++)a.appendChild(h[e].cloneNode(true));e=ua(a)}}else e=A(e)}if(e!==d){e=Wa(e,j);a:{if(c.indexOf("/")!==
-1){c=c.split("/");h=0;for(i=c.length-1;h<i;h++){a=b[c[h]];if(a===d){a={};b[c[h]]=a}else if(a===null)break a;b=a}c=c[h]}b[c]=e;if(j){b=b.__metadata=b.__metadata||{};b=b.properties=b.properties||{};(b[c]=b[c]||{}).type=j}}}}},va=function(a,c,e){for(var e=e.split("/"),b,j;c;){var g=c;b=0;for(j=e.length;b<j;b++){g=g.property;if(!g)break;g=oa(g,e[b]);if(!g)break;g=g.type;if(!g||g&&ka[g]!==d)return g||null;g=fa(g,a,"complexType");if(!g)return null}c=R(c.baseType,a)}return null},Rb=function(a,c,e){if(e&&
e.length!==0)for(var b=c.__metadata.type;b;){b=R(b,e);if(!b)break;var d,g=b.FC_SourcePath;if(g){d=va(e,b,g);cb(b,g,a,c,d,"")}var h=b.property;if(h){var i,n;i=0;for(n=h.length;i<n;i++)for(var l=h[i],f=0,k="";l["FC_TargetPath"+k];){g=l.name;d=l.type;var m=l["FC_SourcePath"+k];if(m){g=g+("/"+m);d=va(e,b,g)}cb(l,g,a,c,d,k);f++;k="_"+f}}b=b.baseType}},Ya=function(a,c){var e={},b={__metadata:e},d=E(a.domNode,"etag","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata");if(d)e.etag=d;x(a,function(a){if(a.nsURI===
"http://www.w3.org/2005/Atom")switch(a.localName){case "id":e.uri=J(A(a.domNode),a.baseURI);e.uri_extensions=ba(a);break;case "category":Sb(a,b,e);break;case "content":Tb(a,b);break;case "link":var d=$a(a),j=b.__metadata;switch(d.rel){case "self":j.self=d.href;j.self_link_extensions=d.extensions;break;case "edit":j.edit=d.href;j.edit_link_extensions=d.extensions;break;case "edit-media":j.edit_media=d.href;j.edit_media_extensions=[];var n,l;n=0;for(l=d.extensions.length;n<l;n++)d.extensions[n].namespaceURI===
"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"&&d.extensions[n].name==="etag"?j.media_etag=d.extensions[n].value:j.edit_media_extensions.push(d.extensions[n]);break;default:d.rel.indexOf("http://schemas.microsoft.com/ado/2007/08/dataservices/related/")===0&&Ub(a,d,b,c)}}a.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"&&a.localName==="properties"&&wa(a,b,e)});Rb(a,b,c);return b},Sb=function(a,c,e){var b=E(a.domNode,"scheme",void 0),d=E(a.domNode,"term",void 0);
if(b==="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"){if(c.__metadata.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:a};e.type=d;e.type_extensions=[];var g;X(a,function(a){if(a.nsURI){if(!q(ja,a.nsURI)){g=da(a);e.type_extensions.push(g)}}else if(a.localName!=="scheme"&&a.localName!=="term"){g=da(a);e.type_extensions.push(g)}})}},Tb=function(a,c){var e=E(a.domNode,"src",void 0),b=E(a.domNode,
"type",void 0),d=c.__metadata;if(e){if(!b)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:a};d.media_src=J(e,a.baseURI);d.content_type=b}x(a,function(b){if(e)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:a};b.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"&&b.localName==="properties"&&wa(b,c,d)})},Ub=function(a,
c,e,b){var j=c.rel.substring(62),g=d;x(a,function(a){if(a.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"&&a.localName==="inline")g=(a=Qa(a))?Za(a,b):null});g===d&&(g={__deferred:{uri:c.href}});e[j]=g;e.__metadata.properties=e.__metadata.properties||{};e.__metadata.properties[j]={extensions:c.extensions}},wa=function(a,c,e){x(a,function(a){if(a.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices"){e.properties=e.properties||{};Vb(a,c,e.properties)}})},Vb=function(a,
c,e){var b=null,j="Edm.String",g=[];X(a,function(a){if(a.nsURI==="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata")switch(a.localName){case "null":b=a.domNode.nodeValue;return;case "type":j=a.domNode.nodeValue;return}if(!q(ja,a.nsURI)){a=da(a);g.push(a)}});var h=null,i={type:j,extensions:g};if(b!=="true"){h=A(a.domNode);if(j&&ka[j]!==d)h=Wa(h,j);else if(Qa(a)){h={__metadata:{type:j}};wa(a,h,i)}}c[a.localName]=h;e[a.localName]=i},Pb=function(a){var c={workspaces:[],extensions:[]};x(a,
function(e){if(e.nsURI==="http://www.w3.org/2007/app"&&e.localName==="workspace"){e=Wb(e);c.workspaces.push(e)}else{e=ca(a);c.extensions.push(e)}});if(c.workspaces.length===0)throw{message:"Invalid AtomPub service document: No workspace element found.",element:a};return c},Wb=function(a){var c={collections:[],extensions:[]};x(a,function(e){if(e.nsURI==="http://www.w3.org/2005/Atom"){if(e.localName==="title"){if(a.title)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",
element:e};c.title=A(e.domNode)}}else if(e.nsURI==="http://www.w3.org/2007/app"){if(e.localName==="collection"){e=Xb(e,c);c.collections.push(e)}}else{e=ca(a);c.extensions.push(e)}});c.title=c.title||"";return c},Xb=function(a){var c={href:E(a.domNode,"href",void 0),extensions:[]};if(!c.href)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:a};c.href=J(c.href,a.baseURI);x(a,function(e){if(e.nsURI==="http://www.w3.org/2005/Atom"){if(e.localName==="title"){if(c.title)throw{message:"Invalid AtomPub service document: collection has more than one child title element",
element:e};c.title=A(e.domNode)}}else if(e.nsURI!=="http://www.w3.org/2007/app"){e=ca(a);c.extensions.push(e)}});if(!c.title)throw{message:"Invalid AtomPub service document: collection has no title element",element:a};return c},db=function(a,c){if(a)return y(a,c,"http://www.w3.org/2005/Atom");var e=Ra(c,"http://www.w3.org/2005/Atom");Oa(e.domNode,"xmlns:d","http://schemas.microsoft.com/ado/2007/08/dataservices");Oa(e.domNode,"xmlns:m","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata");
return e},eb=function(a,c,e){a=db(a,"feed");if(c=I(c)?c:c.results){var b,d;b=0;for(d=c.length;b<d;b++)xa(a,c[b],e)}return a},xa=function(a,c,e){var a=db(a,"entry"),b=y(a,"author","http://www.w3.org/2005/Atom");y(b,"name","http://www.w3.org/2005/Atom");y(a,"title","http://www.w3.org/2005/Atom");b=y(a,"content","http://www.w3.org/2005/Atom");K(b,"type",null,"application/xml");var b=y(b,"m:properties","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"),d=c.__metadata?c.__metadata.properties:
null,g=c.__metadata;if(g){g.etag&&K(a,"etag","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata",g.etag);g.uri&&y(a,"id","http://www.w3.org/2005/Atom",g.uri);if(g.type){var h=y(a,"category","http://www.w3.org/2005/Atom");K(h,"term",null,g.type);K(h,"scheme",null,"http://schemas.microsoft.com/ado/2007/08/dataservices/scheme")}}fb(a,b,c,d,e);if(c.__metadata){b=e.metadata;for(d=R(c.__metadata.type,b);d;){if(g=d.FC_SourcePath){h=va(b,d,g);bb(d,g,a,c,h,"",e)}if(h=d.property){var i,n;i=0;for(n=
h.length;i<n;i++)for(var l=h[i],f=0,k="";l["FC_TargetPath"+k];){g=l.name;l["FC_SourcePath"+k]&&(g=g+("/"+l["FC_SourcePath"+k]));bb(l,g,a,c,l.type,k,e);f++;k="_"+f}}d=R(d.baseType,b)}}return a},fb=function(a,c,e,b,j){var g,h,i,n,l=j.metadata,f;for(g in e)if(g!=="__metadata"){h=e[g];i=Cb(h);n=b?b[g]:null;if(!n){f===d&&e.__metadata&&(f=R(e.__metadata.type,l));if(f)(n=oa(f.property,g))||(n=oa(f.navigationProperty,g))}if(i==="n"){i="p";n&&!(n.type&&ka[n.type]!==d)&&(n.relationship?i="i":fa(n.type,j.metadata,
"complexType")&&(i="c"))}if(i==="p"||i==="c"){var k=c,m=j,p="d:"+g,q=n&&n.type,s=void 0;if(i==="c"){s=y(k,p,"http://schemas.microsoft.com/ado/2007/08/dataservices");i=void 0;if(n)i=n.properties;if(h===null)m.dataServiceVersion="2.0";fb(null,s,h,i,m)}else s=y(k,p,"http://schemas.microsoft.com/ado/2007/08/dataservices",Xa(h,q||"Edm.String"));h===null&&K(s,"m:null","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata","true");q&&K(s,"m:type","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata",
q)}else{q=a;s=g;k=h;h=j;m=n=p=void 0;if(i=i==="i"){p=k&&k.__metadata?k.__metadata.uri:"";m=U(k);switch(m){case "entry":n=xa;break;case "f":m="feed";n=eb;break;case "n":m="entry";n=null;break;default:throw{message:"Invalid payload for inline navigation property: "+m};}}else p=k.__deferred.uri;var t=J(s,"http://schemas.microsoft.com/ado/2007/08/dataservices/related/"),s=p,p=t,q=y(q,"link","http://www.w3.org/2005/Atom");K(q,"rel",null,p);K(q,"href",null,s);if(i){i=y(q,"m:inline","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata");
K(q,"type",null,"application/atom+xml;type="+m);n&&n(i,k,h)}}}};k.atomHandler=W(function(a,c,e){if(c)if(a=ia(c))return Za(a,e.metadata)},function(a,c,e){var a=e.contentType=e.contentType||N(Ta),b=d;if(a&&a.mediaType===Ta){var j;switch(U(c)){case "f":j=eb(null,c,e);break;case "entry":case "c":j=xa(null,c,e)}b=ua(j.domNode.ownerDocument)}return b},Sa.join(","),"2.0");var u={Association:{attributes:["Name"],elements:["End*","ReferentialConstraint"]},AssociationSet:{attributes:["Name","Association"],
elements:["End*"]},CollectionType:{attributes:"ElementType,Nullable,DefaultValue,MaxLength,FixedLength,Precision,Scale,Unicode,Collation".split(",")},ComplexType:{attributes:["Name","BaseType","Abstract"],elements:["Property*"]},DefiningExpression:{text:!0},Dependent:{attributes:["Role"],elements:["PropertyRef*"]},Documentation:{text:!0},End:{attributes:["Type","Role","Multiplicity","EntitySet"],elements:["OnDelete"]},EntityContainer:{attributes:["Name","Extends"],elements:["EntitySet*","AssociationSet*",
"FunctionImport*"]},EntitySet:{attributes:["Name","EntityType"]},EntityType:{attributes:["Name","BaseType","Abstract","OpenType"],elements:["Key","Property*","NavigationProperty*"]},Function:{attributes:["Name","ReturnType"],elements:["Parameter*","DefiningExpression","ReturnType"]},FunctionImport:{attributes:["Name","ReturnType","EntitySet"],elements:["Parameter*"]},Key:{elements:["PropertyRef*"]},NavigationProperty:{attributes:["Name","Relationship","ToRole","FromRole"]},OnDelete:{attributes:["Action"]},
Parameter:{attributes:"Name,Type,Mode,MaxLength,Precision,Scale".split(",")},Principal:{attributes:["Role"],elements:["PropertyRef*"]},Property:{attributes:"Name,Type,Nullable,DefaultValue,MaxLength,FixedLength,Precision,Scale,Unicode,Collation,ConcurrencyMode".split(",")},PropertyRef:{attributes:["Name"]},ReferenceType:{attributes:["Type"]},ReferentialConstraint:{elements:["Principal","Dependent"]},ReturnType:{attributes:["ReturnType"],elements:["CollectionType","ReferenceType","RowType"]},RowType:{elements:["Property*"]},
Schema:{attributes:["Namespace","Alias"],elements:"Using*,EntityContainer*,EntityType*,Association*,ComplexType*,Function*".split(",")},TypeRef:{attributes:"Type,Nullable,DefaultValue,MaxLength,FixedLength,Precision,Scale,Unicode,Collation".split(",")},Using:{attributes:["Namespace","Alias"]}},gb="m:FC_ContentKind,m:FC_KeepInContent,m:FC_NsPrefix,m:FC_NsUri,m:FC_SourcePath,m:FC_TargetPath".split(",");u.Property.attributes=u.Property.attributes.concat(gb);u.EntityType.attributes=u.EntityType.attributes.concat(gb);
u.Edmx={attributes:["Version"],elements:["DataServices"],ns:"http://schemas.microsoft.com/ado/2007/06/edmx"};u.DataServices={elements:["Schema*"],ns:"http://schemas.microsoft.com/ado/2007/06/edmx"};u.EntityContainer.attributes.push("m:IsDefaultEntityContainer");u.Property.attributes.push("m:MimeType");u.FunctionImport.attributes.push("m:HttpMethod");u.EntityType.attributes.push("m:HasStream");u.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var hb=function(a){if(!a)return a;
if(a.length>1){var c=a.substr(0,2);return c===c.toUpperCase()?a:a.charAt(0).toLowerCase()+a.substr(1)}return a.charAt(0).toLowerCase()},Yb=function(a,c){if(c==="Documentation")return{isArray:true,propertyName:"documentation"};var e=a.elements;if(!e)return null;var b,d;b=0;for(d=e.length;b<d;b++){var g=e[b],h=false;if(g.charAt(g.length-1)==="*"){h=true;g=g.substr(0,g.length-1)}if(c===g){e=hb(g);return{isArray:h,propertyName:e}}}return null},Zb=/^(m:FC_.*)_[0-9]+$/,ya=function(a){a.domNode||(a=F(a,
""));var c=u[a.localName];if(!c)return null;if(c.ns){if(a.nsURI!==c.ns)return null}else if(!(a.nsURI==="http://schemas.microsoft.com/ado/2008/09/edm"||a.nsURI==="http://schemas.microsoft.com/ado/2006/04/edm"||a.nsURI==="http://schemas.microsoft.com/ado/2007/05/edm"||a.nsURI==="http://schemas.microsoft.com/ado/2009/11/edm"))return null;var e={},b=[],d=c.attributes||[];X(a,function(a){var c=a.localName,i=a.nsURI,f=a.domNode.value;if(i!=="http://www.w3.org/2000/xmlns/"){var l=null,k=false;i==="http://schemas.microsoft.com/ado/2008/09/edm"||
i==="http://schemas.microsoft.com/ado/2006/04/edm"||i==="http://schemas.microsoft.com/ado/2007/05/edm"||i==="http://schemas.microsoft.com/ado/2009/11/edm"||i===null?l="":i==="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"&&(l="m:");if(l!==null){l=l+c;(i=Zb.exec(l))&&(l=i[1]);if(q(d,l)){k=true;e[hb(c)]=f}}k||b.push(La(a))}});x(a,function(a){var d=Yb(c,a.localName);if(d)if(d.isArray){var j=e[d.propertyName];if(!j){j=[];e[d.propertyName]=j}j.push(ya(a))}else e[d.propertyName]=ya(a);
else b.push(Na(a))});if(c.text)e.text=A(a);if(b.length)e.extensions=b;return e};k.metadataHandler=W(function(a,c){var e=ia(c);return ya(e)||d},null,"application/xml","2.0");var za=["application/json","application/json;odata=verbose"],$b=N(za[0]),ac=N(za[1]),bc=function(a,c){var e={collections:[]},b,d;b=0;for(d=a.EntitySets.length;b<d;b++){var g=a.EntitySets[b],g={title:g,href:J(g,c)};e.collections.push(g)}return{workspaces:[e]}},cc=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,ib=function(a){var c=a&&cc.exec(a);
if(c){a=new Date(s(c[1]));if(c[2]){var e=s(c[3]);c[2]==="-"&&(e=-e);c=a.getUTCMinutes();a.setUTCMinutes(c-e);a.__edmType="Edm.DateTimeOffset";if(e<0){c="-";e=-e}else c="+";var b=Math.floor(e/60),e=e-60*b,e=c+r(b,2)+":"+r(e,2);a.__offset=e}if(!isNaN(a.valueOf()))return a}},jb=function(a,c){if(a&&typeof a==="object")for(var e in a){var b=a[e],j=jb(b,c),j=c(e,j);j!==b&&(b===d?delete a[e]:a[e]=j)}return a},dc=function(a,c){return c("",jb(a,c))},ec=function(a,c){return c&&c.__edmType==="Edm.Time"?ea(c):
c},fc=function(a,c){c&&c.lastIndexOf(";")===c.length-1&&(c=c.substr(0,c.length-1));c||I(a)&&(c="1.0");c==="1.0"&&I(a)&&(a={results:a});return a};k.jsonHandler=W(function(a,c,e){var o=e.metadata,j=(e.context?e.context.recognizeDates:d)!==d?e.context?e.context.recognizeDates:d:a.recognizeDates,a=typeof c==="string"?b.JSON.parse(c):c,a=dc(a,function(a,c){if(c&&typeof c==="object"){var e=c.__metadata&&c.__metadata.type;if(e=R(e,o)||fa(e,o,"complexType")){var b=e.property;if(b){var d,f;d=0;for(f=b.length;d<
f;d++){var k=b[d],m=k.name,e=c[m];if(k.type==="Edm.DateTime"||k.type==="Edm.DateTimeOffset"){if(e){e=ib(e);if(!e)throw{message:"Invalid date/time value"};c[m]=e}}else k.type==="Edm.Time"&&(c[m]=Da(e))}}}else if(j)for(b in c){e=c[b];typeof e==="string"&&(c[b]=ib(e)||e)}}return c}).d,a=fc(a,e.dataServiceVersion);return a=U(a)==="s"?bc(a,e.response.requestUri):a},function(a,c,e){a=d;if((e=e.contentType=e.contentType||ac)&&e.mediaType===$b.mediaType){e=Date.prototype.toJSON;try{Date.prototype.toJSON=
function(){return M(this)};a=b.JSON.stringify(c,ec)}finally{Date.prototype.toJSON=e}}return a},za.join(","),"2.0");k.jsonHandler.recognizeDates=!1;var gc=/^HTTP\/1\.\d (\d{3}) (.*)$/i,hc=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,Y=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)},kb=function(a){a=a.boundaries;return a[a.length-1]},mb=function(a,c){var e="--"+kb(c);L(a,c,e);L(a,c,"\r\n");for(var b=[],d;d!=="--"&&c.position<a.length;){d=lb(a,c);if((d=N(d["Content-Type"]))&&
d.mediaType==="multipart/mixed"){c.boundaries.push(d.properties.boundary);try{var g=mb(a,c)}catch(h){h.response=nb(a,c,e);g=[h]}b.push({__changeResponses:g});c.boundaries.pop();L(a,c,"--"+kb(c))}else{if(!d||d.mediaType!=="application/http")throw{message:"invalid MIME part type "};L(a,c,"\r\n");d=nb(a,c,e);try{d.statusCode>=200&&d.statusCode<=299?c.handlerContext.handler.partHandler.read(d,c.handlerContext):d={message:"HTTP request failed",response:d}}catch(i){d=i}b.push(d)}d=a.substr(c.position,2);
L(a,c,"\r\n")}return b},lb=function(a,c){var e={},b,d,g;do{g=c.position;d=L(a,c,"\r\n");b=hc.exec(d);b!==null?e[b[1]]=b[2]:c.position=g}while(d&&b);na(e);return e},nb=function(a,c,e){var b=c.position,d=gc.exec(L(a,c,"\r\n")),g,h,i;if(d){g=d[1];h=d[2];i=lb(a,c);L(a,c,"\r\n")}else c.position=b;return{statusCode:g,statusText:h,headers:i,body:L(a,c,"\r\n"+e)}},L=function(a,c,e){var b=c.position||0,d=a.length;if(e){d=a.indexOf(e,b);if(d===-1)return null;c.position=d+e.length}else c.position=d;return a.substring(b,
d)},la=function(a,c){var e="\r\n--"+a;c&&(e=e+"--");return e+"\r\n"},ob=function(a,c,e){var b=a.__changeRequests;if(I(b)){if(e)throw{message:"Not Supported: change set nested in other change set"};var a="changeset_"+Y()+"-"+Y()+"-"+Y(),e="Content-Type: multipart/mixed; boundary="+a+"\r\n",d,g;d=0;for(g=b.length;d<g;d++)e=e+(la(a,false)+ob(b[d],c,true));e=e+la(a,true)}else{e="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";Ea(a,c.handler.partHandler,{metadata:c.metadata});
c=(a.method?a.method:"GET")+" "+a.requestUri+" HTTP/1.1\r\n";for(d in a.headers)a.headers[d]&&(c=c+d+": "+a.headers[d]+"\r\n");c=c+"\r\n";a.body&&(c=c+a.body);e=e+c}return e};k.batchHandler=W(function(a,c,e){return{__batchResponses:mb(c,{boundaries:[e.contentType.properties.boundary],handlerContext:e})}},function(a,c,e){if((e.contentType=e.contentType||N("multipart/mixed")).mediaType==="multipart/mixed"){a=U(c);if(a!=="b")throw{message:'Serialization of batches of type "'+a+'" is not supported'};
var a="batch_"+Y()+"-"+Y()+"-"+Y(),c=c.__batchRequests,b="",d,g;d=0;for(g=c.length;d<g;d++)b=b+(la(a,false)+ob(c[d],e));b=b+la(a,true);e.contentType.properties.boundary=a;return b}},"multipart/mixed","2.0");var pb=[k.jsonHandler,k.atomHandler,k.xmlHandler,k.textHandler],qb=function(a,c,b){var d,j;d=0;for(j=pb.length;d<j&&!pb[d][a](c,b);d++);if(d===j)throw{message:"no handler for data"};};k.defaultSuccess=function(a){b.alert(b.JSON.stringify(a))};k.defaultError=ga;k.defaultHandler={read:function(a,
c){a&&m(a.body)&&a.headers["Content-Type"]&&qb("read",a,c)},write:function(a,c){qb("write",a,c)},maxDataServiceVersion:"2.0",accept:"application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1"};k.defaultMetadata=[];k.read=function(a,c,b,d,j,g){return k.request(a instanceof String||typeof a==="string"?{requestUri:a}:a,c,b,d,j,g)};k.request=function(a,c,b,o,j,g){if(!c)c=k.defaultSuccess;if(!b)b=k.defaultError;if(!o)o=k.defaultHandler;if(!j)j=k.defaultHttpClient;if(!g)g=k.defaultMetadata;
a.recognizeDates=a.recognizeDates!==d?a.recognizeDates:k.jsonHandler.recognizeDates;a.callbackParameterName=a.callbackParameterName!==d?a.callbackParameterName:k.defaultHttpClient.callbackParameterName;a.formatQueryString=a.formatQueryString!==d?a.formatQueryString:k.defaultHttpClient.formatQueryString;a.enableJsonpCallback=a.enableJsonpCallback!==d?a.enableJsonpCallback:k.defaultHttpClient.enableJsonpCallback;g={metadata:g,recognizeDates:a.recognizeDates,callbackParameterName:a.callbackParameterName,
formatQueryString:a.formatQueryString,enableJsonpCallback:a.enableJsonpCallback};try{Ea(a,o,g);return zb(a,c,b,o,j,g)}catch(h){b(h)}};k.batchHandler.partHandler=k.defaultHandler;var G=b.localStorage,ic=function(){var a={v:this.valueOf(),t:"[object Date]"},c;for(c in this)a[c]=this[c];return a},jc=function(a,c){if(c&&c.t==="[object Date]"){var b=new Date(c.v),d;for(d in c)d!=="t"&&d!=="v"&&(b[d]=c[d]);c=b}return c},w=function(a){this.name=a};w.create=function(a){if(w.isSupported())return new w(a);
throw{message:"Web Storage not supported by the browser"};};w.isSupported=function(){return!!G};w.prototype.add=function(a,c,b,d){var d=d||this.defaultError,j=this;this.contains(a,function(g){g?p(d,{message:"key already exists",key:a}):j.addOrUpdate(a,c,b,d)},d)};w.prototype.addOrUpdate=function(a,c,e,o){o=o||this.defaultError;if(a instanceof Array)o({message:"Array of keys not supported"});else{var j=this.name+"#!#"+a,g=Date.prototype.toJSON;try{var h=c;if(h!==d){Date.prototype.toJSON=ic;h=b.JSON.stringify(c)}G.setItem(j,
h);p(e,a,c)}catch(i){i.code===22||i.number===2147942414?p(o,{name:"QUOTA_EXCEEDED_ERR",error:i}):p(o,i)}finally{Date.prototype.toJSON=g}}};w.prototype.clear=function(a,c){c=c||this.defaultError;try{for(var b=0,d=G.length;d>0&&b<d;){var j=G.key(b),g=j.replace(this.name+"#!#","");if(j!==g){G.removeItem(j);d=G.length}else b++}p(a)}catch(h){p(c,h)}};w.prototype.close=function(){};w.prototype.contains=function(a,c,b){b=b||this.defaultError;try{var d=G.getItem(this.name+"#!#"+a);p(c,d!==null)}catch(j){p(b,
j)}};w.prototype.defaultError=ga;w.prototype.getAllKeys=function(a,c){var c=c||this.defaultError,b=[],d,j;try{d=0;for(j=G.length;d<j;d++){var g=G.key(d),h=g.replace(this.name+"#!#","");g!==h&&b.push(h)}p(a,b)}catch(i){p(c,i)}};w.prototype.mechanism="dom";w.prototype.read=function(a,c,e){e=e||this.defaultError;if(a instanceof Array)e({message:"Array of keys not supported"});else try{var f=G.getItem(this.name+"#!#"+a),f=f!==null&&f!=="undefined"?b.JSON.parse(f,jc):d;p(c,a,f)}catch(j){p(e,j)}};w.prototype.remove=
function(a,c,b){b=b||this.defaultError;if(a instanceof Array)b({message:"Batches not supported"});else try{G.removeItem(this.name+"#!#"+a);p(c)}catch(d){p(b,d)}};w.prototype.update=function(a,c,b,d){var d=d||this.defaultError,j=this;this.contains(a,function(g){g?j.addOrUpdate(a,c,b,d):p(d,{message:"key not found",key:a})},d)};var rb=b.mozIndexedDB,P=b.IDBTransaction,sb=b.IDBKeyRange,H=function(a,c){return function(b){b.code===11&&(b={name:"QUOTA_EXCEEDED_ERR",error:b});a?a(b):c&&c(b)}},Q=function(a,
c,b,d){var j=a.name,g=a.db,h=H(d,a.defaultError);if(g)b(g.transaction(j,c));else{var i=rb.open("_datajs_"+j);i.onsuccess=function(d){g=a.db=d.target.result;if(g.objectStoreNames.contains(j))b(g.transaction(j,c));else{d=g.setVersion("1.0");d.onsuccess=function(){g.createObjectStore(j,null,false);b(g.transaction(j,c))};d.onerror=h;d.onblocked=h}};i.onerror=H(d,this.defaultError)}},z=function(a){this.name=a};z.create=function(a){if(z.isSupported())return new z(a);throw{message:"IndexedDB is not supported on this browser"};
};z.isSupported=function(){return!!rb};z.prototype.add=function(a,c,b,d){var j=this.name,g=this.defaultError,h=[],i=[];if(a instanceof Array){h=a;i=c}else{h=[a];i=[c]}Q(this,P.READ_WRITE,function(f){f.onabort=H(d,g);f.oncomplete=function(){a instanceof Array?b(h,i):b(a,c)};for(var l=0;l<h.length&&l<i.length;l++)f.objectStore(j).add(i[l],h[l])},d)};z.prototype.addOrUpdate=function(a,c,b,d){var j=this.name,g=this.defaultError,h=[],i=[];if(a instanceof Array){h=a;i=c}else{h=[a];i=[c]}Q(this,P.READ_WRITE,
function(f){f.onabort=H(d,g);f.oncomplete=function(){a instanceof Array?b(h,i):b(a,c)};for(var l=0;l<h.length&&l<i.length;l++)f.objectStore(j).put(i[l],h[l])},d)};z.prototype.clear=function(a,c){var b=this.name,d=this.defaultError;Q(this,P.READ_WRITE,function(j){j.onerror=H(c,d);j.oncomplete=function(){a()};j.objectStore(b).clear()},c)};z.prototype.close=function(){if(this.db){this.db.close();this.db=null}};z.prototype.contains=function(a,c,b){var f=this.name,j=this.defaultError;Q(this,P.READ_ONLY,
function(g){var h=g.objectStore(f).openCursor(sb.only(a));g.oncomplete=function(){c(h.result!==d)};g.onerror=H(b,j)},b)};z.prototype.defaultError=ga;z.prototype.getAllKeys=function(a,c){var b=this.name,d=this.defaultError;Q(this,P.READ_ONLY,function(j){var g=[];j.oncomplete=function(){a(g)};j=j.objectStore(b).openCursor();j.onerror=H(c,d);j.onsuccess=function(a){if(a=a.target.result){g.push(a.key);a["continue"].call(a)}}},c)};z.prototype.mechanism="indexeddb";z.prototype.read=function(a,c,b){var d=
this.name,j=this.defaultError,g=a instanceof Array?a:[a];Q(this,P.READ_WRITE,function(h){var i=[];h.onerror=H(b,j);h.oncomplete=function(){a instanceof Array?c(g,i):c(g[0],i[0])};for(var f=0;f<g.length;f++){var l=h.objectStore(d);l.get.call(l,g[f]).onsuccess=function(a){i.push(a.target.result)}}},b)};z.prototype.remove=function(a,c,b){var d=this.name,f=this.defaultError,g=a instanceof Array?a:[a];Q(this,P.READ_WRITE,function(a){a.onerror=H(b,f);a.oncomplete=function(){c()};for(var i=0;i<g.length;i++){var k=
a.objectStore(d);k["delete"].call(k,g[i])}},b)};z.prototype.update=function(a,c,b,d){var f=this.name,g=this.defaultError,h=[],i=[];if(a instanceof Array){h=a;i=c}else{h=[a];i=[c]}Q(this,P.READ_WRITE,function(k){k.onabort=H(d,g);k.oncomplete=function(){a instanceof Array?b(h,i):b(a,c)};for(var l=0;l<h.length&&l<i.length;l++){var m=k.objectStore(f).openCursor(sb.only(h[l]));m.pair={key:h[l],value:i[l]};m.onsuccess=function(a){var c=a.target.result;c?c.update(a.target.pair.value):k.abort()}}},d)};var S=
function(a){var c=[],b=[],f={};this.name=a;var j=function(a){return a||this.defaultError},g=function(a,c){var b;a instanceof Array&&(b="Array of keys not supported");if(a===d||a===null)b="Invalid key";if(b){p(c,{message:b});return false}return true};this.add=function(a,c,b,d){d=j(d);g(a,d)&&(f.hasOwnProperty(a)?d({message:"key already exists",key:a}):this.addOrUpdate(a,c,b,d))};this.addOrUpdate=function(a,i,k,l){l=j(l);if(g(a,l)){l=f[a];l===d&&(l=c.length>0?c.splice(0,1):b.length);b[l]=i;f[a]=l;p(k,
a,i)}};this.clear=function(a){b=[];f={};c=[];p(a)};this.contains=function(a,c){var b=f.hasOwnProperty(a);p(c,b)};this.getAllKeys=function(a){var c=[],b;for(b in f)c.push(b);p(a,c)};this.read=function(a,c,d){d=j(d);g(a,d)&&p(c,a,b[f[a]])};this.remove=function(a,i,k){k=j(k);if(g(a,k)){k=f[a];if(k!==d){if(k===b.length-1)b.pop();else{b[k]=d;c.push(k)}delete f[a];b.length===0&&(c=[])}p(i)}};this.update=function(a,c,b,d){d=j(d);g(a,d)&&(f.hasOwnProperty(a)?this.addOrUpdate(a,c,b,d):d({message:"key not found",
key:a}))}};S.create=function(a){return new S(a)};S.isSupported=function(){return true};S.prototype.close=function(){};S.prototype.defaultError=ga;S.prototype.mechanism="memory";var kc={indexeddb:z,dom:w,memory:S};f.defaultStoreMechanism="best";f.createStore=function(a,c){if(!c)c=f.defaultStoreMechanism;c==="best"&&(c=w.isSupported()?"dom":"memory");var b=kc[c];if(b)return b.create(a);throw{message:"Failed to create store",name:a,mechanism:c};};var lc=function(a,c,b){return function(){a[c].apply(a,
arguments);return b}},Z=function(){this._fail=this._done=this._arguments=d;this._rejected=this._resolved=false};Z.prototype={then:function(a,c){if(a)this._done?this._done.push(a):this._done=[a];if(c)this._fail?this._fail.push(c):this._fail=[c];this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments);return this},resolve:function(){if(this._done){var a,c;a=0;for(c=this._done.length;a<c;a++)this._done[a].apply(null,arguments);this._done=d;this._resolved=
false;this._arguments=d}else{this._resolved=true;this._arguments=arguments}},reject:function(){if(this._fail){var a,c;a=0;for(c=this._fail.length;a<c;a++)this._fail[a].apply(null,arguments);this._fail=d;this._rejected=false;this._arguments=d}else{this._rejected=true;this._arguments=arguments}},promise:function(){var a={};a.then=lc(this,"then",a);return a}};var ma=function(){return b.jQuery&&b.jQuery.Deferred?new b.jQuery.Deferred:new Z},mc=function(a,c){var b=a.indexOf("?"),d="";if(b>=0){d=a.substr(b);
a=a.substr(0,b)}a[a.length-1]!=="/"&&(a=a+"/");return a+c+d},tb=function(a,b){return{method:"GET",requestUri:a,user:b.user,password:b.password,enableJsonpCallback:b.enableJsonpCallback,callbackParameterName:b.callbackParameterName,formatQueryString:b.formatQueryString}},ub=function(a,b,e,f,j){var a=tb(a,b),g=k.request(a,function(a){var d=a.__next;e=e.concat(a.results);d?g=ub(d,b,e,f,j):f(e)},j,d,b.httpClient,b.metadata);return{abort:function(){g.abort()}}},nc=function(a){var b=this,e=a.source;b.identifier=
Gb(encodeURI(decodeURI(e)));b.options=a;b.count=function(a,f){var g=b.options;return k.request(tb(mc(e,"$count"),g),function(b){b=s(b.toString());isNaN(b)?f({message:"Count is NaN",count:b}):a(b)},f,d,g.httpClient,g.metadata)};b.read=function(a,d,g,f){a="$skip="+a+"&$top="+d;d=e.indexOf("?")>=0?"&":"?";return ub(e+d+a,b.options,[],g,f)};return b},vb=function(a,b){if(a===d||typeof a!=="number")throw{message:"'"+b+"' must be a number."};if(isNaN(a)||a<0||!isFinite(a))throw{message:"'"+b+"' must be greater than or equal to zero."};
},wb=function(a,b){if(a!==d&&(typeof a!=="number"||isNaN(a)||!isFinite(a)))throw{message:"'"+b+"' must be a number."};},Aa=function(a,b){var d,f;d=0;for(f=a.length;d<f;d++)if(a[d]===b){a.splice(d,1);return true}return false},T=function(a,b){for(var d in b)a[d]=b[d];return a},xb=function(a){var b=0,d=typeof a;if(d==="object"&&a)for(var f in a)b=b+(f.length*2+xb(a[f]));else b=d==="string"?a.length*2:8;return b},yb=function(a,b,d){a=Math.floor(a/d)*d;b=Math.ceil((b+1)/d)*d;return{i:a,c:b-a}},$=function(a,
b,d,f,j,g,h){var i,k,l=this;l.p=b;l.i=f;l.c=j;l.d=g;l.s="start";l.canceled=false;l.pending=h;l.oncomplete=null;l.cancel=function(){if(d){var a=l.s;if(a!=="error"&&a!=="end"&&a!=="cancel"){l.canceled=true;m("cancel",i)}}};l.complete=function(){m("end",i)};l.error=function(a){l.canceled||m("error",a)};l.run=function(a){k=a;l.transition(l.s,i)};l.wait=function(a){m("wait",a)};var m=function(b,c){l.s=b;i=c;var d=k;switch(b){case "start":d!=="init"&&a(l,b,d,c);break;case "wait":a(l,b,d,c);break;case "cancel":a(l,
b,d,c);l.fireCanceled();m("end");break;case "error":a(l,b,d,c);l.canceled=true;l.fireRejected(c);m("end");break;case "end":if(l.oncomplete)l.oncomplete(l);l.canceled||l.fireResolved();a(l,b,d,c);break;default:a(l,b,d,c)}};l.transition=m;return l};$.prototype.fireResolved=function(){var a=this.p;if(a){this.p=null;a.resolve(this.d)}};$.prototype.fireRejected=function(a){var b=this.p;if(b){this.p=null;b.reject(a)}};$.prototype.fireCanceled=function(){this.fireRejected({canceled:true,message:"Operation canceled"})};
var oc=function(a){var c="init",e={counts:0,netReads:0,prefetches:0,cacheReads:0},k=[],j=[],g=[],h=0,i=false,n=a.cacheSize!==d?a.cacheSize:1048576,l=0,q=0,t=0,D=n===0,r=a.pageSize!==d?a.pageSize:50,w=a.prefetchSize!==d?a.prefetchSize:r,z="1.0",v,A=0,x=a.source;typeof x==="string"&&(x=new nc(a));x.options=a;var y=f.createStore(a.name,a.mechanism),C=this;C.onidle=a.idle;C.stats=e;C.count=function(){if(v)throw v;var a=ma(),b=false;if(i){p(function(){a.resolve(l)});return a.promise()}var c=x.count(function(b){c=
null;e.counts++;a.resolve(b)},function(d){c=null;a.reject(T(d,{canceled:b}))});return T(a.promise(),{cancel:function(){if(c){b=true;c.abort();c=null}}})};C.clear=function(){if(v)throw v;if(k.length===0){var a=ma(),b=new $(P,a,false);M(b,k);return a.promise()}return k[0].p};C.filterForward=function(a,b,c){return H(a,b,c,false)};C.filterBack=function(a,b,c){return H(a,b,c,true)};C.readRange=function(a,b){vb(a,"index");vb(b,"count");if(v)throw v;var c=ma(),d=new $(S,c,true,a,b,[],0);M(d,j);return T(c.promise(),
{cancel:function(){d.cancel()}})};C.ToObservable=C.toObservable=function(){if(!b.Rx||!b.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(v)throw v;return b.Rx.Observable.CreateWithDisposable(function(a){var b=false,c=0,d=function(c){b||a.OnError(c)},e=function(g){if(!b){var f,h;f=0;for(h=g.length;f<h;f++)a.OnNext(g[f]);if(g.length<r)a.OnCompleted();else{c=c+r;C.readRange(c,r).then(e,d)}}};C.readRange(c,r).then(e,d);return{Dispose:function(){b=true}}})};var B=function(a){return function(b){v=
{message:a,error:b};var c,b=0;for(c=j.length;b<c;b++)j[b].fireRejected(v);b=0;for(c=k.length;b<c;b++)k[b].fireRejected(v);j=k=null}},u=function(a){if(a!==c){c=a;var a=k.concat(j,g),b,d;b=0;for(d=a.length;b<d;b++)a[b].run(c)}},E=function(){var a=new Z;y.clear(function(){h=0;i=false;t=q=l=0;D=n===0;e={counts:0,netReads:0,prefetches:0,cacheReads:0};C.stats=e;y.close();a.resolve()},function(b){a.reject(b)});return a},G=function(a){var b=Aa(k,a);if(!b)(b=Aa(j,a))||Aa(g,a);A--;u("idle")},J=function(a){var b=
new Z,c=x.read(a,r,function(c){b.resolve({i:a,c:c.length,d:c})},function(a){b.reject(a)});return T(b,{cancel:function(){if(c){c.abort();c=null}}})},H=function(a,b,c,d){a=s(a);b=s(b);if(isNaN(a))throw{message:"'index' must be a valid number.",index:a};if(isNaN(b))throw{message:"'count' must be a valid number.",count:b};if(v)throw v;var a=Math.max(a,0),e=ma(),g=[],f=false,h=null,j=function(a,i){f||(b>=0&&g.length>=b?e.resolve(g):h=C.readRange(a,i).then(function(f){for(var h=0,k=f.length;h<k&&(b<0||
g.length<b);h++){var l=d?k-h-1:h,m=f[l];if(c(m)){l={index:a+l,item:m};d?g.unshift(l):g.push(l)}}if(!d&&f.length<i||d&&a<=0)e.resolve(g);else{f=d?Math.max(a-r,0):a+i;j(f,r)}},function(a){e.reject(a)}))},i=yb(a,a,r);j(d?i.i:a,d?a-i.i+1:i.i+i.c-a);return T(e.promise(),{cancel:function(){h&&h.cancel();f=true}})},I=function(){if(C.onidle&&A===0)C.onidle()},M=function(a,b){a.oncomplete=G;b.push(a);A++;a.run(c)},ea=function(a){var b=false,c=T(new Z,{cancel:function(){b=true}}),e=K(c,"Read page from store failure");
y.contains(a,function(g){b||(g?y.read(a,function(a,e){b||c.resolve(e!==d,e)},e):c.resolve(false))},e);return c},O=function(a,b){var c=T(new Z,{cancel:function(){}}),d=K(c,"Save page to store failure"),e=function(){c.resolve(true)};if(b.c>0){var g=xb(b);(D=n>=0&&n<h+g)?e():y.addOrUpdate(a,b,function(){L(b,g);F(e,d)},d)}else{L(b,0);F(e,d)}return c},F=function(a,b){y.addOrUpdate("__settings",{actualCacheSize:h,allDataLocal:i,cacheSize:n,collectionCount:l,highestSavedPage:q,highestSavedPageSize:t,pageSize:r,
sourceId:x.identifier,version:z},a,b)},K=function(a){return function(){a.resolve(false)}},L=function(a,b){var c=a.c,d=a.i;if(c===0)q===d-r&&(l=q+t);else{q=Math.max(q,d);q===d&&(t=c);h=h+b;c<r&&!l&&(l=d+c)}!i&&l===q+t&&(i=true)},N=function(a,b,c,d){(a=a.canceled&&b!=="end")&&b==="cancel"&&d&&d.cancel&&d.cancel();return a},P=function(a,b,c){var d=a.transition;if(c!=="destroy"){u("destroy");return true}switch(b){case "start":d("clear");break;case "end":I();break;case "clear":E().then(function(){a.complete()});
a.wait();break;default:return false}return true},Q=function(a,b,c,d){if(!N(a,b,c,d)){var e=a.transition;if(c!=="prefetch"){c==="destroy"?b!=="cancel"&&a.cancel():c==="idle"&&u("prefetch");return true}switch(b){case "start":g[0]===a&&e("local",a.i);break;case "done":b=a.pending;b>0&&(b=b-Math.min(b,d.c));if(i||b===0||d.c<r||D)a.complete();else{a.pending=b;e("local",d.i+r)}break;default:return R(a,b,c,d,true)}}return true},S=function(a,b,c,d){if(!N(a,b,c,d)){var f=a.transition;if(c!=="read"&&b!=="start"){c===
"destroy"?b!=="start"&&a.cancel():c!=="write"&&u("read");return true}switch(b){case "start":if(c==="idle"||c==="prefetch"){u("read");if(a.c>0){a=yb(a.i,a.c,r);f("local",a.i)}else f("done",a)}break;case "done":var h,c=a.i+a.c,j=d.i+d.c,b=a.i>d.i?a.i:d.i,c=c<j?c:j;c>=b&&(h={i:b,c:c-b});if(h){h=h.i-d.i;a.d=a.d.concat(d.d.slice(h,h+(a.c-a.d.length)))}if(a.c===a.d.length||d.c<r){e.cacheReads++;if(!i&&!(w===0||D))if(g.length===0||g[0]&&g[0].c!==-1){f=new $(Q,null,true,d.i+d.c,w,null,w);M(f,g)}a.complete()}else f("local",
d.i+r);break;default:return R(a,b,c,d,false)}}return true},R=function(a,b,c,d,g){var f=a.error,h=a.transition,j=a.wait,i;switch(b){case "end":I();break;case "local":i=ea(d).then(function(b,c){a.canceled||(b?h("done",c):h("source",d))});break;case "source":i=J(d).then(function(b){if(!a.canceled){g?e.prefetches++:e.netReads++;h("save",b)}},f);break;case "save":if(c!=="write"){u("write");i=O(d.i,d).then(function(b){if(!a.canceled){if(!b&&g)a.pending=0;h("done",d)}u("idle")})}break;default:return false}i&&
(a.canceled?i.cancel():a.s===b&&j(i));return true};y.read("__settings",function(a,b){if(m(b)){var c=b.version;if(!c||c.indexOf("1.")!==0)B("Unsupported cache store version "+c)();else if(r!==b.pageSize||x.identifier!==b.sourceId)E().then(function(){u("idle")},B("Unable to clear store during initialization"));else{h=b.actualCacheSize;i=b.allDataLocal;n=b.cacheSize;l=b.collectionCount;q=b.highestSavedPage;t=b.highestSavedPageSize;z=c;u("idle")}}else F(function(){u("idle")},B("Unable to write settings during initialization."))},
B("Unable to read settings from store."));return C};f.createDataCache=function(a){var b=a.pageSize;if(b!==d){if(typeof b!=="number")throw{message:"'pageSize' must be a number."};if(isNaN(b)||b<=0||!isFinite(b))throw{message:"'pageSize' must be greater than zero."};}wb(a.cacheSize,"cacheSize");wb(a.prefetchSize,"prefetchSize");if(!m(a.name))throw{message:"Undefined or null name",options:a};if(!m(a.source))throw{message:"Undefined source",options:a};return new oc(a)}})(this);
$C("$data.storageProviders.oData.oDataProvider",$data.StorageProviderBase,null,{constructor:function(b,d){"undefined"===typeof OData&&Guard.raise(new Exception("datajs is required","Not Found!"));this.SqlCommands=[];this.context=d;this.providerConfiguration=$data.typeSystem.extend({dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:"2.0",user:null,password:null},b);this.context&&this.context._buildDbType_generateConvertToFunction&&
this.buildDbType_generateConvertToFunction&&(this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction);this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition&&(this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition)},initializeStore:function(b){b=$data.typeSystem.createCallbackSetting(b);switch(this.providerConfiguration.dbCreation){case $data.storageProviders.DbCreationType.DropAllExistingTables:var d=
this;if(this.providerConfiguration.serviceUrl){var f=[{requestUri:d.providerConfiguration.serviceUrl+"/Delete",method:"POST"},function(){console.log("RESET oData database");b.success(d.context)},function(){b.success(d.context)}];this.providerConfiguration.user&&(f[0].user=this.providerConfiguration.user,f[0].password=this.providerConfiguration.password||"");this.context.prepareRequest.call(this,f);OData.request.apply(this,f)}else b.success(d.context);break;default:b.success(this.context)}},buildDbType_generateConvertToFunction:function(b,
d){return function(f,k){var m=new b.PhysicalType;m.entityState=f.entityState;b.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(b){m[b.name]=f[b.name]},this);b.Associations&&b.Associations.forEach(function(b){if("*"==b.FromMultiplicity&&"0..1"==b.ToMultiplicity||"0..1"==b.FromMultiplicity&&"1"==b.ToMultiplicity||"$$unbound"==b.FromMultiplicity){var p=f[b.FromPropertyName];if(null!==p&&void 0!==p)if(p instanceof $data.Array)m[b.FromPropertyName]=m[b.FromPropertyName]||[],
p.forEach(function(d){d=k.indexOf(d);0>d&&Guard.raise("Dependency graph error");m[b.FromPropertyName].push({__metadata:{uri:"$"+(d+1)}})},this);else if(p.entityState===$data.EntityState.Modified){var t=d._storageModel.getStorageModel(p.getType()).TableName,D="(";p.getType().memberDefinitions.getKeyProperties().forEach(function(b,d){0<d&&(D+=",");D+=p[b.name]},this);D+=")";m[b.FromPropertyName]={__metadata:{uri:t+D}}}else t=k.indexOf(p),0>t&&Guard.raise("Dependency graph error"),m[b.FromPropertyName]=
{__metadata:{uri:"$"+(t+1)}}}},this);b.ComplexTypes&&b.ComplexTypes.forEach(function(b){m[b.FromPropertyName]=f[b.FromPropertyName]},this);return m}},executeQuery:function(b,d){var d=$data.typeSystem.createCallbackSetting(d),f;try{f=this._compile(b)}catch(k){d.error(k);return}f=[{requestUri:this.providerConfiguration.oDataServiceHost+f.queryText,headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},function(f){d.success&&(b.rawDataList="string"===typeof f?[{cnt:f}]:f,d.success(b))},
function(b,f,k){d.error(k)}];this.providerConfiguration.user&&(f[0].user=this.providerConfiguration.user,f[0].password=this.providerConfiguration.password||"");this.context.prepareRequest.call(this,f);OData.request.apply(this,f)},_compile:function(b){return(new $data.storageProviders.oData.oDataCompiler).compile(b)},saveChanges:function(b,d){0<d.length?this.saveInternal(this.buildIndependentBlocks(d),0,b):b.success(0)},saveInternal:function(b,d,f){batchRequests=[];convertedItem=[];for(d=0;d<b.length;d++)for(var k=
0;k<b[d].length;k++){convertedItem.push(b[d][k].data);var m={};m.headers={"Content-Id":convertedItem.length};switch(b[d][k].data.entityState){case $data.EntityState.Unchanged:continue;case $data.EntityState.Added:m.method="POST";m.requestUri=b[d][k].entitySet.name;m.data=this.save_getInitData(b[d][k],convertedItem);break;case $data.EntityState.Modified:m.method="MERGE";m.requestUri=b[d][k].entitySet.name;m.requestUri+="("+this.getEntityKeysValue(b[d][k])+")";this.save_addConcurrencyHeader(b[d][k],
m.headers);m.data=this.save_getInitData(b[d][k],convertedItem);break;case $data.EntityState.Deleted:m.method="DELETE";m.requestUri=b[d][k].entitySet.name;m.requestUri+="("+this.getEntityKeysValue(b[d][k])+")";this.save_addConcurrencyHeader(b[d][k],m.headers);break;default:Guard.raise(new Exception("Not supported Entity state"))}batchRequests.push(m)}b=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:batchRequests}]}},function(b,
d){if(202==d.statusCode){for(var k=b.__batchResponses[0].__changeResponses,m=0;m<k.length;m++){var v=convertedItem[m];if(204==k[m].statusCode){if(k[m].headers.ETag){var M=v.getType().memberDefinitions.getPublicMappedProperties().filter(function(b){return b.concurrencyMode===$data.ConcurrencyMode.Fixed});M&&M[0]&&(v[M[0].name]=k[m].headers.ETag)}}else v.getType().memberDefinitions.getPublicMappedProperties().forEach(function(b){b.computed&&(v[b.name]=b.concurrencyMode===$data.ConcurrencyMode.Fixed?
k[m].headers.ETag:k[m].data[b.name])},this)}f.success&&f.success(convertedItem.length)}else f.error(d)},f.error,OData.batchHandler];this.providerConfiguration.user&&(b[0].user=this.providerConfiguration.user,b[0].password=this.providerConfiguration.password||"");this.context.prepareRequest.call(this,b);OData.request.apply(this,b)},save_getInitData:function(b,d){b.physicalData=this.context._storageModel.getStorageModel(b.data.getType()).PhysicalType.convertTo(b.data,d);var f={};b.physicalData.getType().memberDefinitions.asArray().forEach(function(d){if(d.kind==
$data.MemberTypes.navProperty||d.kind==$data.MemberTypes.complexProperty||d.kind==$data.MemberTypes.property&&!d.notMapped)f[d.name]=b.physicalData[d.name]},this);return f},save_addConcurrencyHeader:function(b,d){var f=b.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(b){return b.concurrencyMode===$data.ConcurrencyMode.Fixed});f&&f[0]&&(d["If-Match"]=b.data[f[0].name],b.data[f[0].name]="")},getTraceString:function(b){this._compile(b);return b},supportedDataTypes:{value:[$data.Integer,
$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date],writable:!1},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:"ne",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:"eq",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:"ne",dataType:"boolean",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:"gt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:"ge",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:"lt",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:"le",dataType:"boolean",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:"or",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:"and",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},add:{mapTo:"add",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},divide:{mapTo:"div",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},
multiply:{mapTo:"mul",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},subtract:{mapTo:"sub",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},modulo:{mapTo:"mod",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:"not"}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",
dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],
parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},replace:{dataType:"string",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFrom",dataType:"string"},{name:"strTo",dataType:"string"}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",
allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,
$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",
dataType:"date"}]},month:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],
parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]}},enumerable:!0,writable:!0},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],
parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"any",frameType:$data.Expressions.SomeExpression},every:{invokable:!1,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:"all",frameType:$data.Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{}},enumerable:!0,writable:!0},fieldConverter:{value:{fromDb:{"$data.Integer":function(b){return b},"$data.Number":function(b){return b},"$data.Date":function(b){return b?
new Date(parseInt(b.substr(6))):void 0},"$data.String":function(b){return b},"$data.Boolean":function(b){return b},"$data.Blob":function(b){return b},"$data.Object":function(b){return void 0===b?new $data.Object:"string"===typeof b?JSON.parse(b):b},"$data.Array":function(b){return void 0===b?new $data.Array:b instanceof $data.Array?b:JSON.parse(b)}},toDb:{"$data.Integer":function(b){return b},"$data.Number":function(b){return 0==b%1?b:b+"m"},"$data.Date":function(b){return b?"datetime'"+b.toISOString()+
"'":null},"$data.String":function(b){return"'"+b.replace(/'/g,"''")+"'"},"$data.Boolean":function(b){return b?"true":"false"},"$data.Blob":function(b){return b},"$data.Object":function(b){return JSON.stringify(b)},"$data.Array":function(b){return JSON.stringify(b)}}}},getEntityKeysValue:function(b){for(var d=[],f=void 0,k=b.entitySet.createNew.memberDefinitions.asArray(),m=0,q=k.length;m<q;m++){var p=k[m];if(p.key){f=b.data[p.name];switch(p.dataType){case "Edm.Guid":f="guid'"+f+"'";break;case "Edm.Binary":f=
"binary'"+f+"'";break;case "Edm.Byte":f="0123456789ABCDEF"[m>>4&15]+"0123456789ABCDEF"[m&15];break;case "Edm.DateTime":f="datetime'"+f.toISOString()+"'";break;case "Edm.Decimal":f+="M";break;case "Edm.Single":f+="f";break;case "Edm.Int64":f+="L";break;case "Edm.String":case "string":f="'"+f+"'"}d.push(p.name+"="+f)}}return 1<d.length?d.join(","):f}},null);$data.StorageProviderBase.registerProvider("oData",$data.storageProviders.oData.oDataProvider);
$C("$data.storageProviders.oData.oDataCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={};this.provider={};this.mainEntitySet=this.includes=null},compile:function(b){this.provider=b.context.storageProvider;this.context=b.context;this.mainEntitySet=b.context.getEntitySetFromElementType(b.defaultType);var d={urlText:""};this.Visit(b.expression,d);b.modelBinderConfig={};Container.createModelBinderConfigCompiler(b,this.includes,!0).Visit(b.expression);var f=
d.urlText,k=!1,m;for(m in d)"urlText"!=m&&"actionPack"!=m&&"data"!=m&&"lambda"!=m&&""!=d[m]&&(f=k?f+"&":f+"?",k=!0,f="$urlParams"!=m?f+(m+"="+d[m]):f+d[m]);b.queryText=f;return{queryText:f,params:[]}},VisitOrderExpression:function(b,d){this.Visit(b.source,d);Container.createoDataOrderCompiler(this.provider).compile(b,d)},VisitPagingExpression:function(b,d){this.Visit(b.source,d);Container.createoDataPagingCompiler().compile(b,d)},VisitIncludeExpression:function(b,d){this.Visit(b.source,d);if(!d.$select){d.$expand=
d.$expand?d.$expand+",":"";d.$expand+=b.selector.value.replace(".","/");this.includes=this.includes||[];for(var f=b.selector.value.split("."),k=null,m=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew),q=0;q<f.length;q++)k=k?k+("."+f[q]):f[q],(m=m.Associations[f[q]])?this.includes.some(function(b){return b.name==k},this)||this.includes.push({name:k,type:m.ToType}):Guard.raise(new Exception("The given include path is invalid: "+b.selector.value+", invalid point: "+
k)),m=this.mainEntitySet.entityContext._storageModel.getStorageModel(m.ToType)}},VisitProjectionExpression:function(b,d){this.Visit(b.source,d);Container.createoDataProjectionCompiler(this.context).compile(b,d)},VisitFilterExpression:function(b,d){this.Visit(b.source,d);var f=Container.createoDataWhereCompiler(this.provider);d.data="";f.compile(b.selector,d);d.$filter=d.data;d.data=""},VisitEntitySetExpression:function(b,d){d.urlText+="/"+b.instance.tableName;if(b.params)for(var f=0;f<b.params.length;f++)this.Visit(b.params[f],
d)},VisitServiceOperationExpression:function(b,d){d.urlText+="/"+b.cfg.serviceName;if(b.params)for(var f=0;f<b.params.length;f++)this.Visit(b.params[f],d)},VisitConstantExpression:function(b,d){d.$urlParams=d.$urlParams?d.$urlParams+"&":"";var f=Container.getTypeName(b.value);d.$urlParams+=b.name+"="+this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(f))](b.value)},VisitCountExpression:function(b,d){this.Visit(b.source,d);d.urlText+="/$count"}},{});
$C("$data.storageProviders.oData.oDataWhereCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(b,d){this.provider=b;this.lambdaPrefix=d},compile:function(b,d){this.Visit(b,d)},VisitParametricQueryExpression:function(b,d){this.Visit(b.expression,d)},VisitUnaryExpression:function(b,d){d.data+=b.resolution.mapTo;d.data+="(";this.Visit(b.operand,d);d.data+=")"},VisitSimpleBinaryExpression:function(b,d){d.data+="(";if("in"==b.nodeType){Guard.requireType("expression.right",b.type,
$data.Expressions.ConstantExpression);var f=b.right.value;!f instanceof Array&&Guard.raise(new Exception("Right to the 'in' operator must be an array value"));var k=null,m={mapTo:"or",dataType:"boolean",name:"or"},q={mapTo:"eq",dataType:"boolean",name:"equal"};f.forEach(function(d){d=Container.createConstantExpression(d);d=Container.createSimpleBinaryExpression(b.left,d,$data.Expressions.ExpressionType.Equal,"==","boolean",q);k=k?Container.createSimpleBinaryExpression(k,d,$data.Expressions.ExpressionType.Or,
"||","boolean",m):d});f=d.data;d.data="";this.Visit(k,d);d.data=f+d.data.replace(/\(/g,"").replace(/\)/g,"")}else this.Visit(b.left,d),d.data+=" ",d.data+=b.resolution.mapTo,d.data+=" ",this.Visit(b.right,d);d.data+=")"},VisitEntityFieldExpression:function(b,d){this.Visit(b.source,d);this.Visit(b.selector,d)},VisitAssociationInfoExpression:function(b,d){d.data+=b.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(b,d){d.data+=b.memberName},VisitQueryParameterExpression:function(b,
d){d.data+=this.provider.fieldConverter.toDb[b.type](b.value)},VisitEntityFieldOperationExpression:function(b,d){Guard.requireType("expression.operation",b.operation,$data.Expressions.MemberInfoExpression);var f=b.operation.memberDefinition;d.data+=f.mapTo||f.name;d.data+="(";var k=0;(f.parameters||[{name:"@expression"}]).map(function(d){return"@expression"===d.name?b.source:b.parameters[k++]}).forEach(function(b,f){0<f&&(d.data+=",");this.Visit(b,d)},this);d.data+=")"},VisitConstantExpression:function(b,
d){var f=Container.getTypeName(b.value);d.data+=this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(f))](b.value)},VisitEntityExpression:function(b,d){this.Visit(b.source,d);this.lambdaPrefix&&b.selector.lambda&&(d.lambda=b.selector.lambda,d.data+=b.selector.lambda+"/")},VisitEntitySetExpression:function(b,d){this.Visit(b.source,d);b.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(b.selector,d),d.data+="/")},VisitFrameOperationExpression:function(b,
d){this.Visit(b.source,d);Guard.requireType("expression.operation",b.operation,$data.Expressions.MemberInfoExpression);var f=b.operation.memberDefinition;d.data+=f.mapTo||f.name;d.data+="(";for(var k=0,m=(f.parameters||[{name:"@expression"}]).map(function(d){return"@expression"===d.name?b.source:b.parameters[k++]}),q=0;q<m.length;q++){var p=m[q];if(p&&p.value instanceof $data.Queryable){var t=new f.frameType(p.value.expression),p=Container.createQueryExpressionCreator(p.value.entityContext).Visit(t),
t={data:""};(new $data.storageProviders.oData.oDataWhereCompiler(this.provider,!0)).compile(p,t);d.data+=t.lambda+": "+t.data}}d.data+=")"}});
$C("$data.storageProviders.oData.oDataOrderCompiler",$data.storageProviders.oData.oDataWhereCompiler,null,{constructor:function(b){this.provider=b},compile:function(b,d){this.Visit(b,d)},VisitOrderExpression:function(b,d){var f={data:""};this.Visit(b.selector,f);d.$orderby=d.$orderby?d.$orderby+",":"";d.$orderby+=f.data+(b.nodeType==$data.Expressions.ExpressionType.OrderByDescending?" desc":"")},VisitParametricQueryExpression:function(b,d){this.Visit(b.expression,d)},VisitEntityFieldExpression:function(b,
d){this.Visit(b.source,d);this.Visit(b.selector,d)},VisitComplexTypeExpression:function(b,d){this.Visit(b.source,d);this.Visit(b.selector,d);d.data+="/"},VisitEntitySetExpression:function(b,d){b.selector instanceof $data.Expressions.AssociationInfoExpression&&(this.Visit(b.source,d),this.Visit(b.selector,d))},VisitAssociationInfoExpression:function(b,d){d.data+=b.associationInfo.FromPropertyName+"/"},VisitEntityExpression:function(b,d){this.Visit(b.source,d);this.Visit(b.selector,d)},VisitMemberInfoExpression:function(b,
d){d.data+=b.memberName}});
$C("$data.storageProviders.oData.oDataPagingCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(b){this.provider=b},compile:function(b,d){this.Visit(b,d)},VisitPagingExpression:function(b,d){var f={data:""};this.Visit(b.amount,f);switch(b.nodeType){case $data.Expressions.ExpressionType.Skip:d.$skip=f.data;break;case $data.Expressions.ExpressionType.Take:d.$top=f.data;break;default:Guard.raise("Not supported nodeType")}},VisitConstantExpression:function(b,d){d.data+=b.value}});
$C("$data.storageProviders.oData.oDataProjectionCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(b){this.entityContext=b;this.hasObjectLiteral=!1;this.ObjectLiteralPath="";this.modelBinderMapping=[]},compile:function(b,d){this.Visit(b,d)},VisitProjectionExpression:function(b,d){this.mapping=d.data="";this.Visit(b.selector,d);d.$select=d.$select?d.$select+",":"";d.$select+=d.data;d.data=""},VisitParametricQueryExpression:function(b,d){this.Visit(b.expression,d);b.expression instanceof
$data.Expressions.EntityExpression&&(d.$expand=d.$expand?d.$expand+",":"",d.$expand+=this.mapping.replace(/\./g,"/"));var f=this.mapping.split(".");f.pop();0<f.length&&(d.$expand=d.$expand?d.$expand+",":"",d.$expand+=f.join("/"))},VisitObjectLiteralExpression:function(b,d){var f=this.ObjectLiteralPath;this.hasObjectLiteral=!0;b.members.forEach(function(f,m){this.Visit(f,d);m<b.members.length-1&&(d.data+=",");this.mapping=""},this);this.ObjectLiteralPath=f},VisitObjectFieldExpression:function(b,d){this.ObjectLiteralPath=
this.ObjectLiteralPath?this.ObjectLiteralPath+("."+b.fieldName):b.fieldName;this.Visit(b.expression,d);if(b.expression instanceof $data.Expressions.EntityExpression)d.$expand=d.$expand?d.$expand+",":"",d.$expand+=this.mapping.replace(/\./g,"/");else{var f=this.mapping.split(".");f.pop();0<f.length&&(d.$expand=d.$expand?d.$expand+",":"",d.$expand+=f.join("/"))}},VisitComplexTypeExpression:function(b,d){this.Visit(b.source,d);this.Visit(b.selector,d)},VisitEntityFieldExpression:function(b,d){this.Visit(b.source,
d);this.Visit(b.selector,d)},VisitEntityExpression:function(b,d){this.Visit(b.source,d)},VisitEntitySetExpression:function(b,d){b.source instanceof $data.Expressions.EntityExpression&&this.Visit(b.source,d);b.selector instanceof $data.Expressions.AssociationInfoExpression&&this.Visit(b.selector,d)},VisitAssociationInfoExpression:function(b,d){d.data&&0<d.data.length&&","!=d.data[d.data.length-1]&&(d.data+="/");d.data+=b.associationInfo.FromPropertyName;this.mapping&&0<this.mapping.length&&(this.mapping+=
".");this.mapping+=b.associationInfo.FromPropertyName},VisitMemberInfoExpression:function(b,d){d.data&&0<d.data.length&&","!=d.data[d.data.length-1]&&(d.data+="/");d.data+=b.memberName;this.mapping&&0<this.mapping.length&&(this.mapping+=".");this.mapping+=b.memberName},VisitConstantExpression:function(b,d){d.data=d.data.slice(0,d.data.length-1)}});
